[{"filePath":"/Users/janhartje/drachenbootplan/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/jest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/jest.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/next.config.mjs","messages":[{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":6,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":6,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import withPWAInit from \"@ducanh2912/next-pwa\";\n\nconst withPWA = withPWAInit({\n  dest: \"public\",\n  // Schaltet PWA im Dev-Modus aus (nervt sonst beim Debuggen), im Build an\n  disable: process.env.NODE_ENV === \"development\",\n  register: true,\n  skipWaiting: true,\n});\n\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  images: { unoptimized: true },\n  outputFileTracingRoot: __dirname,\n};\n\nexport default withPWA(nextConfig);\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/prisma.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/scripts/migrate-teams.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/actions/team.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'sendEmail' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TeamInviteEmail' is defined but never used.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'baseUrl' is assigned a value but never used.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":26,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":13}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { auth, signIn } from \"@/auth\"\nimport prisma from \"@/lib/prisma\"\nimport { sendEmail } from \"@/lib/email\"\nimport TeamInviteEmail from \"@/emails/templates/TeamInviteEmail\"\n\n// Helper function to send team invite - triggers NextAuth magic link\nasync function sendTeamInviteEmail(\n  email: string,\n  teamName: string,\n  teamId: string,\n  inviterName?: string,\n  lang: 'de' | 'en' = 'de'\n) {\n  // Trigger NextAuth's signIn to send the actual magic link email\n  // auth.ts is configured to intercept this and send a TeamInviteEmail\n  // if it finds a pending invite for this email.\n  try {\n    const baseUrl = process.env.NEXT_PUBLIC_SERVER_URL || 'http://localhost:3000'\n    await signIn('resend', { \n      email, \n      redirect: false,\n      redirectTo: `/app/teams/${teamId}?lang=${lang}`,\n    })\n  } catch (e) {\n    // signIn throws a redirect error but the email is sent\n    // We can safely ignore this\n  }\n}\n\nexport async function inviteMember(teamId: string, email: string) {\n  const session = await auth()\n  \n  if (!session?.user?.id) {\n    throw new Error(\"Not authenticated\")\n  }\n\n  // Fetch inviter's language\n  const inviter = await prisma.user.findUnique({\n    where: { id: session.user.id },\n    select: { language: true }\n  })\n  const inviterLang = (inviter?.language as 'de' | 'en') || 'de'\n\n  // Check if user is captain of the team\n  const membership = await prisma.paddler.findFirst({\n    where: {\n      userId: session.user.id,\n      teamId: teamId,\n      role: \"CAPTAIN\",\n    },\n  })\n\n  if (!membership) {\n    throw new Error(\"Not authorized\")\n  }\n\n  // Get team info\n  const team = await prisma.team.findUnique({\n    where: { id: teamId },\n  })\n\n  if (!team) {\n    throw new Error(\"Team not found\")\n  }\n\n  // Find user by email to check if they are already a member\n  const userToInvite = await prisma.user.findUnique({\n    where: { email },\n  })\n\n  // Check if user is already a member\n  if (userToInvite) {\n    const existingMember = await prisma.paddler.findFirst({\n      where: {\n        userId: userToInvite.id,\n        teamId: teamId,\n      },\n    })\n\n    if (existingMember) {\n      throw new Error(\"USER_ALREADY_MEMBER\")\n    }\n  }\n\n  // Check if already invited by email (pending invite)\n  const existingInvite = await prisma.paddler.findFirst({\n    where: {\n      inviteEmail: email,\n      teamId: teamId,\n      // Ensure we don't count fully linked members (userId not null) as pending invites here\n      // But typically inviteEmail is cleared when linked.\n    },\n  })\n\n  if (existingInvite) {\n    throw new Error(\"EMAIL_ALREADY_INVITED\")\n  }\n\n  // Create placeholder paddler with invite email (PENDING STATE)\n  // We do NOT set userId here, even if userToInvite exists.\n  // This forces the user to confirm via email link (auth.ts handles the linking).\n  await prisma.paddler.create({\n    data: {\n      name: userToInvite?.name || email.split(\"@\")[0], // Suggest name but don't link identity yet\n      weight: userToInvite?.weight || 0, // Use user's weight if known, otherwise 0\n      inviteEmail: email,\n      inviteLanguage: inviterLang, // Save language preference\n      teamId: teamId,\n      role: \"PADDLER\",\n      skills: [],\n    },\n  })\n\n  // Send invite email with magic link\n  try {\n    await sendTeamInviteEmail(email, team.name, team.id, session.user.name || undefined, inviterLang)\n  } catch (e) {\n    console.error(\"Failed to send invite email:\", e)\n  }\n}\n\nexport async function linkPaddlerToAccount(paddlerId: string, email: string) {\n  const session = await auth()\n  \n  if (!session?.user?.id) {\n    throw new Error(\"Not authenticated\")\n  }\n\n  // Fetch inviter's language\n  const inviter = await prisma.user.findUnique({\n    where: { id: session.user.id },\n    select: { language: true }\n  })\n  const inviterLang = (inviter?.language as 'de' | 'en') || 'de'\n\n  // Get the paddler\n  const paddler = await prisma.paddler.findUnique({\n    where: { id: paddlerId },\n    include: { team: true }\n  })\n\n  if (!paddler || !paddler.teamId) {\n    throw new Error(\"Paddler not found\")\n  }\n\n  // Check if user is captain of the team\n  const membership = await prisma.paddler.findFirst({\n    where: {\n      userId: session.user.id,\n      teamId: paddler.teamId,\n      role: \"CAPTAIN\",\n    },\n  })\n\n  if (!membership) {\n    throw new Error(\"Not authorized\")\n  }\n\n  // Check if paddler is already linked\n  if (paddler.userId) {\n    throw new Error(\"PADDLER_ALREADY_LINKED\")\n  }\n\n  // Find user by email\n  const existingUser = await prisma.user.findUnique({\n    where: { email },\n  })\n\n  if (existingUser) {\n    // Check if this user is already a member of the team\n    const existingMember = await prisma.paddler.findFirst({\n      where: {\n        userId: existingUser.id,\n        teamId: paddler.teamId,\n      },\n    })\n\n    if (existingMember) {\n      throw new Error(\"USER_ALREADY_MEMBER\")\n    }\n\n    // Link paddler to existing user - BUT AS PENDING INVITE\n    // We do NOT connect userId yet, and do NOT update name/weight yet.\n    // Auth.ts will handle this upon sign-in.\n    await prisma.paddler.update({\n      where: { id: paddlerId },\n      data: {\n        // user: { connect: { id: existingUser.id } }, // REMOVED to enforce pending state\n        inviteEmail: email, // Set invite email so auth.ts sends TeamInviteEmail\n        inviteLanguage: inviterLang, // Save language preference\n        // name: existingUser.name || paddler.name, // REMOVED - sync later\n        // weight: existingUser.weight || paddler.weight, // REMOVED - sync later\n      },\n    })\n\n    // Notify existing user about joining the team\n    if (paddler.team) {\n      try {\n        await sendTeamInviteEmail(email, paddler.team.name, paddler.team.id, session.user.name || undefined, inviterLang)\n      } catch (e) {\n        console.error(\"Failed to send invite email:\", e)\n      }\n    }\n\n    return { linked: true, userExists: true }\n  } else {\n    // Create new user account with paddler's data\n    const newUser = await prisma.user.create({\n      data: {\n        email: email,\n        name: paddler.name,\n        weight: paddler.weight > 0 ? paddler.weight : null,\n      },\n    })\n\n    // Link paddler to new user\n    await prisma.paddler.update({\n      where: { id: paddlerId },\n      data: {\n        userId: newUser.id,\n        inviteEmail: email, // Set invite email for auth.ts\n        inviteLanguage: inviterLang, // Save language preference\n      },\n    })\n\n    // Send invite email with magic link\n    if (paddler.team) {\n      try {\n        await sendTeamInviteEmail(email, paddler.team.name, paddler.team.id, session.user.name || undefined, inviterLang)\n      } catch (e) {\n        console.error(\"Failed to send invitation email:\", e)\n      }\n    }\n\n    return { linked: true, userExists: false, emailSent: true }\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/actions/user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/admin/dashboard/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Loader2' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'session' is assigned a value but never used.","line":45,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'t' is assigned a value but never used.","line":47,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStats'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [status, router, fetchStats]","fix":{"range":[2098,2114],"text":"[status, router, fetchStats]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { Loader2, Users, Tent, Calendar, Ship, Home, Mail, TrendingUp } from 'lucide-react';\nimport Header from '@/components/ui/Header';\nimport Footer from '@/components/ui/Footer';\nimport PageTransition from '@/components/ui/PageTransition';\nimport DragonLogo from '@/components/ui/DragonLogo';\nimport Link from 'next/link';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\n\nimport { Monitor, Send } from 'lucide-react'; // Add missing icons\n\ninterface DashboardStats {\n  counts: {\n    users: number;\n    teams: number;\n    events: number;\n    paddlers: number;\n    openInvites: number;\n    activeSessions: number;\n    sentEmails: number;\n  };\n  recent: {\n    teams: { id: string; name: string; createdAt: string }[];\n    events: { id: string; team: { name: string } | null; createdAt: string }[];\n    users: { id: string; name: string | null; email: string | null; createdAt: string }[];\n  };\n  history: {\n    teams: {\n        days: { date: string; count: number }[];\n        months: { date: string; count: number }[];\n    };\n    users: {\n        days: { date: string; count: number }[];\n        months: { date: string; count: number }[];\n    };\n  };\n}\n\nexport default function AdminDashboard() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const { t } = useLanguage();\n  const [stats, setStats] = useState<DashboardStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  \n  // Independent resolution states\n  const [teamResolution, setTeamResolution] = useState<'days' | 'months'>('days');\n  const [userResolution, setUserResolution] = useState<'days' | 'months'>('days');\n\n  useEffect(() => {\n    if (status === 'unauthenticated') {\n      router.push('/login');\n    } else if (status === 'authenticated') {\n      fetchStats();\n    }\n  }, [status, router]);\n\n  const fetchStats = async () => {\n    try {\n      setLoading(true);\n      // No query param needed anymore, API returns all data\n      const res = await fetch('/api/admin/stats');\n      if (!res.ok) {\n        if (res.status === 403 || res.status === 401) {\n            router.push('/app');\n            return;\n        }\n        throw new Error('Failed to fetch stats');\n      }\n      const data = await res.json();\n      setStats(data);\n    } catch (err) {\n      setError('Error loading dashboard');\n      console.error(err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900 text-red-500\">\n        {error}\n      </div>\n    );\n  }\n\n  return (\n    <PageTransition>\n      <div className=\"min-h-screen font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300 bg-slate-100 dark:bg-slate-950 p-2 md:p-4 pb-20\">\n        <div className=\"max-w-7xl mx-auto\">\n          <Header \n            title=\"Admin Dashboard\"\n            logo={\n                <Link href=\"/app\" className=\"cursor-pointer hover:opacity-80 transition-opacity\">\n                  <DragonLogo className=\"w-10 h-10\" />\n                </Link>\n            }\n            leftAction={\n                <button \n                  onClick={() => router.push('/app')} \n                  className=\"p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-500 hover:text-blue-600 hover:border-blue-300 transition-colors\"\n                  aria-label=\"Back to App\"\n                >\n                  <Home size={20} />\n                </button>\n            }\n          />\n          \n          {(loading || status === 'loading') ? (\n            <DashboardSkeleton />\n          ) : (\n            <div className=\"space-y-8\">\n              {/* Stats Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                <StatsCard \n                  label=\"Total Users\" \n                  value={stats?.counts.users} \n                  icon={<Users className=\"w-6 h-6 text-blue-500\" />} \n                />\n                <StatsCard \n                  label=\"Total Teams\" \n                  value={stats?.counts.teams} \n                  icon={<Ship className=\"w-6 h-6 text-indigo-500\" />} \n                />\n                <StatsCard \n                  label=\"Total Events\" \n                  value={stats?.counts.events} \n                  icon={<Calendar className=\"w-6 h-6 text-pink-500\" />} \n                />\n                <StatsCard \n                  label=\"Total Paddlers\" \n                  value={stats?.counts.paddlers} \n                  icon={<Tent className=\"w-6 h-6 text-emerald-500\" />} \n                />\n                <StatsCard \n                  label=\"Open Invites\" \n                  value={stats?.counts.openInvites} \n                  icon={<Mail className=\"w-6 h-6 text-amber-500\" />} \n                />\n                <StatsCard \n                  label=\"Active Sessions\" \n                  value={stats?.counts.activeSessions} \n                  icon={<Monitor className=\"w-6 h-6 text-teal-500\" />} \n                />\n                <StatsCard \n                  label=\"Sent Emails\" \n                  value={stats?.counts.sentEmails} \n                  icon={<Send className=\"w-6 h-6 text-purple-500\" />} \n                />\n              </div>\n\n              {/* Growth Charts */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Team Growth */}\n                <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6\">\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <div className=\"flex items-center gap-2\">\n                        <TrendingUp className=\"w-5 h-5 text-indigo-500\" />\n                        <h2 className=\"text-lg font-semibold text-slate-800 dark:text-slate-100\">\n                        Team Growth\n                        </h2>\n                    </div>\n                    <div className=\"flex bg-slate-100 dark:bg-slate-900 rounded-lg p-1\">\n                        <button\n                            onClick={() => setTeamResolution('days')}\n                            className={`text-xs font-medium px-3 py-1 rounded-md transition-colors ${teamResolution === 'days' ? 'bg-white dark:bg-slate-800 text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\n                        >\n                            30D\n                        </button>\n                        <button\n                            onClick={() => setTeamResolution('months')}\n                            className={`text-xs font-medium px-3 py-1 rounded-md transition-colors ${teamResolution === 'months' ? 'bg-white dark:bg-slate-800 text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\n                        >\n                            6M\n                        </button>\n                    </div>\n                  </div>\n                  <div className=\"h-64 w-full\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={stats?.history.teams[teamResolution]}>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#E2E8F0\" />\n                        <XAxis \n                          dataKey=\"date\" \n                          tickFormatter={(value) => {\n                            const date = new Date(value);\n                            if (teamResolution === 'months') {\n                                return date.toLocaleDateString('default', { month: 'short' });\n                            }\n                            return date.toLocaleDateString('default', { day: '2-digit', month: '2-digit' });\n                          }}\n                          axisLine={false}\n                          tickLine={false}\n                          tick={{ fill: '#64748B', fontSize: 12 }}\n                          dy={10}\n                          minTickGap={30}\n                        />\n                        <YAxis \n                          axisLine={false}\n                          tickLine={false}\n                          tick={{ fill: '#64748B', fontSize: 12 }}\n                          allowDecimals={false}\n                        />\n                        <Tooltip \n                          contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\n                          cursor={{ fill: 'transparent' }}\n                          labelFormatter={(value) => new Date(value).toLocaleDateString()}\n                        />\n                        <Bar dataKey=\"count\" fill=\"#6366F1\" radius={[4, 4, 0, 0]} />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                </div>\n\n                {/* User Growth */}\n                <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6\">\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <div className=\"flex items-center gap-2\">\n                        <TrendingUp className=\"w-5 h-5 text-blue-500\" />\n                        <h2 className=\"text-lg font-semibold text-slate-800 dark:text-slate-100\">\n                        User Growth\n                        </h2>\n                    </div>\n                    <div className=\"flex bg-slate-100 dark:bg-slate-900 rounded-lg p-1\">\n                        <button\n                            onClick={() => setUserResolution('days')}\n                            className={`text-xs font-medium px-3 py-1 rounded-md transition-colors ${userResolution === 'days' ? 'bg-white dark:bg-slate-800 text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\n                        >\n                            30D\n                        </button>\n                        <button\n                            onClick={() => setUserResolution('months')}\n                            className={`text-xs font-medium px-3 py-1 rounded-md transition-colors ${userResolution === 'months' ? 'bg-white dark:bg-slate-800 text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}\n                        >\n                            6M\n                        </button>\n                    </div>\n                  </div>\n                  <div className=\"h-64 w-full\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart data={stats?.history.users[userResolution]}>\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#E2E8F0\" />\n                        <XAxis \n                          dataKey=\"date\" \n                           tickFormatter={(value) => {\n                            const date = new Date(value);\n                             if (userResolution === 'months') {\n                                return date.toLocaleDateString('default', { month: 'short' });\n                            }\n                            return date.toLocaleDateString('default', { day: '2-digit', month: '2-digit' });\n                          }}\n                          axisLine={false}\n                          tickLine={false}\n                          tick={{ fill: '#64748B', fontSize: 12 }}\n                          dy={10}\n                          minTickGap={30}\n                        />\n                        <YAxis \n                          axisLine={false}\n                          tickLine={false}\n                          tick={{ fill: '#64748B', fontSize: 12 }}\n                          allowDecimals={false}\n                        />\n                         <Tooltip \n                          contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\n                          cursor={{ fill: 'transparent' }}\n                          labelFormatter={(value) => new Date(value).toLocaleDateString()}\n                        />\n                        <Bar dataKey=\"count\" fill=\"#3B82F6\" radius={[4, 4, 0, 0]} />\n                      </BarChart>\n                    </ResponsiveContainer>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Recent Teams */}\n                <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6\">\n                  <h2 className=\"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4\">\n                    Recent Teams\n                  </h2>\n                  <div className=\"space-y-4\">\n                    {stats?.recent.teams.map((team) => (\n                      <div key={team.id} className=\"flex justify-between items-center py-2 border-b border-slate-100 dark:border-slate-700 last:border-0\">\n                        <span className=\"font-medium text-slate-700 dark:text-slate-300\">{team.name}</span>\n                        <span className=\"text-xs text-slate-400\">\n                          {new Date(team.createdAt).toLocaleDateString()}\n                        </span>\n                      </div>\n                    ))}\n                    {stats?.recent.teams.length === 0 && (\n                      <p className=\"text-sm text-slate-500\">No teams found.</p>\n                    )}\n                  </div>\n                </div>\n\n                {/* Recent Events */}\n                <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6\">\n                  <h2 className=\"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4\">\n                    Recent Events\n                  </h2>\n                  <div className=\"space-y-4\">\n                    {stats?.recent.events.map((event) => (\n                      <div key={event.id} className=\"flex justify-between items-center py-2 border-b border-slate-100 dark:border-slate-700 last:border-0\">\n                        <span className=\"font-medium text-slate-700 dark:text-slate-300\">\n                          {event.team?.name || 'Unknown Team'}\n                        </span>\n                        <span className=\"text-xs text-slate-400\">\n                          {new Date(event.createdAt).toLocaleDateString()}\n                        </span>\n                      </div>\n                    ))}\n                    {stats?.recent.events.length === 0 && (\n                      <p className=\"text-sm text-slate-500\">No events found.</p>\n                    )}\n                  </div>\n                </div>\n\n                 {/* Recent Users */}\n                <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6\">\n                  <div className=\"flex items-center gap-2 mb-6\">\n                    <Users className=\"w-5 h-5 text-blue-500\" />\n                    <h2 className=\"text-lg font-semibold text-slate-800 dark:text-slate-100\">\n                      Recent Users\n                    </h2>\n                  </div>\n                  <div className=\"space-y-4\">\n                    {stats?.recent.users.map((user) => (\n                      <div key={user.id} className=\"flex items-start justify-between pb-4 border-b border-slate-100 dark:border-slate-700 last:border-0 last:pb-0\">\n                        <div>\n                          <p className=\"font-medium text-slate-800 dark:text-slate-100\">\n                            {user.name || 'Unnamed User'}\n                          </p>\n                          <p className=\"text-sm text-slate-500\">\n                            {user.email}\n                          </p>\n                        </div>\n                        <span className=\"text-xs text-slate-400\">\n                          {new Date(user.createdAt).toLocaleDateString()}\n                        </span>\n                      </div>\n                    ))}\n                    {stats?.recent.users.length === 0 && (\n                      <p className=\"text-sm text-slate-500\">No users found.</p>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n          \n          <Footer />\n        </div>\n      </div>\n    </PageTransition>\n  );\n}\n\nfunction DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8 animate-pulse\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {[...Array(5)].map((_, i) => (\n          <div key={i} className=\"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm border border-slate-200 dark:border-slate-700 h-24\"></div>\n        ))}\n      </div>\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {[...Array(2)].map((_, i) => (\n           <div key={i} className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 h-80\"></div>\n        ))}\n      </div>\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {[...Array(3)].map((_, i) => (\n           <div key={i} className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 h-64\"></div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction StatsCard({ label, value, icon }: { label: string, value: number | undefined, icon: React.ReactNode }) {\n  return (\n    <div className=\"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm border border-slate-200 dark:border-slate-700 flex items-center space-x-4\">\n      <div className=\"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg\">\n        {icon}\n      </div>\n      <div>\n        <p className=\"text-sm font-medium text-slate-500 dark:text-slate-400\">{label}</p>\n        <p className=\"text-2xl font-bold text-slate-800 dark:text-slate-100\">\n            {value !== undefined ? value.toLocaleString() : '-'}\n        </p>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/admin/stats/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'req' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2160,2163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2160,2163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '@/auth';\nimport prisma from '@/lib/prisma';\n\nexport async function GET(req: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session?.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const adminEmails = process.env.ADMIN_EMAILS?.split(',').map(e => e.trim()) || [];\n    if (!adminEmails.includes(session.user.email)) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    // Calculate start dates\n    const sixMonthsAgo = new Date();\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n    sixMonthsAgo.setDate(1);\n\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    const [\n      userCount,\n      teamCount,\n      eventCount,\n      paddlerCount,\n      openInviteCount,\n      activeSessionCount,\n      sentEmailCount,\n      recentTeams,\n      recentEvents,\n      recentUsers,\n      historicalTeams,\n      historicalUsers\n    ] = await Promise.all([\n      prisma.user.count(),\n      prisma.team.count(),\n      prisma.event.count(),\n      prisma.paddler.count(),\n      prisma.paddler.count({ where: { inviteEmail: { not: null } } }),\n      prisma.session.count({ where: { expires: { gt: new Date() } } }),\n      prisma.sentEmail.count(),\n      prisma.team.findMany({\n        take: 5,\n        orderBy: { createdAt: 'desc' },\n        select: { id: true, name: true, createdAt: true }\n      }),\n      prisma.event.findMany({\n        take: 5,\n        orderBy: { createdAt: 'desc' },\n        include: { team: { select: { name: true } } },\n      }),\n      prisma.user.findMany({\n        take: 5,\n        orderBy: { createdAt: 'desc' },\n        select: { id: true, name: true, email: true, createdAt: true }\n      }),\n      prisma.team.findMany({\n        where: { createdAt: { gte: sixMonthsAgo } },\n        select: { createdAt: true }\n      }),\n      prisma.user.findMany({\n        where: { createdAt: { gte: sixMonthsAgo } },\n        select: { createdAt: true }\n      })\n    ]);\n\n    // Aggregate helper\n    const aggregate = (items: any[], dateKey: string, type: 'days' | 'months') => {\n      const counts: { [key: string]: number } = {};\n      \n      if (type === 'months') {\n          for (let i = 5; i >= 0; i--) {\n            const d = new Date();\n            d.setMonth(d.getMonth() - i);\n            const key = d.toISOString().slice(0, 7);\n            counts[key] = 0;\n          }\n      } else {\n          for (let i = 29; i >= 0; i--) {\n              const d = new Date();\n              d.setDate(d.getDate() - i);\n              const key = d.toISOString().slice(0, 10);\n              counts[key] = 0;\n          }\n      }\n\n      items.forEach(item => {\n        const dateVal = item[dateKey];\n        if (!dateVal) return;\n        \n        const date = new Date(dateVal);\n        // Filter based on resolution range logic\n        if (type === 'days' && date < thirtyDaysAgo) return;\n        if (type === 'months' && date < sixMonthsAgo) return;\n\n        const key = date.toISOString().slice(0, type === 'months' ? 7 : 10);\n        if (counts[key] !== undefined) counts[key]++;\n      });\n\n      return Object.entries(counts)\n        .sort((a, b) => a[0].localeCompare(b[0]))\n        .map(([date, count]) => ({ date, count }));\n    };\n\n    return NextResponse.json({\n      counts: {\n        users: userCount,\n        teams: teamCount,\n        events: eventCount,\n        paddlers: paddlerCount,\n        openInvites: openInviteCount,\n        activeSessions: activeSessionCount,\n        sentEmails: sentEmailCount\n      },\n      recent: {\n        teams: recentTeams,\n        events: recentEvents,\n        users: recentUsers\n      },\n      history: {\n        teams: {\n            days: aggregate(historicalTeams, 'createdAt', 'days'),\n            months: aggregate(historicalTeams, 'createdAt', 'months')\n        },\n        users: {\n            days: aggregate(historicalUsers, 'createdAt', 'days'),\n            months: aggregate(historicalUsers, 'createdAt', 'months')\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Admin Stats Error:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/auth/[...nextauth]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/autofill/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Paddler' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3790,3793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3790,3793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { runAutoFillAlgorithm } from '@/utils/algorithm';\nimport { Paddler } from '@/types';\nimport { auth } from '@/auth';\n\nexport async function POST(request: Request) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const { eventId, assignments: assignmentsOverride, lockedSeats, targetTrim } = await request.json();\n\n    if (!eventId) {\n      return NextResponse.json({ error: 'Missing eventId' }, { status: 400 });\n    }\n\n    // Fetch Event with all necessary data\n    const event = await prisma.event.findUnique({\n      where: { id: eventId },\n      include: {\n        attendances: {\n          include: {\n            paddler: true\n          }\n        },\n        assignments: true\n      }\n    });\n\n    if (!event) {\n      return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n    }\n\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: event.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership || membership.role !== 'CAPTAIN') {\n      return NextResponse.json({ error: 'Unauthorized: Only captains can use auto-fill' }, { status: 403 });\n    }\n\n    // Determine config\n    const rows = event.boatSize === 'small' ? 5 : 10;\n    \n    // Construct Active Paddler Pool\n    // 1. Regular Paddlers & Guests (from attendance)\n    // Filter: status is 'yes' or 'maybe' (assuming maybe should be included? Planner does.)\n    // Wait, Planner logic was: \n    // const regular = paddlers.filter((p) => !p.isCanister && ['yes', 'maybe'].includes(activeEvent.attendance[p.id]));\n    \n    // We iterate attendances\n    const attendees = event.attendances\n      .filter(a => ['yes', 'maybe'].includes(a.status))\n      .map(a => {\n        const p = a.paddler;\n         // Normalize skills into valid skills array for algorithm\n         const algoSkills: string[] = [];\n         // side is removed from model, so we only rely on skills\n         \n         if (p.skills) {\n           p.skills.forEach(s => algoSkills.push(s)); // drum, steer, stroke, steer_preferred\n        }\n\n        // Priority mapping: yes=1, maybe=2\n        // Guests usually have 'yes' status if they are in the list effectively, \n        // but we can distinguish by isGuest flag if needed. \n        // Requirement: Fixed > Maybe > Guest > Canister\n        let priority = 1; // Default Fixed\n        if (a.status === 'maybe') priority = 2;\n        if (p.isGuest) priority = 3; // Guests lower than members? \"feste zusagen werden vor vieleichts, gästen und kanistern bevorzugt\" -> Yes (1) > Maybe (2) > Guest (3) ? \n        // Actually \"feste zusagen\" (Fixed) > Maybe. \n        // \"Guests\" are usually fixed commitments too, just external. \n        // Let's interpret: Member(Yes)=1, Guest(Yes)=1 (or 1.5?), Member(Maybe)=2, Guest(Maybe)=2. \n        // User said: \"feste zusagen werden vor vieleichts, gästen und kanistern bevorzugt\"\n        // This implies: Fixed Promises > Maybes, Guests, Canisters.\n        // Wait, \"Fixed > Maybe, Guest, Canister\" could mean Fixed is top, rest is lower.\n        // Or Fixed > Maybe > Guest > Canister.\n        // Let's assume:\n        // 1. Member Yes\n        // 2. Member Maybe\n        // 3. Guest (Any, usually Yes)\n        // 4. Canister\n        \n        if (p.isGuest) priority = 3;\n        else if (a.status === 'maybe') priority = 2;\n        else priority = 1;\n\n        return {\n          id: p.id,\n          name: p.name,\n          weight: p.weight,\n          skills: algoSkills,\n          isGuest: p.isGuest,\n          isCanister: false,\n          priority\n        };\n      });\n\n    // 2. Canisters\n    const canisters: any[] = [];\n    const count = event.canisterCount || 0;\n    for (let i = 1; i <= count; i++) {\n        canisters.push({\n            id: `canister-${i}`,\n            name: 'Kanister',\n            weight: 25,\n            skills: ['left', 'right'],\n            isCanister: true,\n            priority: 4 // Lowest priority\n        });\n    }\n\n    const activePaddlerPool = [...attendees, ...canisters].sort((a, b) => {\n        // Sort by priority first\n        if (a.priority !== b.priority) return a.priority - b.priority;\n        // Then by name\n        return a.name.localeCompare(b.name);\n    });\n\n    // Determine Assignments\n    let assignments = assignmentsOverride;\n    if (!assignments) {\n      assignments = {};\n      let canisterCounter = 1;\n      event.assignments.forEach((a) => {\n        if (a.isCanister) {\n          assignments[a.seatId] = `canister-${canisterCounter}`;\n          canisterCounter++;\n        } else if (a.paddlerId) {\n          assignments[a.seatId] = a.paddlerId;\n        }\n      });\n    }\n\n    // Run Algorithm\n    // Default lockedSeats to empty if not provided\n    const locks = lockedSeats || [];\n    // Default targetTrim to 0 if not provided\n    const trim = targetTrim !== undefined ? targetTrim : 0;\n\n    const result = runAutoFillAlgorithm(activePaddlerPool, assignments, locks, trim, rows);\n\n    return NextResponse.json({ assignments: result });\n\n  } catch (error) {\n    console.error('Auto-fill error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/contact/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":41,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { auth } from '@/auth';\nimport { sendEmail } from '@/lib/email';\nimport ContactEmail from '@/emails/templates/ContactEmail';\n\nexport async function POST(req: Request) {\n  const session = await auth();\n  \n  if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  const body = await req.json();\n  const { category, message, name, email } = body;\n\n  if (!message || !category) {\n      return NextResponse.json({ error: 'Missing fields' }, { status: 400 });\n  }\n\n  const senderName = name || session.user.name || 'Anonymous';\n  const senderEmail = email || session.user.email || 'no-reply@drachenbootmanager.de';\n\n  try {\n    const result = await sendEmail({\n        to: 'jan@janhartje.com',\n        subject: `[Drachenboot] ${category}: ${senderName}`,\n        replyTo: senderEmail,\n        react: ContactEmail({ \n            name: senderName, \n            email: senderEmail, \n            category, \n            message \n        }),\n    });\n\n    if (!result.success) {\n        throw new Error(result.error as string);\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n      return NextResponse.json({ error: 'Failed to send email' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/[id]/assignments/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1962,1965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1962,1965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const eventId = id;\n\n    // Fetch event to check team ownership\n    const event = await prisma.event.findUnique({\n      where: { id: eventId },\n      select: { teamId: true }\n    });\n\n    if (!event?.teamId) {\n      return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n    }\n\n    // Check if user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: event.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership || membership.role !== 'CAPTAIN') {\n      return NextResponse.json({ error: 'Unauthorized: Only captains can modify assignments' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const assignments = body.assignments; // Record<seatId, paddlerId>\n\n    // Use a transaction to replace assignments\n    await prisma.$transaction(async (tx) => {\n      // 1. Delete all existing assignments for this event\n      await tx.assignment.deleteMany({\n        where: { eventId },\n      });\n\n      // 2. Create new assignments\n      // 2. Create new assignments\n      const createPromises = Object.entries(assignments).map(([seatId, paddlerId]) => {\n        if (!paddlerId) return null; // Skip empty assignments\n\n        const pidStr = String(paddlerId);\n        const isCanister = pidStr.startsWith('canister-');\n        \n        return tx.assignment.create({\n          data: {\n            eventId,\n            seatId,\n            paddlerId: isCanister ? null : pidStr,\n            isCanister,\n          },\n        });\n      }).filter((p): p is any => p !== null);\n\n      await Promise.all(createPromises);\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: 'Failed to save assignments' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/[id]/attendance/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":43,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const eventId = id;\n    \n    // Fetch event to check team ownership\n    const event = await prisma.event.findUnique({\n      where: { id: eventId },\n      select: { teamId: true }\n    });\n\n    if (!event?.teamId) {\n      return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n    }\n\n    // Check if user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: event.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\n    }\n\n    let body;\n    try {\n      body = await request.json();\n    } catch (e) {\n      return NextResponse.json({ error: 'Invalid request body' }, { status: 400 });\n    }\n\n    const { paddlerId, status } = body;\n\n    // Security Check: Only Captains can update others\n    if (membership.role !== 'CAPTAIN' && String(paddlerId) !== membership.id) {\n      return NextResponse.json({ error: 'Unauthorized: You can only update your own attendance' }, { status: 403 });\n    }\n\n    const attendance = await prisma.attendance.upsert({\n      where: {\n        eventId_paddlerId: {\n          eventId,\n          paddlerId: String(paddlerId),\n        },\n      },\n      update: { status },\n      create: {\n        eventId,\n        paddlerId: String(paddlerId),\n        status,\n      },\n    });\n\n    return NextResponse.json(attendance);\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: 'Failed to update attendance' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/[id]/canisters/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/[id]/guests/[guestId]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/[id]/guests/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/[id]/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":53,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const eventId = id;\n    \n    // Fetch event to check team ownership\n    const existingEvent = await prisma.event.findUnique({\n      where: { id: eventId },\n      select: { teamId: true }\n    });\n\n    if (!existingEvent?.teamId) {\n      return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n    }\n\n    // Check if user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: existingEvent.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership || membership.role !== 'CAPTAIN') {\n      return NextResponse.json({ error: 'Unauthorized: Only captains can update events' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const event = await prisma.event.update({\n      where: { id: eventId },\n      data: {\n        title: body.title,\n        date: body.date ? new Date(body.date) : undefined,\n        comment: body.comment,\n        type: body.type,\n        boatSize: body.boatSize,\n        canisterCount: body.canisterCount,\n      },\n    });\n    return NextResponse.json(event);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to update event' }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const eventId = id;\n\n    // Fetch event to check team ownership\n    const existingEvent = await prisma.event.findUnique({\n      where: { id: eventId },\n      select: { teamId: true }\n    });\n\n    if (!existingEvent?.teamId) {\n      return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n    }\n\n    // Check if user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: existingEvent.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership || membership.role !== 'CAPTAIN') {\n      return NextResponse.json({ error: 'Unauthorized: Only captains can delete events' }, { status: 403 });\n    }\n\n    // Use transaction to delete guests and then the event\n    await prisma.$transaction(async (tx) => {\n      // 1. Find all guests for this event\n      // Guests are paddlers with isGuest=true AND an attendance for this event\n      // However, guests are created specifically for an event.\n      // We can find them by looking at Attendance where eventId matches and paddler.isGuest is true.\n      \n      const guestAttendances = await tx.attendance.findMany({\n        where: { \n          eventId,\n          paddler: { isGuest: true }\n        },\n        include: { paddler: true }\n      });\n\n      const guestIds = guestAttendances.map(a => a.paddlerId);\n\n      // 2. Delete the event first? No, foreign key constraints might block if we don't delete children first.\n      // But Attendance has onDelete: Cascade usually.\n      // The issue is the Paddler record itself.\n      \n      // If we delete the event, the Attendance records are deleted (Cascade).\n      // But the Paddler records (Guests) remain.\n      \n      // So we must delete the Guest Paddlers.\n      if (guestIds.length > 0) {\n        await tx.paddler.deleteMany({\n          where: { id: { in: guestIds } }\n        });\n      }\n\n      // 3. Delete the event\n      await tx.event.delete({\n        where: { id: eventId },\n      });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Failed to delete event:', error);\n    return NextResponse.json({ error: 'Failed to delete event' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/events/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":97,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function GET(request: Request) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  const { searchParams } = new URL(request.url);\n  const teamId = searchParams.get('teamId');\n\n  try {\n    if (teamId) {\n      const membership = await prisma.paddler.findFirst({\n        where: {\n          teamId,\n          userId: session.user.id,\n        },\n      });\n\n      if (!membership) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\n      }\n    } else {\n      // If no teamId, return empty or filter by user's teams\n      // For now, let's return empty array if no teamId is provided, as events are usually fetched per team\n      // Or we can fetch all events for all teams the user is in\n      const userTeams = await prisma.paddler.findMany({\n        where: { userId: session.user.id },\n        select: { teamId: true },\n      });\n      const teamIds = userTeams.map(t => t.teamId).filter(Boolean) as string[];\n      \n      if (teamIds.length === 0) {\n        return NextResponse.json([]);\n      }\n    }\n\n    const where = teamId \n      ? { teamId } \n      : { \n          teamId: { \n            in: (await prisma.paddler.findMany({\n              where: { userId: session.user.id },\n              select: { teamId: true }\n            })).map(p => p.teamId).filter(Boolean) as string[]\n          } \n        };\n\n    const events = await prisma.event.findMany({\n      where,\n      include: {\n        attendances: {\n          include: {\n            paddler: true\n          }\n        },\n        assignments: true,\n      },\n      orderBy: { date: 'asc' },\n    });\n\n    // Check permissions\n    const teamIdsToCheck = Array.from(new Set(events.map(e => e.teamId).filter(Boolean) as string[]));\n    const requesterMemberships = await prisma.paddler.findMany({\n      where: {\n        userId: session.user.id,\n        teamId: { in: teamIdsToCheck }\n      },\n      select: { teamId: true, role: true }\n    });\n    const roleMap = new Map<string, string>();\n    requesterMemberships.forEach(m => { if (m.teamId) roleMap.set(m.teamId, m.role); });\n\n    const eventsWithGuests = events.map(event => {\n      const isCaptain = event.teamId && roleMap.get(event.teamId) === 'CAPTAIN';\n      \n      const guests = event.attendances\n        .filter(a => a.paddler && a.paddler.isGuest)\n        .map(a => {\n          const p = a.paddler;\n          if (!isCaptain) {\n            return { ...p, weight: 0 };\n          }\n          return p;\n        });\n      \n      return {\n        ...event,\n        guests\n      };\n    });\n\n    return NextResponse.json(eventsWithGuests);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to fetch events' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const body = await request.json();\n    \n    // Verify user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: body.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership || membership.role !== 'CAPTAIN') {\n      return NextResponse.json({ error: 'Unauthorized: Only captains can create events' }, { status: 403 });\n    }\n\n    const event = await prisma.event.create({\n      data: {\n        title: body.title,\n        date: new Date(body.date),\n        comment: body.comment,\n        type: body.type || 'training',\n        boatSize: body.boatSize || 'standard',\n        teamId: body.teamId,\n      },\n    });\n    return NextResponse.json(event);\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: 'Failed to create event' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/paddlers/[id]/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":89,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":89,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    // Fetch paddler to check team ownership\n    const existingPaddler = await prisma.paddler.findUnique({\n      where: { id },\n      select: { teamId: true }\n    });\n\n    if (!existingPaddler?.teamId) {\n      return NextResponse.json({ error: 'Paddler not found' }, { status: 404 });\n    }\n\n    // Check if user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: existingPaddler.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    \n    // Authorization Logic\n    const isCaptain = membership.role === 'CAPTAIN';\n    const isSelfUpdate = membership.id === id;\n\n    if (!isCaptain) {\n        if (!isSelfUpdate) {\n             return NextResponse.json({ error: 'Unauthorized - Only Captains can edit other members' }, { status: 403 });\n        }\n        // If self-update, prevent modifying sensitive fields like 'role'\n        // Using 'delete' on body (any) or destructing\n        delete body.role; \n    }\n\n    const paddler = await prisma.paddler.update({\n      where: { id },\n      data: {\n        name: body.name,\n        weight: body.weight,\n\n        skills: body.skills,\n        isGuest: body.isGuest,\n        role: body.role, // Will be undefined if deleted above, Prisma ignores undefined in update\n      },\n    });\n\n    // If the paddler is linked to a user, sync changes to the user profile and other paddler entries\n    if (paddler.userId) {\n      // Update User profile\n      await prisma.user.update({\n        where: { id: paddler.userId },\n        data: {\n          name: paddler.name,\n          weight: paddler.weight,\n        },\n      });\n\n      // Update other Paddler records for this user\n      await prisma.paddler.updateMany({\n        where: { \n          userId: paddler.userId,\n          id: { not: paddler.id } \n        },\n        data: {\n          name: paddler.name,\n          weight: paddler.weight,\n        },\n      });\n    }\n    return NextResponse.json(paddler);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to update paddler' }, { status: 500 });\n  }\n}\n\nimport { sendEmail } from '@/lib/email';\nimport TeamRemovalEmail from '@/emails/templates/TeamRemovalEmail';\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    // Fetch paddler to be deleted with necessary relations for checks and email\n    const targetPaddler = await prisma.paddler.findUnique({\n      where: { id },\n      include: { \n        team: true,\n        user: true \n      }\n    });\n\n    if (!targetPaddler || !targetPaddler.teamId) {\n      return NextResponse.json({ error: 'Paddler not found' }, { status: 404 });\n    }\n\n    // Check if the requester is a member of the team\n    const requesterMembership = await prisma.paddler.findFirst({\n      where: {\n        teamId: targetPaddler.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!requesterMembership) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\n    }\n\n    // LOGIC SPLIT: Leaving vs Removing\n    const isSelfDelete = targetPaddler.userId === session.user.id;\n\n    if (isSelfDelete) {\n      // --- LEAVE TEAM ---\n      // Captains cannot leave directly\n      if (targetPaddler.role === 'CAPTAIN') {\n        return NextResponse.json({ \n          error: 'CAPTAIN_CANNOT_LEAVE',\n          message: 'Captains cannot leave the team. Promote another captain or delete the team.' \n        }, { status: 403 });\n      }\n      // Allowed to leave\n    } else {\n      // --- REMOVE MEMBER ---\n      // Only Captains can remove others\n      if (requesterMembership.role !== 'CAPTAIN') {\n        return NextResponse.json({ error: 'Unauthorized - Only Captains can remove members' }, { status: 403 });\n      }\n\n      // Send Notification Email\n      const targetEmail = targetPaddler.user?.email || targetPaddler.inviteEmail;\n      \n      if (targetEmail && targetPaddler.team) {\n        try {\n          // Use inviteLanguage or default to 'de'\n          const lang = (targetPaddler.inviteLanguage as 'de' | 'en') || 'de';\n          \n          await sendEmail({\n            to: targetEmail,\n            subject: lang === 'en' ? 'You have been removed from the team' : 'Du wurdest aus dem Team entfernt',\n            react: TeamRemovalEmail({ \n              teamName: targetPaddler.team.name, \n              userName: targetPaddler.name,\n              lang\n            })\n          });\n        } catch (e) {\n          console.error(\"Failed to send removal email:\", e);\n          // Don't block deletion if email fails\n        }\n      }\n    }\n\n    await prisma.paddler.delete({\n      where: { id },\n    });\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: 'Failed to delete paddler' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/paddlers/route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'roleMap' is never reassigned. Use 'const' instead.","line":16,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":16,"endColumn":16,"fix":{"range":[421,461],"text":"const roleMap = new Map<string, string>();"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2115,2118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2115,2118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":78,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":115,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":17}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function GET(request: Request) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  const { searchParams } = new URL(request.url);\n  const teamId = searchParams.get('teamId');\n\n  try {\n    let paddlers;\n    let roleMap = new Map<string, string>();\n\n    // OPTIMIZATION: Parallelize fetches\n    if (teamId) {\n      const [membership, fetchedPaddlers] = await Promise.all([\n        prisma.paddler.findFirst({\n          where: { teamId, userId: session.user.id },\n          select: { role: true }\n        }),\n        prisma.paddler.findMany({\n          where: { teamId },\n          orderBy: { name: 'asc' },\n          include: {\n            user: { select: { email: true, name: true, image: true } }\n          }\n        })\n      ]);\n\n      if (!membership) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\n      }\n      \n      paddlers = fetchedPaddlers;\n      roleMap.set(teamId, membership.role);\n\n    } else {\n      // Logic for multi-team fetch\n      // 1. Get user's team IDs\n      const userMemberships = await prisma.paddler.findMany({\n         where: { userId: session.user.id },\n         select: { teamId: true, role: true }\n      });\n      \n      const teamIds = userMemberships.map((m: { teamId: string | null }) => m.teamId).filter(Boolean) as string[];\n      \n      if (teamIds.length === 0) return NextResponse.json([]);\n\n      userMemberships.forEach((m: { teamId: string | null, role: string }) => {\n          if (m.teamId) roleMap.set(m.teamId, m.role);\n      });\n\n      // 2. Fetch all paddlers in these teams\n      paddlers = await prisma.paddler.findMany({\n        where: { teamId: { in: teamIds } },\n        orderBy: { name: 'asc' },\n        include: {\n            user: { select: { email: true, name: true, image: true } }\n        }\n      });\n    }\n\n    // Redact weight if not CAPTAIN and not own record\n    const redactedPaddlers = paddlers.map((p: any) => {\n      const requesterRole = p.teamId ? roleMap.get(p.teamId) : null;\n      const isOwnRecord = p.userId === session.user.id;\n      if (requesterRole !== 'CAPTAIN' && !isOwnRecord) {\n        return { ...p, weight: 0 }; \n      }\n      return p;\n    });\n\n    return NextResponse.json(redactedPaddlers);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to fetch paddlers' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: Request) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const body = await request.json();\n\n    // Verify user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: body.teamId,\n        userId: session.user.id,\n      },\n    });\n\n    if (!membership || membership.role !== 'CAPTAIN') {\n      return NextResponse.json({ error: 'Unauthorized: Only captains can add members' }, { status: 403 });\n    }\n\n    const paddler = await prisma.paddler.create({\n      data: {\n        name: body.name,\n        weight: body.weight,\n\n        skills: body.skills,\n        isGuest: body.isGuest || false,\n        teamId: body.teamId,\n      },\n    });\n    return NextResponse.json(paddler);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to create paddler' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/stats/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[615,618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[615,618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[861,864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[861,864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1934,1937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1934,1937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2290,2293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2290,2293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function POST(request: Request) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const { eventId, assignments: assignmentsOverride, targetTrim } = await request.json();\n\n    if (!eventId) {\n      return NextResponse.json({ error: 'Missing eventId' }, { status: 400 });\n    }\n\n    // Determine active assignments and IDs to fetch\n    let assignments = assignmentsOverride;\n    let event: any = null;\n    let paddlers: { id: string, weight: number }[] = [];\n    let rows = 10;\n\n    if (assignments) {\n      // OPTIMIZATION: Parallel Fetch if we have assignments\n      const paddlerIds = Object.values(assignments)\n        .filter((id: any) => typeof id === 'string' && !id.startsWith('canister-')) as string[];\n\n      const [eventResult, paddlersResult] = await Promise.all([\n        prisma.event.findUnique({\n          where: { id: eventId },\n          select: { boatSize: true } // Only fetch what we need\n        }),\n        prisma.paddler.findMany({\n          where: { id: { in: paddlerIds } },\n          select: { id: true, weight: true }\n        })\n      ]);\n\n      if (!eventResult) return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n      \n      rows = eventResult.boatSize === 'small' ? 5 : 10;\n      paddlers = paddlersResult;\n\n    } else {\n      // Fallback: Sequential fetch if we need assignments from DB\n      event = await prisma.event.findUnique({\n        where: { id: eventId },\n        include: { assignments: true }\n      });\n\n      if (!event) return NextResponse.json({ error: 'Event not found' }, { status: 404 });\n\n      rows = event.boatSize === 'small' ? 5 : 10;\n      \n      assignments = {};\n      let canisterCounter = 1;\n      event.assignments.forEach((a: any) => {\n        if (a.isCanister) {\n          assignments[a.seatId] = `canister-${canisterCounter}`;\n          canisterCounter++;\n        } else if (a.paddlerId) {\n          assignments[a.seatId] = a.paddlerId;\n        }\n      });\n\n      // Now fetch weights for these assignments\n      const paddlerIds = Object.values(assignments)\n        .filter((id: any) => typeof id === 'string' && !id.startsWith('canister-')) as string[];\n      \n      paddlers = await prisma.paddler.findMany({\n        where: { id: { in: paddlerIds } },\n        select: { id: true, weight: true }\n      });\n    }\n\n    // 2. Map weights\n    const weightMap = new Map<string, number>();\n    paddlers.forEach(p => weightMap.set(p.id, p.weight));\n\n    // 3. Calculation Logic (Duplicated from PlannerView but authoritative)\n    let l = 0, r = 0, t = 0, f = 0, b = 0, c = 0;\n    const mid = (rows + 1) / 2;\n    let weightedSumX = 0, weightedSumY = 0;\n\n    // Assignment loop\n    Object.entries(assignments).forEach(([sid, pid]) => {\n      const seatId = sid as string;\n      const paddlerId = pid as string;\n      \n      // Filter out seats outside current row count\n      if (seatId.includes('row')) {\n        const match = seatId.match(/row-(\\d+)/);\n        if (match && parseInt(match[1]) > rows) return;\n      }\n\n      let weight = 0;\n      if (paddlerId.startsWith('canister-')) {\n        weight = 25;\n      } else {\n        weight = weightMap.get(paddlerId) || 0;\n      }\n\n      if (weight > 0) {\n        c++;\n        t += weight;\n\n        // --- Standard Stats ---\n        if (seatId === 'drummer') {\n          f += weight;\n        } else if (seatId === 'steer') {\n          b += weight;\n        } else if (seatId.includes('row')) {\n          if (seatId.includes('left')) l += weight; else r += weight;\n          const match = seatId.match(/row-(\\d+)/);\n          if (match) {\n            const rowNum = parseInt(match[1]);\n            if (rowNum < mid) f += weight;\n            else if (rowNum > mid) b += weight;\n          }\n        }\n\n        // --- CG Stats ---\n        let xPos = 50; if (seatId.includes('left')) xPos = 25; else if (seatId.includes('right')) xPos = 75;\n        \n        // Y Position Logic (matching BoatVisualizer approx)\n        const totalHeight = 316 + rows * 68;\n        const row1Center = 188;\n        const rowLastCenter = 188 + (rows - 1) * 68;\n        const yStart = (row1Center / totalHeight) * 100;\n        const yEnd = (rowLastCenter / totalHeight) * 100;\n        \n        let yPos = 50; \n        if (seatId === 'drummer') yPos = (100 / totalHeight) * 100; \n        else if (seatId === 'steer') yPos = ((totalHeight - 100) / totalHeight) * 100; \n        else if (seatId.includes('row')) { \n          const match = seatId.match(/row-(\\d+)/); \n          if (match) { \n            const r = parseInt(match[1]); \n            if (rows > 1) {\n              const rowStep = (yEnd - yStart) / (rows - 1); \n              yPos = yStart + (r - 1) * rowStep;\n            } else {\n              yPos = yStart;\n            }\n          } \n        } \n        \n        weightedSumX += weight * xPos; \n        weightedSumY += weight * yPos;\n      }\n    });\n\n    const cgX = t > 0 ? weightedSumX / t : 50;\n    const cgY = t > 0 ? weightedSumY / t : 50;\n    \n    // Calculate targetY based on trim input\n    // PlannerView: return { x: cgX, y: cgY, targetY: 50 - targetTrim * 0.1 };\n    const targetY = 50 - (targetTrim || 0) * 0.1;\n\n    return NextResponse.json({\n      stats: { l, r, t, diffLR: l - r, f, b, diffFB: f - b, c },\n      cgStats: { x: cgX, y: cgY, targetY }\n    });\n\n  } catch (error) {\n    console.error('Stats Calc Error', error);\n    return NextResponse.json({ error: 'Calculation failed' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/teams/[id]/import/events/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1052,1055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1052,1055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\nimport { parseEventDateTime } from '@/utils/importUtils';\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id: teamId } = await params;\n\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      include: {\n        paddlers: {\n          where: { teamId },\n        },\n      },\n    });\n\n    const isCaptain = user?.paddlers[0]?.role === 'CAPTAIN';\n    \n    if (!isCaptain) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { events } = body;\n\n    if (!Array.isArray(events)) {\n      return NextResponse.json({ error: 'Invalid data format' }, { status: 400 });\n    }\n\n    const eventsToCreate = events.map((e: any) => {\n      // Use centralized date/time parsing utility\n      const eventDate = parseEventDateTime(\n        e.date || e.Date,\n        e.time || e.Time\n      );\n\n      return {\n        title: e.title || e.Title,\n        date: eventDate,\n        type: e.type || e.Type || 'training',\n        boatSize: e.boatSize || e.BoatSize || 'standard',\n        comment: e.comment || e.Comment || null,\n        teamId: teamId,\n      };\n    });\n\n    const result = await prisma.event.createMany({\n      data: eventsToCreate,\n    });\n\n    return NextResponse.json({ count: result.count }, { status: 201 });\n\n  } catch (error) {\n    console.error('Error importing events:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/teams/[id]/import/paddlers/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1216,1219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1216,1219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1256,1259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1256,1259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":116,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth, signIn } from '@/auth';\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id: teamId } = await params;\n\n    // Verify team membership/ownership and get inviter language\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      include: {\n        paddlers: {\n          where: { teamId },\n        },\n      },\n    });\n\n    const isCaptain = user?.paddlers[0]?.role === 'CAPTAIN';\n    const inviterLang = (user?.language as 'de' | 'en') || 'de';\n    \n    // Allow if captain\n    if (!isCaptain) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { paddlers } = body;\n\n    if (!Array.isArray(paddlers)) {\n      return NextResponse.json({ error: 'Invalid data format' }, { status: 400 });\n    }\n\n    // Separate paddlers into batch (no email) and invite (with email)\n    const paddlersToBatch: any[] = [];\n    const paddlersToInvite: any[] = [];\n\n    for (const p of paddlers) {\n      let skillsArray: string[] = [];\n      if (Array.isArray(p.skills)) {\n          skillsArray = p.skills;\n      } else if (typeof p.skills === 'string') {\n          // Split by comma and trim\n          skillsArray = p.skills.split(',').map((s: string) => s.trim().toLowerCase()).filter(Boolean);\n      }\n      // Also check legacy 'side' if present and valid\n      if (p.side && typeof p.side === 'string') {\n          const sides = p.side.split(',').map((s: string) => s.trim().toLowerCase());\n          skillsArray = [...skillsArray, ...sides];\n      }\n      // Deduplicate\n      skillsArray = Array.from(new Set(skillsArray));\n\n      const paddlerData = {\n        name: p.name,\n        weight: parseFloat(p.weight) || 0,\n\n        skills: skillsArray,\n        teamId: teamId,\n      };\n\n      if (p.inviteEmail && typeof p.inviteEmail === 'string' && p.inviteEmail.includes('@')) {\n        const inviteData = {\n           ...paddlerData,\n           inviteEmail: p.inviteEmail.trim(),\n           inviteLanguage: inviterLang\n        };\n        paddlersToInvite.push(inviteData);\n      } else {\n        paddlersToBatch.push(paddlerData);\n      }\n    }\n\n    // 1. Create paddlers without email (individually to avoid PostgreSQL array issues with createMany)\n    let count = 0;\n    for (const paddlerData of paddlersToBatch) {\n      try {\n        await prisma.paddler.create({\n          data: paddlerData,\n        });\n        count++;\n      } catch (dbError) {\n        console.error(\"Failed to import paddler:\", paddlerData.name, dbError);\n        // Continue with next paddler\n      }\n    }\n\n    // 2. Create and Invite those with email\n    // We do this individually to handle the invite flow\n    for (const p of paddlersToInvite) {\n      // Check if already invited or member? \n      // Ideally we should check strict duplicates but for import we trust constraints or let it fail?\n      // Prisma create will throw if unique constraint fails (none on inviteEmail usually unless enforced?)\n      // Actually inviteEmail is not unique. Only userId + teamId is unique.\n      // So we can have multiple pending invites? No, logic usually prevents.\n      // We will try create.\n      try {\n        await prisma.paddler.create({ data: p });\n        count++;\n\n        // Send invite\n        try {\n          await signIn(\"resend\", {\n            email: p.inviteEmail,\n            redirect: false,\n            redirectTo: `/app/teams/${teamId}?lang=${inviterLang}`,\n          });\n        } catch (err) {\n          // signIn throws redirect error on success in some versions, or we just catch it.\n          // We ignore it to continue the loop.\n        }\n      } catch (dbError) {\n        console.error(\"Failed to import individual paddler:\", p.name, dbError);\n        // Continue with next\n      }\n    }\n\n    return NextResponse.json({ count }, { status: 201 });\n  } catch (error) {\n    console.error('Error importing paddlers:', error);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/teams/[id]/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":43,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { auth } from '@/auth';\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    // Check if user is a member of the team\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: id,\n        userId: session.user.id,\n        role: 'CAPTAIN',\n      },\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { name, website, icon, instagram, facebook, twitter, email } = body;\n\n    // Check payload size (approximate)\n    const payloadSize = JSON.stringify(body).length;\n    if (payloadSize > 5 * 1024 * 1024) { // 5MB limit\n      return NextResponse.json({ error: 'Payload too large (max 5MB)' }, { status: 413 });\n    }\n\n    const team = await prisma.team.update({\n      where: { id },\n      data: { name, website, icon, instagram, facebook, twitter, email },\n    });\n    return NextResponse.json(team);\n  } catch (error) {\n    return NextResponse.json({ error: 'Failed to update team' }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const session = await auth();\n  if (!session?.user?.id) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    // Check if user is a member of the team (ideally CAPTAIN role)\n    const membership = await prisma.paddler.findFirst({\n      where: {\n        teamId: id,\n        userId: session.user.id,\n        role: 'CAPTAIN', // Only captains can delete teams\n      },\n    });\n\n    if (!membership) {\n      return NextResponse.json({ error: 'Unauthorized - Only team captains can delete teams' }, { status: 403 });\n    }\n\n    // Manually delete related records first to ensure cascade works\n    // Delete assignments first (they depend on paddlers and events)\n    await prisma.assignment.deleteMany({\n      where: {\n        event: {\n          teamId: id\n        }\n      }\n    });\n\n    // Delete attendances\n    await prisma.attendance.deleteMany({\n      where: {\n        event: {\n          teamId: id\n        }\n      }\n    });\n\n    // Delete events\n    await prisma.event.deleteMany({\n      where: { teamId: id }\n    });\n\n    // Delete paddlers\n    await prisma.paddler.deleteMany({\n      where: { teamId: id }\n    });\n\n    // Finally delete the team\n    await prisma.team.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting team:', error);\n    return NextResponse.json({ \n      error: 'Failed to delete team', \n      details: error instanceof Error ? error.message : 'Unknown error' \n    }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/teams/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/api/user/preferences/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/app/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/app/planner/[eventId]/page.tsx","messages":[{"ruleId":"@next/next/no-async-client-component","severity":1,"message":"Prevent Client Components from being async functions. See: https://nextjs.org/docs/messages/no-async-client-component","line":11,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":14,"endColumn":2}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport PlannerView from '@/components/drachenboot/PlannerView';\n\ninterface PlannerPageProps {\n  params: Promise<{\n    eventId: string;\n  }>;\n}\n\nexport default async function PlannerPage({ params }: PlannerPageProps) {\n    const { eventId } = await params;\n    return <PlannerView eventId={eventId} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/app/planner/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/app/teams/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1486,1489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1486,1489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/janhartje/drachenbootplan/src/app/app/teams/[id]/page.tsx:39:9\n  37 |     if (teams.length > 0) {\n  38 |       if (team) {\n> 39 |         setIsLoading(false);\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  40 |       } else {\n  41 |         // Team not found, redirect\n  42 |         router.push('/app/teams');","line":39,"column":9,"nodeType":null,"endLine":39,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2028,2031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2028,2031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, use } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useDrachenboot } from '@/context/DrachenbootContext';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { ArrowLeft, Trash2, AlertTriangle, Shield, ShieldAlert, UserMinus } from 'lucide-react';\nimport Header from '@/components/ui/Header';\nimport Footer from '@/components/ui/Footer';\nimport DragonLogo from '@/components/ui/DragonLogo';\nimport TeamSettingsForm from '@/components/drachenboot/team/TeamSettingsForm';\nimport { InviteMemberForm } from '@/components/drachenboot/team/InviteMemberForm';\nimport { HelpModal, AlertModal, ConfirmModal } from '@/components/ui/Modals';\nimport PageTransition from '@/components/ui/PageTransition';\n\nexport default function TeamDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const { id } = use(params);\n  const router = useRouter();\n  const { teams, updateTeam, deleteTeam, isDarkMode, toggleDarkMode, paddlers, updatePaddler, deletePaddler, refetchPaddlers, userRole, isDataLoading } = useDrachenboot();\n  const { t } = useLanguage();\n  \n  const [isLoading, setIsLoading] = useState(true);\n  const [deleteConfirm, setDeleteConfirm] = useState(false);\n  const [activeTab, setActiveTab] = useState<'general' | 'members'>('general');\n  const [alertMessage, setAlertMessage] = useState<string | null>(null);\n  const [memberToRemove, setMemberToRemove] = useState<any>(null);\n\n  const team = teams.find(t => t.id === id);\n\n  // Filter for actual users (members) of this team, including pending invites\n  const members = paddlers.filter(p => p.teamId === id && (p.userId || p.inviteEmail));\n\n  const [showHelp, setShowHelp] = useState(false);\n\n  useEffect(() => {\n    if (teams.length > 0) {\n      if (team) {\n        setIsLoading(false);\n      } else {\n        // Team not found, redirect\n        router.push('/app/teams');\n      }\n    }\n  }, [teams, team, router, id]);\n\n  const handleSave = async (data: any) => {\n    if (team) {\n      await updateTeam(team.id, data);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (team) {\n      await deleteTeam(team.id);\n      router.push('/app/teams');\n    }\n  };\n\n  const handleRoleChange = async (paddlerId: string | number, newRole: 'CAPTAIN' | 'PADDLER') => {\n    // Prevent removing the last captain\n    if (newRole === 'PADDLER') {\n      const captains = members.filter(m => m.role === 'CAPTAIN');\n      if (captains.length <= 1 && captains[0].id === paddlerId) {\n        setAlertMessage(t('cannotRemoveLastCaptain') || 'Cannot remove the last captain');\n        return;\n      }\n    }\n    updatePaddler(paddlerId, { role: newRole });\n  };\n\n  const confirmRemoveMember = async () => {\n    if (memberToRemove) {\n      await deletePaddler(memberToRemove.id);\n      await refetchPaddlers();\n      setMemberToRemove(null);\n    }\n  };\n\n  if (isLoading || isDataLoading || !team) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-950\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Permission Check\n  if (userRole !== 'CAPTAIN') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-950 p-4\">\n        <div className=\"text-center max-w-md w-full p-8 bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800\">\n          <ShieldAlert size={48} className=\"mx-auto text-red-500 mb-4\" />\n          <h1 className=\"text-xl font-bold text-slate-800 dark:text-slate-200 mb-2\">\n            {t('accessDenied') || 'Access Denied'}\n          </h1>\n          <p className=\"text-slate-600 dark:text-slate-400 mb-6\">\n            {t('onlyCaptainsCanEditTeam') || 'Only team captains can edit team settings and manage members.'}\n          </p>\n          <Link \n            href=\"/app\" \n            className=\"inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\n          >\n            {t('backToDashboard') || 'Back to Dashboard'}\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <PageTransition>\n    <div className=\"min-h-screen font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300 bg-slate-100 dark:bg-slate-950 p-2 md:p-4 pb-20\">\n      <div className=\"max-w-6xl mx-auto\">\n        <Header\n          title={t('editTeam') || 'Edit Team'}\n          logo={\n            <Link href=\"/\" className=\"cursor-pointer hover:opacity-80 transition-opacity\">\n              <DragonLogo className=\"w-10 h-10\" />\n            </Link>\n          }\n          leftAction={\n            <button \n              onClick={() => router.push('/app/teams')} \n              className=\"p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-500 hover:text-blue-600 hover:border-blue-300 transition-colors\"\n            >\n              <ArrowLeft size={20} />\n            </button>\n          }\n          showThemeToggle={true}\n          isDarkMode={isDarkMode}\n          toggleDarkMode={toggleDarkMode}\n          showHelp={true}\n          onHelp={() => setShowHelp(true)}\n        />\n\n        <div className=\"bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden flex flex-col min-h-[600px]\">\n          <div className=\"flex border-b border-slate-200 dark:border-slate-800\">\n            <button\n              onClick={() => setActiveTab('general')}\n              className={`flex-1 py-4 text-sm font-medium transition-colors border-b-2 ${\n                activeTab === 'general'\n                  ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/10'\n                  : 'border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800/50'\n              }`}\n            >\n              {t('general') || 'General'}\n            </button>\n            <button\n              onClick={() => setActiveTab('members')}\n              className={`flex-1 py-4 text-sm font-medium transition-colors border-b-2 ${\n                activeTab === 'members'\n                  ? 'border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/10'\n                  : 'border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800/50'\n              }`}\n            >\n              {t('members') || 'Members'}\n            </button>\n          </div>\n\n          <div className=\"p-6\">\n            {activeTab === 'general' ? (\n              <div className=\"space-y-8\">\n                <div>\n                  <h3 className=\"text-lg font-medium text-slate-800 dark:text-slate-200 mb-4\">\n                    {t('generalSettings') || 'General Settings'}\n                  </h3>\n                  <TeamSettingsForm \n                    initialData={team} \n                    onSave={handleSave}\n                    t={t}\n                  />\n                </div>\n\n                <div className=\"pt-6 border-t border-slate-200 dark:border-slate-800\">\n                  <h3 className=\"text-lg font-medium text-slate-800 dark:text-slate-200 mb-2\">\n                    {t('dangerZone') || 'Danger Zone'}\n                  </h3>\n                  <div className=\"bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/30 rounded-lg p-4\">\n                    <div className=\"flex items-start gap-3 mb-4\">\n                      <AlertTriangle size={20} className=\"text-red-500 shrink-0 mt-0.5\" />\n                      <div>\n                        <h4 className=\"font-medium text-red-800 dark:text-red-400\">\n                          {t('deleteTeam') || 'Delete Team'}\n                        </h4>\n                        <p className=\"text-sm text-red-600 dark:text-red-300/80 mt-1\">\n                          {t('deleteTeamWarning') || 'Deleting a team will permanently remove all its paddlers and events. This action cannot be undone.'}\n                        </p>\n                      </div>\n                    </div>\n                    \n                    <button\n                      onClick={() => setDeleteConfirm(true)}\n                      className=\"px-4 py-2 border border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg font-medium transition-colors flex items-center gap-2\"\n                    >\n                      <Trash2 size={18} />\n                      <span>{t('deleteTeam') || 'Delete Team'}</span>\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-8\">\n                <div>\n                  <h3 className=\"text-lg font-medium text-slate-800 dark:text-slate-200 mb-4\">\n                    {t('inviteMembers') || 'Invite Members'}\n                  </h3>\n                  <InviteMemberForm teamId={team.id} onSuccess={refetchPaddlers} />\n                </div>\n                \n                <div className=\"pt-6 border-t border-slate-200 dark:border-slate-800\">\n                  <h3 className=\"text-lg font-medium text-slate-800 dark:text-slate-200 mb-4\">\n                    {t('teamMembers') || 'Team Members'}\n                  </h3>\n                  <div className=\"space-y-3\">\n                    {members.map(member => (\n                      <div key={member.id} className=\"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800\">\n                        <div className=\"flex items-center gap-4\">\n                          <div className=\"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 font-bold text-sm overflow-hidden\">\n                            {member.user?.image ? (\n                              <img src={member.user.image} alt={member.name} className=\"w-full h-full object-cover\" />\n                            ) : (\n                              member.name.charAt(0).toUpperCase()\n                            )}\n                          </div>\n                          <div>\n                            <p className=\"font-medium text-slate-900 dark:text-slate-100\">{member.name}</p>\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400 flex items-center gap-2\">\n                              {member.role === 'CAPTAIN' ? (t('captain') || 'Captain') : (t('paddler') || 'Paddler')}\n                              {!member.userId && member.inviteEmail && (\n                                <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 border border-amber-200 dark:border-amber-800\">\n                                  {t('pending')}\n                                </span>\n                              )}\n                            </p>\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          <button\n                            onClick={() => handleRoleChange(member.id, member.role === 'CAPTAIN' ? 'PADDLER' : 'CAPTAIN')}\n                            className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors font-medium text-sm border shadow-sm ${\n                              member.role === 'CAPTAIN'\n                                ? 'bg-white border-slate-200 text-slate-700 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-700'\n                                : 'bg-white border-slate-200 text-slate-700 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-700'\n                            }`}\n                            title={member.role === 'CAPTAIN' ? (t('demoteToPaddler') || 'Demote to Paddler') : (t('promoteToCaptain') || 'Promote to Captain')}\n                          >\n                            {member.role === 'CAPTAIN' ? (\n                              <>\n                                <ShieldAlert size={16} className=\"text-amber-500\" />\n                                <span className=\"hidden sm:inline\">{t('demote') || 'Demote'}</span>\n                              </>\n                            ) : (\n                              <>\n                                <Shield size={16} className=\"text-blue-500\" />\n                                <span className=\"hidden sm:inline\">{t('promote') || 'Promote'}</span>\n                              </>\n                            )}\n                          </button>\n\n                          <button\n                            onClick={() => setMemberToRemove(member)}\n                            className=\"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors font-medium text-sm border shadow-sm bg-white border-red-200 text-red-600 hover:bg-red-50 dark:bg-slate-800 dark:border-red-900/30 dark:text-red-400 dark:hover:bg-red-900/20\"\n                            title={t('removeMember')}\n                          >\n                            <UserMinus size={16} />\n                            <span className=\"hidden sm:inline\">{t('removeMember')}</span>\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                    \n                    {members.length === 0 && (\n                      <div className=\"text-center py-8 bg-slate-50 dark:bg-slate-800/30 rounded-lg border border-dashed border-slate-200 dark:border-slate-800\">\n                        <p className=\"text-slate-500 dark:text-slate-400\">\n                          {t('noMembersFound') || 'No members found.'}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <Footer />\n        \n        {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}\n        \n        <AlertModal\n          isOpen={!!alertMessage}\n          message={alertMessage || ''}\n          onClose={() => setAlertMessage(null)}\n          type=\"warning\"\n        />\n\n        <ConfirmModal\n          isOpen={!!memberToRemove}\n          title={t('confirmRemoveMemberTitle')}\n          message={t('confirmRemoveMemberBody')}\n          confirmLabel={t('confirmRemoveMemberButton')}\n          isDestructive={true}\n          onCancel={() => setMemberToRemove(null)}\n          onConfirm={confirmRemoveMember}\n        />\n\n        <ConfirmModal\n          isOpen={deleteConfirm}\n          title={t('deleteTeam')}\n          message={t('deleteTeamWarning')}\n          confirmLabel={t('confirmDelete')}\n          isDestructive={true}\n          onCancel={() => setDeleteConfirm(false)}\n          onConfirm={handleDelete}\n        />\n      </div>\n    </div>\n    </PageTransition>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/app/teams/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/docs/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'t' is assigned a value but never used.","line":16,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport SwaggerUI from 'swagger-ui-react';\nimport 'swagger-ui-react/swagger-ui.css';\nimport './swagger.css';\nimport Header from '@/components/ui/Header';\nimport Footer from '@/components/ui/Footer';\nimport { Home } from 'lucide-react';\nimport { useRouter } from 'next/navigation';\nimport { useLanguage } from '@/context/LanguageContext';\nimport PageTransition from '@/components/ui/PageTransition';\n\nconst DocsPage = () => {\n  const router = useRouter();\n  const { t } = useLanguage();\n  const [spec, setSpec] = React.useState<object | null>(null);\n\n  React.useEffect(() => {\n    fetch('/openapi.json')\n      .then((res) => res.json())\n      .then((data) => {\n        // Inject dynamic server URL from environment variable\n        if (process.env.NEXT_PUBLIC_SERVER_URL) {\n          data.servers = [{ url: process.env.NEXT_PUBLIC_SERVER_URL }];\n        }\n        setSpec(data);\n      })\n      .catch((err) => console.error('Failed to load OpenAPI spec', err));\n  }, []);\n\n  return (\n    <PageTransition>\n    <div className=\"min-h-screen font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300 bg-slate-100 dark:bg-slate-950 p-2 md:p-4 pb-20\">\n      <div className=\"max-w-6xl mx-auto\">\n        <Header\n          title=\"API Documentation\"\n          subtitle=\"Swagger UI\"\n          leftAction={\n            <button onClick={() => router.push('/')} className=\"p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-500 hover:text-blue-600 hover:border-blue-300 transition-colors\">\n              <Home size={20} />\n            </button>\n          }\n          showHelp={false}\n          showThemeToggle={false}\n          showLanguageToggle={false}\n        />\n        \n        <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\n          {spec ? <SwaggerUI spec={spec} /> : <div className=\"p-8 text-center text-slate-500\">Loading API Spec...</div>}\n        </div>\n\n        <Footer />\n      </div>\n    </div>\n    </PageTransition>\n  );\n};\n\nexport default DocsPage;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/help/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Users' is defined but never used.","line":6,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":6,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":6,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":11,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":307,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":307,"endColumn":27}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React from 'react'\nimport { useLanguage } from '@/context/LanguageContext'\nimport { useRouter } from 'next/navigation'\nimport { ChevronLeft, HelpCircle, Users, Calendar, Settings, Send } from 'lucide-react'\nimport Link from 'next/link'\n\nexport default function HelpPage() {\n  const { t } = useLanguage()\n  const router = useRouter()\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 pb-20\">\n      {/* Header */}\n      <header className=\"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-10\">\n        <div className=\"max-w-3xl mx-auto px-4 h-16 flex items-center gap-4\">\n          <Link href=\"/app\" className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors\">\n            <ChevronLeft className=\"w-6 h-6 text-slate-600 dark:text-slate-400\" />\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <HelpCircle className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n            <h1 className=\"text-xl font-bold text-slate-900 dark:text-white\">{t('helpCenterTitle') || 'Help Center'}</h1>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-3xl mx-auto px-4 py-8 space-y-8\">\n        \n        {/* Intro */}\n        <section className=\"bg-blue-600 dark:bg-blue-700 rounded-2xl p-8 text-white shadow-lg\">\n          <h2 className=\"text-2xl font-bold mb-2\">{t('helpIntroTitle') || 'How can we help you?'}</h2>\n          <p className=\"text-blue-100\">{t('helpIntroDesc') || 'Here you find guides and answers to common questions.'}</p>\n        </section>\n\n        {/* Guides */}\n        <section>\n          <h2 className=\"text-xl font-bold text-slate-900 dark:text-white mb-6\">{t('helpGuidesTitle') || 'User Guides'}</h2>\n          \n          <div className=\"space-y-4\">\n            \n            {/* Planner Guide */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <div className=\"flex items-center gap-3\">\n                    <span className=\"bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300 p-2 rounded-lg\">🚣</span>\n                    <h3 className=\"font-bold text-slate-900 dark:text-white\">{t('helpCategoryPlanner')}</h3>\n                 </div>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-6 space-y-6\">\n                  \n                  {/* Boat Manning */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpBoatManning')}</h4>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li>{t('helpBoatManning1')}</li>\n                      <li>{t('helpBoatManning2')}</li>\n                      <li>{t('helpBoatManningSwap')}</li>\n                      <li>{t('helpBoatManning3')}</li>\n                      <li>{t('helpBoatManning4')}</li>\n                    </ul>\n                  </div>\n\n                  {/* Calculation */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpCalculation')}</h4>\n                    <p className=\"mb-2\">{t('helpCalculationDesc')}</p>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li>{t('helpCalculation1')}</li>\n                      <li>{t('helpCalculation2')}</li>\n                      <li>{t('helpCalculation3')}</li>\n                    </ul>\n                  </div>\n\n                  {/* Special Items */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpSpecialItems')}</h4>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li><span className=\"font-bold\">{t('canister')}:</span> {t('helpSpecialItems1')}</li>\n                      <li><span className=\"font-bold\">{t('guest')}:</span> {t('helpSpecialItems2')}</li>\n                    </ul>\n                  </div>\n\n                  {/* Tools */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpToolsStats')}</h4>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li><span className=\"font-bold\">Magic KI:</span> {t('helpToolsStats1')}</li>\n                      <li><span className=\"font-bold\">Trimm:</span> {t('helpToolsStats2')}</li>\n                      <li><span className=\"font-bold\">Export:</span> {t('helpToolsStats3')}</li>\n                    </ul>\n                  </div>\n\n                   {/* Boat Size */}\n                   <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpBoatSize')}</h4>\n                    <p>{t('helpBoatSizeDesc')}</p>\n                  </div>\n\n               </div>\n            </details>\n\n            {/* Team Admin Guide */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <div className=\"flex items-center gap-3\">\n                    <span className=\"bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-400 p-2 rounded-lg\">⚙️</span>\n                    <h3 className=\"font-bold text-slate-900 dark:text-white\">{t('helpCategoryTeam')}</h3>\n                 </div>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-6 space-y-6\">\n                  \n                  {/* General Settings */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpTeamEditGeneral')}</h4>\n                    <p className=\"mb-2\">{t('helpTeamEditGeneralDesc')}</p>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li>{t('helpTeamEditGeneral1')}</li>\n                      <li>{t('helpTeamEditGeneral2')}</li>\n                      <li>{t('helpTeamEditGeneral3')}</li>\n                    </ul>\n                  </div>\n\n                  {/* Member Management */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpTeamEditMembers')}</h4>\n                    <p className=\"mb-2\">{t('helpTeamEditMembersDesc')}</p>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li>{t('helpTeamEditMembers1')}</li>\n                      <li>{t('helpTeamEditMembers2')}</li>\n                      <li>{t('helpTeamEditMembers3')}</li>\n                    </ul>\n                  </div>\n\n                  {/* Import Data */}\n                  <div>\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpImportTitle')}</h4>\n                    <p className=\"mb-2\">{t('helpImportDesc')}</p>\n                    <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li>{t('helpImport1')}</li>\n                      <li>{t('helpImport2')}</li>\n                      <li>{t('helpImport3')}</li>\n                    </ul>\n                  </div>\n               </div>\n            </details>\n\n            {/* Dashboard Guide */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <div className=\"flex items-center gap-3\">\n                    <span className=\"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 p-2 rounded-lg\">📅</span>\n                    <h3 className=\"font-bold text-slate-900 dark:text-white\">{t('helpManageEvents')}</h3>\n                 </div>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-6 space-y-6\">\n                   <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                      <li>{t('helpManageEvents1')}</li>\n                      <li>{t('helpManageEvents2')}</li>\n                      <li>{t('helpManageEvents3')}</li>\n                   </ul>\n                   <div>\n                      <h4 className=\"font-bold text-slate-900 dark:text-white mb-2\">{t('helpMembers')}</h4>\n                      <ul className=\"list-disc list-inside space-y-1 ml-1\">\n                        <li>{t('helpMembers1')}</li>\n                        <li>{t('helpMembers2')}</li>\n                        <li>{t('helpMembers3')}</li>\n                      </ul>\n                   </div>\n               </div>\n            </details>\n\n          </div>\n        </section>\n\n        {/* FAQs */}\n        <section>\n          <h2 className=\"text-xl font-bold text-slate-900 dark:text-white mb-6\">{t('helpFAQTitle') || 'Frequently Asked Questions'}</h2>\n          \n          <div className=\"space-y-4\">\n            \n            {/* FAQ: Leaving Team */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <h3 className=\"font-bold text-slate-900 dark:text-white pr-4\">{t('faqLeaveTeamTitle')}</h3>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-4\">\n                 <p>{t('faqLeaveTeamAnswer')}</p>\n                 <ol className=\"list-decimal list-inside mt-2 space-y-1 ml-2\">\n                   <li>{t('faqLeaveTeamStep1')}</li>\n                   <li>{t('faqLeaveTeamStep2')}</li>\n                 </ol>\n               </div>\n            </details>\n\n            {/* FAQ: Missing Leave Button */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <h3 className=\"font-bold text-slate-900 dark:text-white pr-4\">{t('faqNoLeaveButtonTitle')}</h3>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-4\">\n                  <div className=\"flex items-start gap-3 bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg text-amber-800 dark:text-amber-200 mb-2\">\n                    <span className=\"font-bold\">⚠️ {t('faqNoLeaveButtonWarning')}</span>\n                  </div>\n                  <p>{t('faqNoLeaveButtonAnswer')}</p>\n               </div>\n            </details>\n\n             {/* FAQ: Create Team */}\n             <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <h3 className=\"font-bold text-slate-900 dark:text-white pr-4\">{t('faqCreateTeamTitle')}</h3>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-4\">\n                  <p>{t('faqCreateTeamAnswer')}</p>\n               </div>\n             </details>\n\n            {/* FAQ: Weight Change */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <h3 className=\"font-bold text-slate-900 dark:text-white pr-4\">{t('faqWeightChangeTitle')}</h3>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-4\">\n                  <p>{t('faqWeightChangeAnswer')}</p>\n               </div>\n            </details>\n\n            {/* FAQ: Set Stroke */}\n            <details className=\"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden\">\n               <summary className=\"flex items-center justify-between p-6 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\n                 <h3 className=\"font-bold text-slate-900 dark:text-white pr-4\">{t('faqSetStrokeTitle')}</h3>\n                 <span className=\"text-slate-400 group-open:rotate-180 transition-transform\">▼</span>\n               </summary>\n               <div className=\"px-6 pb-6 text-slate-600 dark:text-slate-400 text-sm leading-relaxed border-t border-slate-100 dark:border-slate-800 pt-4\">\n                  <p className=\"mb-2\">{t('faqSetStrokeAnswer')}</p>\n                  <ul className=\"space-y-2\">\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"font-bold min-w-[20px]\">{/* 1. */}</span>\n                      <span>{t('faqSetStrokeMethod1')}</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"font-bold min-w-[20px]\">{/* 2. */}</span>\n                      <span>{t('faqSetStrokeMethod2')}</span>\n                    </li>\n                  </ul>\n               </div>\n            </details>\n\n          </div>\n        </section>\n\n        {/* Contact Form */}\n        <section id=\"contact\" className=\"scroll-mt-20\">\n          <h2 className=\"text-xl font-bold text-slate-900 dark:text-white mb-6\">{t('contactTitle')}</h2>\n          \n          <div className=\"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm p-6\">\n            <div className=\"flex items-start gap-4 mb-6\">\n              <div className=\"w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center flex-shrink-0\">\n                <Send className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <div>\n                <h3 className=\"font-bold text-lg text-slate-900 dark:text-white mb-1\">{t('contactTitle')}</h3>\n                <p className=\"text-slate-600 dark:text-slate-400 text-sm\">{t('contactDesc')}</p>\n              </div>\n            </div>\n\n            <form onSubmit={async (e) => {\n              e.preventDefault();\n              const form = e.target as HTMLFormElement;\n              const category = (form.elements.namedItem('category') as HTMLSelectElement).value;\n              const message = (form.elements.namedItem('message') as HTMLTextAreaElement).value;\n              const submitBtn = (form.querySelector('button[type=\"submit\"]') as HTMLButtonElement);\n              \n              const statusDiv = document.getElementById('contact-status');\n              if (statusDiv) {\n                statusDiv.textContent = '';\n                statusDiv.className = 'text-sm mt-2 hidden';\n              }\n\n              submitBtn.disabled = true;\n              submitBtn.classList.add('opacity-70', 'cursor-not-allowed');\n\n              try {\n                const res = await fetch('/api/contact', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({ category, message }),\n                });\n\n                if (res.ok) {\n                  form.reset();\n                  if (statusDiv) {\n                    statusDiv.textContent = t('contactSent');\n                    statusDiv.className = 'text-sm mt-4 text-green-600 dark:text-green-400 font-medium bg-green-50 dark:bg-green-900/20 p-3 rounded-lg block animate-in fade-in';\n                  }\n                } else {\n                  throw new Error('Failed');\n                }\n              } catch (err) {\n                if (statusDiv) {\n                    statusDiv.textContent = t('contactError');\n                    statusDiv.className = 'text-sm mt-4 text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-900/20 p-3 rounded-lg block animate-in fade-in';\n                }\n              } finally {\n                submitBtn.disabled = false;\n                submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');\n              }\n            }}>\n              <div className=\"grid gap-4\">\n                <div>\n                  <label htmlFor=\"category\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">{t('contactCategoryLabel')}</label>\n                  <select \n                    name=\"category\" \n                    id=\"category\"\n                    className=\"w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-shadow\"\n                  >\n                    <option value=\"Feature Request\">{t('contactCategoryFeature')}</option>\n                    <option value=\"Bug Report\">{t('contactCategoryBug')}</option>\n                    <option value=\"Question\">{t('contactCategoryQuestion')}</option>\n                    <option value=\"Other\">{t('contactCategoryOther')}</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label htmlFor=\"message\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">{t('contactMessageLabel')}</label>\n                  <textarea  \n                    name=\"message\" \n                    id=\"message\" \n                    rows={4}\n                    required\n                    className=\"w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-shadow resize-none\"\n                    placeholder={t('contactMessagePlaceholder')}\n                  ></textarea>\n                </div>\n\n                <div id=\"contact-status\" className=\"hidden\"></div>\n\n                <button \n                  type=\"submit\"\n                  className=\"w-full sm:w-auto bg-blue-600 text-white font-bold py-2.5 px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2\"\n                >\n                  <Send size={18} />\n                  {t('contactSend')}\n                </button>\n              </div>\n            </form>\n          </div>\n        </section>\n\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Scale' is defined but never used.","line":4,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MousePointerClick' is defined but never used.","line":4,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":81},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Save' is defined but never used.","line":4,"column":83,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":87},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/janhartje/drachenbootplan/src/app/page.tsx:18:5\n  16 |     // Check system preference on mount\n  17 |     const isDark = document.documentElement.classList.contains('dark');\n> 18 |     setIsDarkMode(isDark);\n     |     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  19 |   }, []);\n  20 |\n  21 |   const toggleDarkMode = () => {","line":18,"column":5,"nodeType":null,"endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from \"next/link\";\nimport { ArrowRight, Smartphone, Zap, Users, Sun, Moon, Scale, MousePointerClick, Save, ShieldCheck, Heart, Ship } from \"lucide-react\";\nimport { useLanguage } from \"@/context/LanguageContext\";\nimport DragonBoatAnimation from \"@/components/ui/DragonBoatAnimation\";\nimport DragonLogo from \"@/components/ui/DragonLogo\";\nimport Footer from \"@/components/ui/Footer\";\nimport { useEffect, useState } from \"react\";\n\nexport default function LandingPage() {\n  const { language, changeLanguage, t } = useLanguage();\n  const [isDarkMode, setIsDarkMode] = useState(false);\n\n  useEffect(() => {\n    // Check system preference on mount\n    const isDark = document.documentElement.classList.contains('dark');\n    setIsDarkMode(isDark);\n  }, []);\n\n  const toggleDarkMode = () => {\n    const newMode = !isDarkMode;\n    setIsDarkMode(newMode);\n    if (newMode) {\n      document.documentElement.classList.add('dark');\n      localStorage.setItem('theme', 'dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n      localStorage.setItem('theme', 'light');\n    }\n  };\n\n  // JSON-LD Structured Data for SEO (English/International focus)\n  const jsonLd = {\n    \"@context\": \"https://schema.org\",\n    \"@graph\": [\n      {\n        \"@type\": \"Organization\",\n        \"name\": language === 'de' ? \"Drachenboot Manager\" : \"Dragon Boat Manager\",\n        \"alternateName\": language === 'de' ? \"Dragon Boat Manager\" : \"Drachenboot Manager\",\n        \"url\": process.env.NEXT_PUBLIC_SERVER_URL || \"http://localhost:3000\",\n        \"logo\": `${process.env.NEXT_PUBLIC_SERVER_URL || \"http://localhost:3000\"}/icons/logo-512.png`,\n        \"description\": language === 'de' \n          ? \"Team Management Software für Drachenboot Teams\" \n          : \"Team Management Software for Dragon Boat Teams\",\n        \"founder\": {\n          \"@type\": \"Person\",\n          \"name\": \"Jan Hartje\"\n        },\n        \"inLanguage\": [\"en\", \"de\"]\n      },\n      {\n        \"@type\": \"WebApplication\",\n        \"name\": language === 'de' ? \"Drachenboot Manager\" : \"Dragon Boat Manager\",\n        \"url\": process.env.NEXT_PUBLIC_SERVER_URL || \"http://localhost:3000\",\n        \"applicationCategory\": \"SportsApplication\",\n        \"operatingSystem\": \"Web Browser, iOS, Android\",\n        \"offers\": {\n          \"@type\": \"Offer\",\n          \"price\": \"0\",\n          \"priceCurrency\": \"EUR\"\n        },\n        \"description\": language === 'de'\n          ? \"Progressive Web App zur Verwaltung von Drachenboot-Teams, Terminplanung und optimaler Bootsbesetzung\"\n          : \"Progressive Web App for managing dragon boat teams, event planning, and optimal boat lineup\",\n        \"featureList\": language === 'de' \n          ? [\n              \"Team Management\",\n              \"Terminplanung\",\n              \"Optimale Bootsbesetzung mit KI\",\n              \"Gewichtstrimmung und Balance\"\n            ]\n          : [\n              \"Team Management\",\n              \"Event Planning\",\n              \"Optimal Boat Lineup with AI\",\n              \"Weight Trimming and Balance\"\n            ],\n        \"inLanguage\": [\"en\", \"de\"],\n        \"availableLanguage\": [\n          {\n            \"@type\": \"Language\",\n            \"name\": \"English\",\n            \"alternateName\": \"en\"\n          },\n          {\n            \"@type\": \"Language\",\n            \"name\": \"German\",\n            \"alternateName\": \"de\"\n          }\n        ]\n      }\n    ]\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-50 font-sans selection:bg-blue-200 dark:selection:bg-blue-900 overflow-x-hidden\">\n      {/* Background Gradients & Grid */}\n      <div className=\"fixed inset-0 z-0 pointer-events-none\">\n        <div className=\"absolute top-[-20%] right-[-10%] w-[50%] h-[50%] bg-blue-400/10 rounded-full blur-[100px] animate-pulse-slow\" />\n        <div className=\"absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-400/10 rounded-full blur-[100px] animate-pulse-slow delay-1000\" />\n        <div className=\"absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)]\" />\n      </div>\n\n      {/* JSON-LD Structured Data */}\n      <script\n        type=\"application/ld+json\"\n        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n      />\n      \n      {/* Navigation */}\n      <nav className=\"fixed w-full z-50 top-0 sm:top-4 px-0 sm:px-6\">\n        <div className=\"max-w-7xl mx-auto backdrop-blur-xl bg-white/70 dark:bg-slate-950/70 border-b sm:border border-slate-200/50 dark:border-slate-800/50 sm:rounded-2xl transition-all shadow-sm\">\n          <div className=\"px-4 sm:px-6 lg:px-8\">\n            <div className=\"flex justify-between h-16 sm:h-20 items-center\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"relative group\">\n                  <div className=\"absolute inset-0 bg-blue-500/20 blur-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity\" />\n                  <DragonLogo className=\"w-9 h-9 relative z-10 transition-transform group-hover:scale-110 duration-300\" />\n                </div>\n                <span className=\"font-bold text-xl sm:text-2xl tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-700 dark:from-white dark:to-slate-300\">\n                  {t('appTitle')}\n                </span>\n              </div>\n              <div className=\"flex gap-2 sm:gap-3 items-center\">\n                <button \n                  onClick={toggleDarkMode} \n                  className=\"p-2.5 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 transition-all hover:scale-105\"\n                  aria-label=\"Toggle dark mode\"\n                >\n                  {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}\n                </button>\n                <button \n                  onClick={() => changeLanguage(language === 'de' ? 'en' : 'de')} \n                  className=\"p-2.5 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 transition-all hover:scale-105 font-bold text-sm\"\n                  aria-label=\"Toggle language\"\n                >\n                  {language.toUpperCase()}\n                </button>\n                <Link \n                  href=\"/app\" \n                  className=\"bg-slate-900 dark:bg-white hover:bg-slate-800 dark:hover:bg-slate-100 text-white dark:text-slate-900 px-5 sm:px-7 py-2.5 rounded-full font-medium transition-all shadow-lg shadow-slate-900/10 hover:shadow-slate-900/20 hover:-translate-y-0.5 flex items-center gap-2 whitespace-nowrap text-sm sm:text-base mr-2 sm:mr-0\"\n                >\n                  <span className=\"hidden xs:inline\">{t('landingStartApp')}</span>\n                  <span className=\"xs:hidden\">{(t('landingStartApp') as string).split(' ')[0]}</span>\n                  <ArrowRight className=\"w-4 h-4\" />\n                </Link>\n              </div>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <main className=\"relative z-10\">\n        <section className=\"pt-32 pb-16 sm:pt-40 sm:pb-24 lg:pt-52 lg:pb-32 overflow-hidden px-4\" aria-label=\"Hero\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative\">\n            <div className=\"grid lg:grid-cols-2 gap-12 lg:gap-16 items-center\">\n              <div className=\"relative z-10 flex flex-col items-center lg:items-start text-center lg:text-left\">\n                \n                <h1 className=\"text-5xl sm:text-6xl lg:text-7xl font-extrabold tracking-tight leading-[1.1] mb-6 sm:mb-8\">\n                  <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-slate-900 via-blue-800 to-slate-900 dark:from-white dark:via-blue-200 dark:to-white\">\n                    {(t('landingHeroTitle') as string).split('\\\\n').map((line, i) => (\n                      <span key={i} className=\"block\">\n                        {line}\n                      </span>\n                    ))}\n                  </span>\n                </h1>\n\n                <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/50 dark:bg-slate-800/50 backdrop-blur-md border border-slate-200 dark:border-slate-700 shadow-sm mb-8 animate-fade-in-up\">\n                  <span className=\"relative flex h-2.5 w-2.5\">\n                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75\"></span>\n                    <span className=\"relative inline-flex rounded-full h-2.5 w-2.5 bg-blue-500\"></span>\n                  </span>\n                  <span className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">\n                    {t('landingBadge')}\n                  </span>\n                </div>\n                \n                <p className=\"text-lg sm:text-xl text-slate-600 dark:text-slate-400 mb-8 sm:mb-10 leading-relaxed max-w-lg\">\n                  {t('landingHeroSubtitle')}\n                </p>\n                \n                <div className=\"flex flex-col sm:flex-row gap-4 w-full sm:w-auto\">\n                  <Link \n                    href=\"/app\" \n                    className=\"group bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-full font-bold text-lg transition-all shadow-xl shadow-blue-600/20 hover:shadow-blue-600/40 hover:-translate-y-1 flex items-center justify-center gap-3\"\n                  >\n                    <span>{t('landingCTA')}</span>\n                    <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" />\n                  </Link>\n                  <a \n                    href=\"#features\" \n                    className=\"px-8 py-4 rounded-full font-bold text-lg text-slate-700 dark:text-slate-200 bg-white/50 dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800 backdrop-blur-sm transition-all border border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 flex items-center justify-center hover:-translate-y-1\"\n                  >\n                    {t('landingLearnMore')}\n                  </a>\n                </div>\n              </div>\n              \n              <div className=\"relative h-[350px] sm:h-[600px] w-full flex items-center justify-center lg:ml-auto [perspective:1000px]\">\n                <div className=\"relative w-full max-w-lg lg:max-w-full h-full rounded-[2.5rem] overflow-hidden shadow-2xl bg-white/10 dark:bg-slate-900/40 backdrop-blur-sm border border-white/20 dark:border-slate-700/50 transition-transform hover:scale-[1.02] duration-500 ring-1 ring-slate-900/5\">\n                   <div className=\"absolute inset-0 bg-gradient-to-br from-blue-100/30 to-purple-100/30 dark:from-blue-900/20 dark:to-purple-900/20\" />\n                   <div className=\"relative h-full w-full p-8 flex items-center justify-center\">\n                      <DragonBoatAnimation />\n                   </div>\n                </div>\n                \n                {/* Decorative Elements around image */}\n                <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[140%] h-[140%] bg-blue-500/5 rounded-full blur-3xl pointer-events-none\" />\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Features Section */}\n        <section id=\"features\" className=\"py-24 sm:py-32 relative overflow-hidden\" aria-label=\"Features\">\n          <div className=\"absolute inset-0 bg-slate-50/50 dark:bg-slate-900/30 skew-y-3 transform origin-top-left scale-110\" />\n          \n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative\">\n            <div className=\"text-center max-w-3xl mx-auto mb-16 sm:mb-24\">\n              <h2 className=\"text-3xl sm:text-4xl lg:text-5xl font-bold mb-6 tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-400\">\n                {t('landingFeaturesTitle')}\n              </h2>\n              <p className=\"text-slate-600 dark:text-slate-400 text-lg sm:text-xl leading-relaxed\">\n                {t('landingFeaturesSubtitle')}\n              </p>\n            </div>\n            \n            <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8 lg:gap-10\">\n              <FeatureCard \n                icon={<Zap className=\"w-6 h-6 text-white\" />}\n                iconBg=\"bg-amber-500\"\n                title={t('landingFeature1Title')}\n                description={t('landingFeature1Desc')}\n              />\n              <FeatureCard \n                icon={<Ship className=\"w-6 h-6 text-white\" />}\n                iconBg=\"bg-blue-600\"\n                title={t('landingFeature2Title')}\n                description={t('landingFeature2Desc')}\n              />\n              <FeatureCard \n                icon={<Smartphone className=\"w-6 h-6 text-white\" />}\n                iconBg=\"bg-indigo-500\"\n                title={t('landingFeature3Title')}\n                description={t('landingFeature3Desc')}\n              />\n              <FeatureCard \n                icon={<Users className=\"w-6 h-6 text-white\" />}\n                iconBg=\"bg-emerald-500\"\n                title={t('landingFeature4Title')}\n                description={t('landingFeature4Desc')}\n              />\n              <FeatureCard \n                icon={<ShieldCheck className=\"w-6 h-6 text-white\" />}\n                iconBg=\"bg-slate-600\"\n                title={t('landingFeature5Title')}\n                description={t('landingFeature5Desc')}\n              />\n              <FeatureCard \n                icon={<Heart className=\"w-6 h-6 text-white\" />}\n                iconBg=\"bg-rose-500\"\n                title={t('landingFeature6Title')}\n                description={t('landingFeature6Desc')}\n              />\n            </div>\n          </div>\n        </section>\n\n        {/* New CTA Section */}\n        <section className=\"py-24 px-4\">\n          <div className=\"max-w-5xl mx-auto\">\n            <div className=\"bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl p-8 sm:p-16 text-center text-white shadow-2xl shadow-blue-600/30 relative overflow-hidden\">\n              <div className=\"absolute top-0 right-0 -mt-10 -mr-10 w-64 h-64 bg-white/10 rounded-full blur-3xl\" />\n              <div className=\"absolute bottom-0 left-0 -mb-10 -ml-10 w-64 h-64 bg-black/10 rounded-full blur-3xl\" />\n              \n              <div className=\"relative z-10\">\n                <h2 className=\"text-3xl sm:text-4xl font-bold mb-6\">{t('landingStartApp')}</h2>\n                <p className=\"text-blue-100 text-lg sm:text-xl mb-10 max-w-2xl mx-auto\">\n                  {t('landingHeroSubtitle')}\n                </p>\n                <Link \n                  href=\"/app\" \n                  className=\"inline-flex items-center justify-center gap-2 bg-white text-blue-600 px-8 py-4 rounded-full font-bold text-lg hover:bg-blue-50 transition-all shadow-lg hover:shadow-xl hover:-translate-y-1\"\n                >\n                  {t('landingCTA')}\n                  <ArrowRight className=\"w-5 h-5\" />\n                </Link>\n              </div>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      {/* Footer */}\n      <Footer variant=\"compact\" />\n    </div>\n  );\n}\n\nfunction FeatureCard({ icon, title, description, iconBg }: { icon: React.ReactNode, title: string, description: string, iconBg: string }) {\n  return (\n    <div className=\"group p-8 rounded-3xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 hover:border-blue-500/30 dark:hover:border-blue-400/30 transition-all duration-300 hover:shadow-xl hover:shadow-blue-500/5 hover:-translate-y-1\">\n      <div className={`w-14 h-14 ${iconBg} rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-blue-900/5 group-hover:scale-110 transition-transform duration-300`}>\n        {icon}\n      </div>\n      <h3 className=\"text-xl font-bold mb-3 text-slate-900 dark:text-slate-100\">{title}</h3>\n      <p className=\"text-slate-600 dark:text-slate-400 leading-relaxed\">\n        {description}\n      </p>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/app/profile/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/auth.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'inviterName' is never reassigned. Use 'const' instead.","line":29,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":29,"endColumn":24,"fix":{"range":[1267,1295],"text":"const inviterName = undefined;"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'inviterName' is assigned a value but never used.","line":29,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'subjectKey' is assigned a value but never used.","line":90,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":25}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import NextAuth from \"next-auth\"\nimport { PrismaAdapter } from \"@auth/prisma-adapter\"\nimport prisma from \"@/lib/prisma\"\nimport Google from \"next-auth/providers/google\"\nimport GitHub from \"next-auth/providers/github\"\nimport Resend from \"next-auth/providers/resend\"\nimport { sendEmail } from \"@/lib/email\"\nimport MagicLinkEmail from \"@/emails/templates/MagicLinkEmail\"\nimport TeamInviteEmail from \"@/emails/templates/TeamInviteEmail\"\nimport { t, Language } from \"@/emails/utils/i18n\"\n\nexport const { handlers, auth, signIn, signOut } = NextAuth({\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    Google,\n    GitHub,\n    Resend({\n      from: \"Drachenboot Manager <no-reply@drachenbootmanager.de>\",\n      maxAge: 7 * 24 * 60 * 60, // 7 days\n      sendVerificationRequest: async ({ identifier: email, url }) => {\n        console.log(\"[Auth] SendVerificationRequest URL:\", url);\n        // Try to detect user's language preference\n        let lang: Language = 'de'; // Default to German\n        \n        // Check if there is a pending invite for this email (Paddler with inviteEmail)\n        // OR if the user is a member of a team (to send welcome back email)\n        // We prioritize the TeamInviteEmail if we find a pending invite\n        let teamName = '';\n        let inviterName = undefined;\n        let shouldUseTeamInvite = false;\n        let invitedPaddlerFound = false;\n\n        try {\n            // First check for pending invite (Paddler with inviteEmail)\n            const invitedPaddler = await prisma.paddler.findFirst({\n                where: { inviteEmail: email },\n                include: { team: true }\n            });\n\n            if (invitedPaddler) {\n                invitedPaddlerFound = true;\n                // Use the persisted language from the invite\n                if (invitedPaddler.inviteLanguage === 'en') {\n                    lang = 'en';\n                }\n                \n                if (invitedPaddler.team) {\n                    teamName = invitedPaddler.team.name;\n                    shouldUseTeamInvite = true;\n\n                    // FORCE the redirect to the invited team\n                    // We modify the magic link URL to ensure the callbackUrl points to the specific team\n                    try {\n                        const targetUrl = new URL(url);\n                        const baseUrl = process.env.NEXT_PUBLIC_SERVER_URL || targetUrl.origin;\n                        // Redirect to main app with teamId param\n                        const teamRedirect = `${baseUrl}/app?teamId=${invitedPaddler.teamId}`;\n                        \n                        targetUrl.searchParams.set('callbackUrl', teamRedirect);\n                        url = targetUrl.toString();\n                    } catch (e) {\n                         console.error(\"Failed to construct team redirect URL\", e);\n                    }\n                }\n            }\n        } catch (e) {\n            console.error(\"Error finding pending invite:\", e);\n        }\n\n        // If no invited paddler was found, try to get user's language preference\n        if (!invitedPaddlerFound) {\n            try {\n                const user = await prisma.user.findUnique({\n                    where: { email },\n                    select: { language: true }\n                });\n\n                if (user?.language === 'en') {\n                    lang = 'en';\n                }\n            } catch (e) {\n                console.error(\"Error finding user language:\", e);\n            }\n        }\n\n        const ReactEmailComponent = shouldUseTeamInvite \n            ? TeamInviteEmail({ url, teamName, lang }) // inviterName unavailable here efficiently\n            : MagicLinkEmail({ url, lang });\n\n        const subjectKey = shouldUseTeamInvite ? 'emailTeamInviteSubject' : 'emailMagicLinkSubject';\n        \n        // If team invite, append team name to subject?\n        // t(lang, 'emailTeamInviteSubject') is \"Du wurdest zum Team eingeladen\"\n        // Let's manually construct subject for Team Invite to match previous one\n        const subject = shouldUseTeamInvite\n            ? (lang === 'en' ? `You've been invited to join \"${teamName}\" 🐉` : `Du wurdest zum Team \"${teamName}\" eingeladen 🐉`)\n            : t(lang, 'emailMagicLinkSubject');\n\n        const result = await sendEmail({\n          to: email,\n          subject: subject,\n          react: ReactEmailComponent,\n          template: shouldUseTeamInvite ? 'TeamInviteEmail' : 'MagicLinkEmail',\n          props: { url, lang, teamName },\n        });\n        \n        if (!result.success) {\n          console.error(\"Error sending magic link email:\", result.error);\n          throw new Error(\"Failed to send verification email\");\n        }\n      },\n    }),\n  ],\n  pages: {\n    signIn: \"/login\",\n    verifyRequest: \"/login?verify=1\",\n  },\n  callbacks: {\n    session({ session, user }) {\n      session.user.id = user.id\n      session.user.weight = user.weight\n      \n      const adminEmails = process.env.ADMIN_EMAILS?.split(',').map(e => e.trim()) || [];\n      if (user.email && adminEmails.includes(user.email)) {\n        session.user.isAdmin = true;\n      }\n      \n      return session\n    },\n  },\n  events: {\n    // Link invited paddlers when a new user is created or signs in\n    async signIn({ user }) {\n      if (user.email && user.id) {\n        // Fetch full user to get weight (as it might not be in the session user object)\n        const fullUser = await prisma.user.findUnique({\n          where: { id: user.id },\n        });\n\n        // Check if there are any paddlers with this email in inviteEmail field\n        const invitedPaddlers = await prisma.paddler.findMany({\n          where: { inviteEmail: user.email },\n        });\n        \n        // Link all invited paddlers to this user\n        for (const paddler of invitedPaddlers) {\n          await prisma.paddler.update({\n            where: { id: paddler.id },\n            data: {\n              userId: user.id,\n              inviteEmail: null, // Clear the invite email\n              name: fullUser?.name || user.name || paddler.name, // Use user's name if available\n              weight: fullUser?.weight || paddler.weight, // Sync weight\n            },\n          });\n        }\n      }\n    },\n    async createUser({ user }) {\n        if (user.email && user.id) {\n          // Fetch full user to get weight\n          const fullUser = await prisma.user.findUnique({\n            where: { id: user.id },\n          });\n\n          // Check if there are any paddlers with this email in inviteEmail field\n          const invitedPaddlers = await prisma.paddler.findMany({\n            where: { inviteEmail: user.email },\n          });\n          \n          // Link all invited paddlers to this user\n          for (const paddler of invitedPaddlers) {\n            await prisma.paddler.update({\n              where: { id: paddler.id },\n              data: {\n                userId: user.id,\n                inviteEmail: null, // Clear the invite email\n                name: fullUser?.name || user.name || paddler.name, // Use user's name if available\n                weight: fullUser?.weight || paddler.weight, // Sync weight\n              },\n            });\n          }\n        }\n    }\n  },\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/LoginButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/LoginView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/OnboardingModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1931,1934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1931,1934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { Paddler } from '@/types';\nimport { Save, Info } from 'lucide-react';\nimport { FormInput } from '@/components/ui/FormInput';\nimport { WeightInput } from '@/components/ui/WeightInput';\nimport { SkillSelector, SkillsState } from '@/components/ui/SkillSelector';\n\ninterface OnboardingModalProps {\n  onClose: () => void;\n  paddler: Paddler;\n  onSave: (data: Partial<Paddler>) => Promise<void>;\n}\n\nexport const OnboardingModal: React.FC<OnboardingModalProps> = ({ onClose, paddler, onSave }) => {\n  const { t } = useLanguage();\n  const [name, setName] = useState('');\n  const [weight, setWeight] = useState('');\n  const [skills, setSkills] = useState<SkillsState>({ left: false, right: false, drum: false, steer: false });\n  const [isSaving, setIsSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    setName(paddler.name || '');\n    setWeight(paddler.weight ? paddler.weight.toString() : '');\n    const sObj = { left: false, right: false, drum: false, steer: false };\n    if (paddler.skills) paddler.skills.forEach((s) => {\n      if (s in sObj) sObj[s as keyof typeof sObj] = true;\n    });\n    setSkills(sObj);\n  }, [paddler]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setIsSaving(true);\n    \n    try {\n      const weightNum = parseFloat(weight);\n      if (!name.trim()) throw new Error(t('nameRequired') || 'Name is required');\n      if (isNaN(weightNum) || weightNum <= 0) throw new Error(t('weightRequired') || 'Valid weight is required');\n      \n      const skillsArray = (Object.keys(skills) as Array<keyof typeof skills>).filter(k => skills[k]);\n      \n      await onSave({\n        name: name,\n        weight: weightNum,\n        skills: skillsArray\n      });\n      onClose();\n    } catch (e: any) {\n      console.error(e);\n      setError(e.message || 'Error saving profile');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleSkillChange = (skill: keyof SkillsState) => {\n    setSkills(prev => ({ ...prev, [skill]: !prev[skill] }));\n  };\n  \n  const isFormValid = name.trim() !== '' && weight.trim() !== '' && parseFloat(weight) > 0;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\">\n      <div className=\"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800\">\n        \n        {/* Header with Dragon Pattern */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white text-center relative overflow-hidden\">\n          <div className=\"absolute top-0 left-0 w-full h-full opacity-10 bg-[url('/dragon-pattern.svg')] bg-repeat\" />\n          <h2 className=\"text-2xl font-bold relative z-10 mb-2\">{t('onboardingTitle')}</h2>\n          <p className=\"text-blue-100 text-sm relative z-10\">{t('onboardingBody')}</p>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n          {error && (\n            <div className=\"p-3 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg text-sm mb-4\">\n              {error}\n            </div>\n          )}\n\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-1 block\">\n                {t('name')}\n              </label>\n              <FormInput\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                placeholder={t('name')}\n              />\n            </div>\n            <div className=\"w-full md:w-32\">\n              <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-1 block\">\n                {t('weight')}\n              </label>\n               <WeightInput\n                value={weight}\n                onChange={setWeight}\n              />\n            </div>\n          </div>\n          \n           {/* Detailed explanations */}\n           <div className=\"flex gap-3 text-xs text-slate-600 dark:text-slate-400 bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-900/30 items-start\">\n              <Info className=\"shrink-0 text-blue-500 mt-0.5\" size={16} />\n              <div className=\"space-y-2\">\n                <p>{t('weightReason')}</p>\n                <p>{t('skillsReason')}</p>\n              </div>\n           </div>\n\n          <div>\n            <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-2 block\">\n              {t('skills')}\n            </label>\n            <SkillSelector \n              skills={skills} \n              onChange={handleSkillChange} \n            />\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isSaving || !isFormValid}\n            className=\"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-blue-500/20 transition-all transform active:scale-[0.98] flex items-center justify-center gap-2\"\n          >\n            {isSaving ? (\n              <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n            ) : (\n              <>\n                 <Save size={18} />\n                 {t('completeProfile')}\n              </>\n            )}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/ProfileModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/ProfileView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/UserMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/auth/UserProfile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/PlannerView.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'refetchEvents' and 'refetchPaddlers'. Either include them or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [refetchEvents, refetchPaddlers]","fix":{"range":[2089,2091],"text":"[refetchEvents, refetchPaddlers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAndStartTour'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [checkAndStartTour, isDataLoading, isLoading]","fix":{"range":[2285,2311],"text":"[checkAndStartTour, isDataLoading, isLoading]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeEventId'. Either include it or remove the dependency array.","line":179,"column":6,"nodeType":"ArrayExpression","endLine":179,"endColumn":55,"suggestions":[{"desc":"Update the dependencies array to be: [debouncedAssignments, rows, debouncedTargetTrim, activeEventId]","fix":{"range":[6711,6760],"text":"[debouncedAssignments, rows, debouncedTargetTrim, activeEventId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useRef, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { ArrowLeft, Box } from 'lucide-react';\nimport { toPng } from 'html-to-image';\nimport { DndContext, DragEndEvent, DragStartEvent, DragOverlay, useSensor, useSensors, PointerSensor, TouchSensor } from '@dnd-kit/core';\nimport DragonLogo from '../ui/DragonLogo';\n\nimport { useDrachenboot } from '@/context/DrachenbootContext';\n// import { runAutoFillAlgorithm } from '@/utils/algorithm'; // Moved to API\nimport { useLanguage } from '@/context/LanguageContext';\nimport { AddGuestModal, HelpModal, ConfirmModal } from '../ui/Modals';\nimport Header from '../ui/Header';\nimport { UserMenu } from '@/components/auth/UserMenu';\nimport Footer from '../ui/Footer';\nimport { useTour } from '@/context/TourContext';\nimport { useDebounce } from '@/hooks/useDebounce';\n\nimport LoadingSkeleton from '../ui/LoadingScreens';\nimport PageTransition from '../ui/PageTransition';\n\n// Sub-components\nimport StatsPanel from './planner/StatsPanel';\nimport PaddlerPool from './planner/PaddlerPool';\nimport BoatVisualizer from './planner/BoatVisualizer';\nimport { BoatConfigItem, Paddler } from '@/types';\n\ninterface PlannerViewProps {\n  eventId: string;\n}\n\nconst PlannerView: React.FC<PlannerViewProps> = ({ eventId }) => {\n  const router = useRouter();\n  const { t, language } = useLanguage();\n  const { checkAndStartTour } = useTour();\n\n  const { \n    events, \n    paddlers, \n    assignmentsByEvent, \n    updateAssignments, \n    targetTrim, \n    setTargetTrim, \n    addGuest,\n    removeGuest,\n    addCanister,\n    removeCanister,\n    updateEvent,\n    isDarkMode,\n    toggleDarkMode,\n    setPaddlers, // needed for canister\n    currentTeam,\n    isLoading,\n    isDataLoading,\n    userRole,\n    refetchPaddlers,\n    refetchEvents\n  } = useDrachenboot();\n\n  const isReadOnly = userRole === 'PADDLER';\n\n  // --- REFRESH DATA ON MOUNT ---\n  useEffect(() => {\n    // Ensure we have the latest data when entering planner\n    refetchPaddlers();\n    refetchEvents();\n  }, []);\n\n  useEffect(() => {\n    // Only start tour if data is loaded\n    if (!isDataLoading && !isLoading) {\n      setTimeout(() => {\n        checkAndStartTour('planner');\n      }, 500);\n    }\n  }, [isDataLoading, isLoading]);\n\n  // --- LOCAL UI STATE ---\n  const [activeEventId, setActiveEventId] = useState<string>(eventId);\n\n\n\n  useEffect(() => {\n    setActiveEventId(eventId);\n  }, [eventId]);\n  const [isSimulating, setIsSimulating] = useState<boolean>(false);\n  const [isExporting, setIsExporting] = useState<boolean>(false);\n  const [showGuestModal, setShowGuestModal] = useState<boolean>(false);\n  const [showHelp, setShowHelp] = useState<boolean>(false);\n  const [selectedPaddlerId, setSelectedPaddlerId] = useState<number | string | null>(null);\n  const [lockedSeats, setLockedSeats] = useState<string[]>([]);\n  const [confirmClear, setConfirmClear] = useState<boolean>(false);\n  const [showBoatSizeConfirm, setShowBoatSizeConfirm] = useState<boolean>(false);\n  const [pendingBoatSize, setPendingBoatSize] = useState<'standard' | 'small' | null>(null);\n  \n  const boatRef = useRef<HTMLDivElement>(null);\n\n  // --- COMPUTED ---\n  const activeEvent = useMemo(() => events.find((e) => e.id === activeEventId) || null, [activeEventId, events]);\n  const activeEventTitle = activeEvent ? activeEvent.title : t('unknownEvent');\n  const eventDate = activeEvent?.date ? new Date(activeEvent.date).toLocaleDateString(language === 'de' ? 'de-DE' : 'en-US', { day: '2-digit', month: '2-digit', year: 'numeric' }) : '';\n  const eventTime = activeEvent?.date ? new Date(activeEvent.date).toLocaleTimeString(language === 'de' ? 'de-DE' : 'en-US', { hour: '2-digit', minute: '2-digit' }) : '';\n  const boatSize = activeEvent?.boatSize || 'standard';\n\n  // Assignments are always keyed by the event ID\n  const assignmentKey = activeEventId;\n  const assignments = useMemo(() => assignmentsByEvent[assignmentKey] || {}, [assignmentsByEvent, assignmentKey]);\n\n  const activePaddlerPool = useMemo(() => {\n    if (!activeEvent) return [];\n    const regular = paddlers.filter((p) => !p.isCanister && ['yes', 'maybe'].includes(activeEvent.attendance[p.id]));\n    \n    // Generate canister objects based on count\n    const canisters: Paddler[] = [];\n    const count = activeEvent.canisterCount || 0;\n    for (let i = 1; i <= count; i++) {\n      canisters.push({\n        id: `canister-${i}`,\n        name: t('canister'),\n        weight: 25,\n        skills: ['left', 'right'],\n        isCanister: true\n      });\n    }\n\n    // Guests are now in regular paddlers list with isGuest=true and attendance=yes\n    // But if we still have guests in activeEvent.guests (legacy or duplicate), we should filter them out if they are already in regular\n    const guests = activeEvent.guests || [];\n    const uniqueGuests = guests.filter(g => !regular.find(r => r.id === g.id));\n    \n    return [...regular, ...canisters, ...uniqueGuests].sort((a, b) => a.name.localeCompare(b.name));\n  }, [paddlers, activeEvent, t]);\n\n  // --- BOAT CONFIG ---\n  const rows = boatSize === 'small' ? 5 : 10;\n  const boatConfig = useMemo(() => {\n    const s: BoatConfigItem[] = [{ id: 'drummer', type: 'drummer' }];\n    for (let i = 1; i <= rows; i++) { s.push({ id: `row-${i}-left`, type: 'paddler', side: 'left', row: i }); s.push({ id: `row-${i}-right`, type: 'paddler', side: 'right', row: i }); }\n    s.push({ id: 'steer', type: 'steer' });\n    return s;\n  }, [rows]);\n\n  // --- STATS (Server Side Calculation) ---\n  const [stats, setStats] = useState({ l: 0, r: 0, t: 0, diffLR: 0, f: 0, b: 0, diffFB: 0, c: 0 });\n  const [cgStats, setCgStats] = useState({ x: 50, y: 50, targetY: 50 });\n  const [isCalculating, setIsCalculating] = useState(false);\n\n  // Debounce inputs to avoid flooding API\n  const debouncedAssignments = useDebounce(assignments, 300);\n  const debouncedTargetTrim = useDebounce(targetTrim, 300);\n\n  useEffect(() => {\n    const fetchStats = async () => {\n      setIsCalculating(true);\n      try {\n        const response = await fetch('/api/stats', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            eventId: activeEventId,\n            assignments: debouncedAssignments,\n            targetTrim: debouncedTargetTrim\n          }),\n        });\n        \n        if (response.ok) {\n          const data = await response.json();\n          setStats(data.stats);\n          setCgStats(data.cgStats);\n        }\n      } catch (error) {\n        console.error('Failed to fetch stats', error);\n      } finally {\n        setIsCalculating(false);\n      }\n    };\n\n    fetchStats();\n  }, [debouncedAssignments, rows, debouncedTargetTrim]);\n\n  // --- ACTIONS ---\n  const goHome = () => router.push('/app');\n\n  const handleAddCanister = async () => {\n    if (isReadOnly) return;\n    const canisterId = await addCanister(activeEventId);\n    if (canisterId) setSelectedPaddlerId(canisterId);\n  };\n\n  const handleRemoveCanister = async (canisterId: string) => {\n    if (isReadOnly) return;\n    await removeCanister(activeEventId, canisterId);\n  };\n\n  const handleAddGuest = async (guestData: Pick<Paddler, 'name' | 'weight' | 'skills'>) => {\n    if (isReadOnly) return;\n    const guestId = await addGuest(activeEventId, guestData);\n    if (guestId) setSelectedPaddlerId(guestId);\n    setShowGuestModal(false);\n  };\n\n  const handleRemoveGuest = async (guestId: string) => {\n    if (isReadOnly) return;\n    await removeGuest(activeEventId, guestId);\n  };\n\n  const handleUpdateBoatSize = (size: 'standard' | 'small') => {\n    if (isReadOnly) return;\n    if (size === boatSize) return;\n\n    // Check if boat has assignments\n    if (Object.keys(assignments).length > 0) {\n      setPendingBoatSize(size);\n      setShowBoatSizeConfirm(true);\n    } else {\n      updateEvent(activeEventId, { boatSize: size });\n    }\n  };\n\n  const confirmBoatSizeChange = () => {\n    if (pendingBoatSize) {\n      updateEvent(activeEventId, { boatSize: pendingBoatSize });\n      // Clear assignments as layout changes\n      updateAssignments(activeEventId, {});\n      setShowBoatSizeConfirm(false);\n      setPendingBoatSize(null);\n    }\n  };\n\n  const handleSeatClick = (sid: string) => {\n    if (isReadOnly) return;\n    if (lockedSeats.includes(sid)) return;\n    \n    if (selectedPaddlerId) {\n      // Check if selectedPaddlerId is actually a paddler currently in a seat (for swapping)\n      const sourceSeatId = Object.keys(assignments).find(key => assignments[key] === selectedPaddlerId);\n      \n      const nAss = { ...assignments };\n      \n      if (sourceSeatId) {\n        // SWAP LOGIC\n        const targetPaddlerId = assignments[sid];\n        \n        if (targetPaddlerId) {\n          // Target is occupied -> Swap\n          // Remove both from their original spots first to be clean\n          delete nAss[sourceSeatId];\n          delete nAss[sid]; \n          \n          nAss[sourceSeatId] = targetPaddlerId;\n          nAss[sid] = selectedPaddlerId;\n        } else {\n          // Target is empty -> Move\n          delete nAss[sourceSeatId];\n          nAss[sid] = selectedPaddlerId;\n        }\n      } else {\n        // Standard assignment from pool\n        // CRITICAL FIX: Ensure paddler is not already in another seat (Ghost Fix)\n        Object.keys(nAss).forEach((k) => { \n            if (nAss[k] === selectedPaddlerId) delete nAss[k]; \n        });\n        nAss[sid] = selectedPaddlerId;\n      }\n      \n      updateAssignments(assignmentKey, nAss);\n      setSelectedPaddlerId(null);\n    } else if (assignments[sid]) {\n      setSelectedPaddlerId(assignments[sid]);\n    }\n  };\n\n  const handleUnassign = (sid: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (isReadOnly) return;\n    if (lockedSeats.includes(sid)) return;\n    const paddlerId = assignments[sid];\n    const paddler = activePaddlerPool.find((p) => p.id === paddlerId);\n    \n    const nAss = { ...assignments };\n    delete nAss[sid];\n    updateAssignments(assignmentKey, nAss);\n    \n    if (paddler && paddler.isCanister) {\n        setPaddlers((prev) => prev.filter((p) => p.id !== paddlerId));\n    }\n  };\n\n  const toggleLock = (sid: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (isReadOnly) return;\n    if (!assignments[sid]) return;\n    setLockedSeats((prev) => prev.includes(sid) ? prev.filter((i) => i !== sid) : [...prev, sid]);\n  };\n\n  const clearBoat = () => {\n    if (isReadOnly) return;\n    if (confirmClear) {\n      const nAss = { ...assignments };\n      Object.keys(nAss).forEach((s) => { if (!lockedSeats.includes(s)) delete nAss[s]; });\n      updateAssignments(assignmentKey, nAss);\n      setConfirmClear(false);\n    } else {\n      setConfirmClear(true);\n      setTimeout(() => setConfirmClear(false), 3000);\n    }\n  };\n\n  const runAutoFill = async () => {\n    if (isReadOnly) return;\n    setIsSimulating(true);\n    try {\n      const response = await fetch('/api/autofill', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          eventId: activeEventId,\n          assignments,\n          lockedSeats,\n          targetTrim\n        }),\n      });\n\n      if (!response.ok) throw new Error('Auto-fill failed');\n\n      const data = await response.json();\n      if (data.assignments) {\n        updateAssignments(assignmentKey, data.assignments);\n      }\n    } catch (error) {\n      console.error('Auto-fill error:', error);\n      // Optional: Show error toast/alert\n    } finally {\n      setIsSimulating(false);\n    }\n  };\n\n  const handleExportImage = () => {\n    if (!boatRef.current) return;\n    setIsExporting(true);\n    setTimeout(() => {\n      if (boatRef.current) {\n        console.log('Starting export capture...');\n        // Using html-to-image for better support of modern CSS (oklch etc.)\n        toPng(boatRef.current, { \n            cacheBust: true, \n            pixelRatio: 2,\n            backgroundColor: 'transparent' // Explicitly transparent or null\n        })\n          .then((dataUrl) => {\n            console.log('Canvas captured, generating link...');\n            try {\n                const link = document.createElement('a');\n                const safeTitle = (activeEventTitle || 'plan').replace(/[^a-z0-9\\u00C0-\\u00FF]+/gi, '-').toLowerCase().replace(/(^-|-$)/g, '');\n                const datePrefix = activeEvent?.date ? new Date(activeEvent.date).toISOString().split('T')[0] : '';\n                link.download = `drachenboot-${datePrefix ? datePrefix + '-' : ''}${safeTitle || 'export'}.png`;\n                link.href = dataUrl;\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n                console.log('Download click triggered');\n            } catch (innerErr) {\n                console.error('Link generation failed', innerErr);\n            }\n            setIsExporting(false);\n          })\n          .catch((err) => { \n              console.error('Export failed', err); \n              setIsExporting(false); \n          });\n      } else {\n        console.error('boatRef is null');\n        setIsExporting(false);\n      }\n    }, 150);\n  };\n\n  // --- DnD ---\n  const sensors = useSensors(\n    useSensor(PointerSensor, { activationConstraint: { distance: 8 } }),\n    useSensor(TouchSensor, { activationConstraint: { delay: 250, tolerance: 5 } })\n  );\n\n  const [activeDragData, setActiveDragData] = useState<{ id: string; name: string; weight: number; isGuest?: boolean; isCanister?: boolean; source?: string; seatId?: string } | null>(null);\n\n  const handleDragStart = (event: DragStartEvent) => {\n      setActiveDragData(event.active.data.current as unknown as typeof activeDragData);\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    setActiveDragData(null); // Clear overlay\n    if (isReadOnly) return;\n    const { active, over } = event;\n    if (!over) return;\n\n    const activeData = active.data.current;\n    const overData = over.data.current;\n\n    if (!activeData || !overData) return;\n\n    if (overData.type === 'seat') {\n         const targetSeatId = overData.id;\n         if (lockedSeats.includes(targetSeatId)) return;\n\n         const nAss = { ...assignments };\n         const paddlerId = activeData.id;\n         \n         if (activeData.source === 'seat') {\n             const sourceSeatId = activeData.seatId;\n             const targetPaddlerId = nAss[targetSeatId];\n             \n             if (targetPaddlerId) {\n                  // Swap\n                  delete nAss[sourceSeatId];\n                  delete nAss[targetSeatId];\n\n                  nAss[sourceSeatId] = targetPaddlerId;\n                  nAss[targetSeatId] = paddlerId;\n             } else {\n                  // Move\n                  delete nAss[sourceSeatId];\n                  nAss[targetSeatId] = paddlerId;\n             }\n         } else {\n             // From Pool\n             // CRITICAL FIX: Ensure paddler is not already in another seat\n             Object.keys(nAss).forEach(k => { if (nAss[k] === paddlerId) delete nAss[k]; });\n             nAss[targetSeatId] = paddlerId;\n         }\n         updateAssignments(assignmentKey, nAss);\n    }\n  };\n\n  if (isLoading || isDataLoading) {\n    return <LoadingSkeleton />;\n  }\n\n  return (\n    <DndContext sensors={sensors} onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n    <PageTransition>\n    <div className=\"min-h-screen font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300 bg-slate-100 dark:bg-slate-950 p-2 md:p-4 pb-20\">\n      {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}\n      {showGuestModal && <AddGuestModal onClose={() => setShowGuestModal(false)} onAdd={handleAddGuest} />}\n      <ConfirmModal \n        isOpen={showBoatSizeConfirm}\n        title={t('changeBoatSize')}\n        message={t('changeBoatSizeConfirm')}\n        onConfirm={confirmBoatSizeChange}\n        onCancel={() => { setShowBoatSizeConfirm(false); setPendingBoatSize(null); }}\n        confirmLabel={t('changeAndClear')}\n      />\n\n      <div className=\"max-w-6xl mx-auto\">\n        <Header\n          title={\n            <div className=\"flex items-center gap-2\">\n              <div className=\"text-blue-500\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"></line><line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"></line><line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"></line></svg>\n              </div>\n              <span className=\"font-bold text-slate-800 dark:text-white text-sm\">\n                {activeEventTitle}\n                {eventDate && (\n                  <span className=\"font-normal text-slate-500 dark:text-slate-400 text-xs ml-2\">\n                    ({eventDate} • {eventTime})\n                  </span>\n                )}\n              </span>\n            </div>\n          }\n          subtitle={t('plannerMode')}\n          logo={\n            <Link href=\"/\" className=\"cursor-pointer hover:opacity-80 transition-opacity\">\n              {currentTeam?.icon ? (\n                <div className=\"w-10 h-10 rounded-full overflow-hidden border border-slate-200 dark:border-slate-700\">\n                  <img \n                    src={currentTeam.icon} \n                    alt={currentTeam.name} \n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n              ) : (\n                <DragonLogo className=\"w-10 h-10\" />\n              )}\n            </Link>\n          }\n          leftAction={\n            <button onClick={goHome} className=\"p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-500 hover:text-blue-600 hover:border-blue-300 transition-colors\">\n              <ArrowLeft size={20} />\n            </button>\n          }\n          showHelp={true}\n          onHelp={() => setShowHelp(true)}\n          showThemeToggle={true}\n          isDarkMode={isDarkMode}\n          toggleDarkMode={toggleDarkMode}\n        >\n          <div className=\"text-center px-2\"><div className=\"text-[10px] text-slate-500 dark:text-slate-400 uppercase font-bold\">{t('total')}</div><div className=\"font-bold text-sm\">{stats.t} kg</div></div>\n          <div className=\"w-px h-8 bg-slate-100 dark:bg-slate-800\"></div>\n\n          <div className=\"text-center px-2\"><div className=\"text-[10px] text-slate-500 dark:text-slate-400 uppercase font-bold\">{t('assigned')}</div><div className=\"font-bold text-sm text-blue-600 dark:text-blue-400\">{stats.c} / 22</div></div>\n          <div className=\"w-px h-8 bg-slate-100 dark:bg-slate-800\"></div>\n          <UserMenu />\n        </Header>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-1 flex flex-col gap-4 lg:h-0 lg:min-h-full\">\n            {/* Stats & Tools Panel */}\n            <StatsPanel \n              stats={stats} \n              targetTrim={targetTrim} \n              setTargetTrim={setTargetTrim} \n              runAutoFill={runAutoFill} \n              isSimulating={isSimulating} \n              activePaddlerPool={activePaddlerPool} \n              handleExportImage={handleExportImage} \n              clearBoat={clearBoat} \n              confirmClear={confirmClear} \n              t={t} \n              boatSize={boatSize}\n              setBoatSize={handleUpdateBoatSize}\n              isLoading={isCalculating}\n              isReadOnly={isReadOnly}\n            />\n\n            {/* Paddler Pool */}\n            <PaddlerPool \n              activePaddlerPool={activePaddlerPool} \n              assignments={assignments} \n              selectedPaddlerId={selectedPaddlerId} \n              setSelectedPaddlerId={setSelectedPaddlerId} \n              activeEvent={activeEvent} \n              handleAddCanister={handleAddCanister} \n              onRemoveCanister={handleRemoveCanister}\n              onRemoveGuest={handleRemoveGuest}\n              setShowGuestModal={setShowGuestModal} \n              t={t} \n              isReadOnly={isReadOnly}\n            />\n          </div>\n\n          {/* Boat Visualization */}\n          <BoatVisualizer \n            ref={boatRef}\n            boatConfig={boatConfig} \n            paddlers={paddlers} \n            assignments={assignments} \n            activeEvent={activeEvent} \n            activePaddlerPool={activePaddlerPool}\n            lockedSeats={lockedSeats} \n            selectedPaddlerId={selectedPaddlerId} \n            cgStats={cgStats} \n            isExporting={isExporting} \n            handleSeatClick={handleSeatClick} \n            handleUnassign={handleUnassign} \n            toggleLock={toggleLock} \n             rows={rows}\n             isReadOnly={isReadOnly}\n          />\n        </div>\n        <Footer />\n      </div>\n    </div>\n    </PageTransition>\n    <DragOverlay dropAnimation={null}>\n      {activeDragData ? (\n        <div className=\"bg-white dark:bg-slate-800 rounded-lg shadow-2xl border-2 border-blue-500 w-28 h-16 flex flex-col items-center justify-center opacity-90 cursor-grabbing scale-105 touch-none relative z-50\">\n           <div className=\"font-bold text-sm text-slate-800 dark:text-slate-200 truncate w-full text-center px-1\">\n             {activeDragData.name}\n             {activeDragData.isGuest && <span className=\"text-[10px] opacity-80 ml-1 font-normal\">{t('guestSuffix')}</span>}\n           </div>\n           <div className=\"text-[10px] text-slate-500 font-mono flex items-center gap-1\">\n             {activeDragData.weight > 0 && <span>{activeDragData.weight} kg</span>}\n             {activeDragData.isCanister && <Box size={10} />}\n           </div>\n        </div>\n      ) : null}\n    </DragOverlay>\n    </DndContext>\n  );\n};\n\nexport default PlannerView;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/SeatBox.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":2,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CSS' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'transform' is assigned a value but never used.","line":48,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":14}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Drum, ShipWheel, X, Pin, Box, User } from 'lucide-react';\nimport { useDraggable, useDroppable } from '@dnd-kit/core';\nimport { CSS } from '@dnd-kit/utilities';\nimport SkillBadges from '../ui/SkillBadges';\nimport { BoatConfigItem, Paddler } from '@/types';\nimport { useLanguage } from '@/context/LanguageContext';\n\ninterface SeatBoxProps {\n  seat: BoatConfigItem;\n  paddler?: Paddler;\n  isLocked?: boolean;\n  isSelected?: boolean;\n  onClick?: () => void;\n  onUnassign?: (e: React.MouseEvent) => void;\n  onLock?: (e: React.MouseEvent) => void;\n  hideWeight?: boolean;\n  isMaybe?: boolean;\n  isReadOnly?: boolean;\n}\n\nconst SeatBox: React.FC<SeatBoxProps> = ({\n  seat,\n  paddler,\n  isLocked,\n  isSelected,\n  onClick,\n  onUnassign,\n  onLock,\n  hideWeight,\n  isMaybe,\n  isReadOnly,\n}) => {\n  const { t } = useLanguage();\n  const side = seat.id.includes('left') ? 'left' : seat.id.includes('right') ? 'right' : null;\n  \n  // Droppable: The Seat itself\n  const { setNodeRef: setDroppableRef, isOver } = useDroppable({\n    id: `seat-${seat.id}`,\n    data: { type: 'seat', id: seat.id },\n  });\n\n  // Draggable: The Paddler inside (if exists)\n  const { \n    attributes, \n    listeners, \n    setNodeRef: setDraggableRef, \n    transform, \n    isDragging \n  } = useDraggable({\n    id: `seat-paddler-${seat.id}`,\n    data: { \n      type: 'paddler', \n      id: paddler?.id, \n      source: 'seat', \n      seatId: seat.id,\n      weight: paddler?.weight,\n      name: paddler?.name,\n      isGuest: paddler?.isGuest,\n      isCanister: paddler?.isCanister\n    },\n    disabled: !paddler || isLocked || isReadOnly,\n  });\n\n  const dragStyle = {\n    // transform: CSS.Translate.toString(transform), // Removing transform to use DragOverlay\n    opacity: isDragging ? 0.3 : undefined,\n    zIndex: isDragging ? 50 : undefined,\n    touchAction: 'none'\n  };\n\n  let base = 'bg-white dark:bg-slate-800 border-amber-200/50 dark:border-slate-600 hover:border-blue-400 shadow-sm';\n  let text = 'text-slate-800 dark:text-slate-200';\n\n  if (paddler) {\n    if (paddler.isCanister) {\n      base = 'bg-amber-200 dark:bg-amber-800 border-amber-500 dark:border-amber-600 shadow-md';\n      text = 'text-amber-900 dark:text-amber-100 font-bold';\n    } else {\n      let ok = false;\n      if (paddler.skills) {\n        if (seat.type === 'drummer' && paddler.skills.includes('drum')) ok = true;\n        else if (seat.type === 'steer' && paddler.skills.includes('steer')) ok = true;\n        else if (side && paddler.skills.includes(side)) ok = true;\n      }\n      if (ok) {\n        base = 'bg-green-200 dark:bg-green-800 border-green-700 dark:border-green-600 shadow-md';\n        text = 'text-green-900 dark:text-green-100 font-bold';\n      } else {\n        base = 'bg-red-200 dark:bg-red-900 border-red-600 dark:border-red-700 shadow-md';\n        text = 'text-red-900 dark:text-red-100 font-bold';\n      }\n    }\n\n    if (isMaybe) base += ' ring-4 ring-yellow-400 border-yellow-500';\n    if (isLocked) base += ' ring-2 ring-slate-500 border-slate-600';\n  }\n  \n  if (isOver && !isDragging) {\n    base += ' ring-4 ring-green-400 border-green-500 scale-105 z-40';\n  }\n  \n  const active = isSelected ? 'ring-4 ring-blue-500 dark:ring-blue-400 border-blue-600 dark:border-blue-300 z-30 scale-105 shadow-xl' : '';\n\n  return (\n    <div \n      ref={setDroppableRef} \n      onClick={onClick} \n      className={`w-28 h-16 rounded-lg border-2 flex flex-col items-center justify-center cursor-pointer transition-all relative z-10 group ${base} ${active}`}\n    >\n      {paddler ? (\n        <div \n          ref={setDraggableRef} \n          {...listeners} \n          {...attributes} \n          style={dragStyle}\n          className=\"w-full h-full flex flex-col items-center justify-center cursor-grab active:cursor-grabbing\"\n        >\n          <div className={`w-full px-1 text-center ${hideWeight ? 'flex h-full items-center justify-center' : ''}`}>\n            <span className={`leading-tight break-words ${hideWeight ? 'text-xs font-bold' : 'text-sm block truncate'} ${text}`}>\n              {paddler.name}{paddler.isGuest && <span className=\"text-[10px] opacity-80 ml-1 font-normal\">{t('guestSuffix')}</span>} {isMaybe && <span className=\"text-yellow-700 dark:text-yellow-300 font-extrabold text-xs ml-1\">?</span>}\n            </span>\n          </div>\n          {!hideWeight && (\n            <div className={`text-[10px] opacity-90 ${text} flex flex-wrap items-center justify-center gap-0.5 mt-0.5 px-0.5 font-mono font-normal`}>\n              {paddler.weight > 0 && <span>{paddler.weight} kg</span>}\n              {!paddler.isCanister && <SkillBadges skills={paddler.skills} />}\n              {paddler.isCanister && <Box size={10} />}\n            </div>\n          )}\n          \n          {/* Action buttons need stopPropagation to not trigger drag */}\n          <button \n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={onUnassign} \n            className={`absolute -top-1 -right-1 bg-white dark:bg-slate-700 text-slate-400 hover:text-red-500 rounded-full p-0.5 shadow border dark:border-slate-600 z-20 transition-all ${isLocked || hideWeight || isReadOnly ? 'hidden' : 'scale-0 group-hover:scale-100'}`}\n          >\n            <X size={10} />\n          </button>\n          <button \n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={onLock} \n            className={`absolute top-0.5 left-0.5 p-0.5 rounded z-20 ${hideWeight || isReadOnly ? 'hidden' : ''} ${isLocked ? 'text-slate-700 dark:text-slate-300' : 'text-slate-300 hover:text-slate-500'}`}\n          >\n            <Pin size={12} fill={isLocked ? 'currentColor' : 'none'} />\n          </button>\n        </div>\n      ) : (\n        <>\n          {seat.type === 'drummer' ? (\n            <Drum size={18} className=\"text-slate-400 dark:text-slate-600 opacity-70\" />\n          ) : seat.type === 'steer' ? (\n            <ShipWheel size={18} className=\"text-slate-400 dark:text-slate-600 opacity-70\" />\n          ) : (\n            <span className=\"text-slate-400 dark:text-slate-600 text-[10px] font-bold uppercase tracking-wider opacity-70\">Frei</span>\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default SeatBox;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/Stats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/TeamSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/TeamView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'side' is assigned a value but never used.","line":234,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":234,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9777,9780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9777,9780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\n// import { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useSession } from \"next-auth/react\";\nimport { useDrachenboot } from '@/context/DrachenbootContext';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { HelpModal } from '../ui/Modals';\nimport { OnboardingModal } from '../auth/OnboardingModal';\nimport DragonLogo from '../ui/DragonLogo';\nimport Header from '../ui/Header';\nimport Footer from '../ui/Footer';\nimport TeamSwitcher from './TeamSwitcher';\nimport { UserMenu } from '@/components/auth/UserMenu';\nimport { updateProfile } from '@/app/actions/user';\n\nimport { Globe, Instagram, Plus, FileUp, Calendar } from 'lucide-react';\n// import { Team } from '@/types';\n// import NewEventForm from './team/NewEventForm'; // Removed\nimport { Event } from '@/types';\nimport { EventModal } from './team/EventModal';\nimport PaddlerModal from './team/PaddlerModal';\nimport { EventsSection } from './team/EventsSection';\nimport PaddlerGrid from './team/PaddlerGrid';\nimport { Paddler } from '@/types';\nimport LoadingSkeleton from '../ui/LoadingScreens';\nimport PageTransition from '../ui/PageTransition';\nimport WelcomeView from './WelcomeView';\nimport { ImportModal } from './team/ImportModal';\n\nconst TeamView: React.FC = () => {\n  // const router = useRouter();\n  const { t } = useLanguage();\n  const { \n    teams,\n    paddlers,\n    currentTeam,\n    // updateTeam,\n    addPaddler, \n    updatePaddler, \n    deletePaddler,\n    isDarkMode,\n    toggleDarkMode,\n    userRole,\n    isLoading,\n    isDataLoading,\n    refetchPaddlers,\n    refetchEvents,\n    importPaddlers,\n    importEvents,\n    createEvent,\n    updateEvent,\n  } = useDrachenboot();\n\n  // --- REFRESH DATA ON MOUNT ---\n  React.useEffect(() => {\n    refetchPaddlers();\n    refetchEvents();\n  }, [refetchPaddlers, refetchEvents]);\n\n  // --- LOCAL UI STATE ---\n  const [editingPaddlerId, setEditingPaddlerId] = useState<number | string | null>(null);\n  const [showHelp, setShowHelp] = useState<boolean>(false);\n  const [showImport, setShowImport] = useState<boolean>(false);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n\n  const [editingEvent, setEditingEvent] = useState<Event | null>(null);\n  const [showEventModal, setShowEventModal] = useState<boolean>(false);\n\n  const handleCreateEvent = (title: string, date: string, type: 'training' | 'regatta', boatSize: 'standard' | 'small', comment?: string) => {\n    createEvent(title, date, type, boatSize, comment);\n  };\n\n  const handleUpdateEvent = (id: string, title: string, date: string, type: 'training' | 'regatta', boatSize: 'standard' | 'small', comment?: string) => {\n    updateEvent(id, { title, date, type, boatSize, comment });\n  };\n\n\n  // --- COMPUTED ---\n  const sortedPaddlers = useMemo(() => \n    [...paddlers].filter((p) => !p.isCanister && !p.isGuest).sort((a, b) => a.name.localeCompare(b.name)), \n  [paddlers]);\n\n  const paddlerToEdit = useMemo(() => \n    editingPaddlerId ? paddlers.find(p => p.id === editingPaddlerId) || null : null,\n  [editingPaddlerId, paddlers]);\n\n  const { data: session } = useSession(); // Get session to identify current user\n  \n  // --- ONBOARDING LOGIC ---\n  const myPaddler = useMemo(() => {\n    if (session?.user?.id && paddlers.length) {\n      return paddlers.find(p => p.userId === session.user.id);\n    }\n    return null;\n  }, [session, paddlers]);\n\n  const showOnboarding = useMemo(() => {\n    if (!myPaddler) return false;\n    // Check if critical data is missing: Name, Weight (<=0), or Skills (empty)\n    // We ignore Guest/Canister (they don't log in anyway)\n    // We only force onboarding if they are actual members (userId exists, which myPaddler implies)\n    \n    // Check missing name\n    if (!myPaddler.name || myPaddler.name.trim() === '') return true;\n\n    // Check missing weight\n    if (!myPaddler.weight || myPaddler.weight <= 0) return true;\n    \n    // Check missing skills (optional, but requested by user)\n    // A user might legit have no skills preference, but usually left/right is min.\n    // Let's enforce at least one skill to ensure seat planning works.\n    if (!myPaddler.skills || myPaddler.skills.length === 0) return true;\n\n    return false;\n  }, [myPaddler]);\n\n\n  // --- ACTIONS ---\n  const handleOnboardingSave = async (data: Partial<import('@/types').Paddler>) => {\n    if (!myPaddler) return;\n    if (!data.name || !data.weight) return;\n    try {\n      // Use updateProfile to sync Name/Weight globally and set Skills efficiently\n      // Pass currentTeam.id to ensure skills are updated for this team context\n      await updateProfile(\n        { \n          name: data.name, \n          weight: data.weight, \n          skills: data.skills || []\n        }, \n        currentTeam?.id\n      );\n      \n      // Refresh local data\n      await updatePaddler(myPaddler.id, data); // Keep this to trigger context refresh if needed, roughly redundant but safe\n    } catch (e: unknown) {\n      setErrorMessage(e instanceof Error ? e.message : t('errorSavingPaddler'));\n    }\n  };\n\n\n\n  const handleSavePaddler = async (data: Pick<Paddler, 'name' | 'weight' | 'skills'>) => {\n    setErrorMessage(null);\n    try {\n      if (editingPaddlerId && editingPaddlerId !== 'new') {\n        await updatePaddler(editingPaddlerId, data);\n      } else {\n        await addPaddler(data);\n      }\n      setEditingPaddlerId(null);\n    } catch (e: unknown) {\n      setErrorMessage(e instanceof Error ? e.message : t('errorSavingPaddler'));\n    }\n  };\n\n  const handleEditPaddler = (p: Paddler) => {\n    setEditingPaddlerId(p.id);\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const handleDeletePaddler = (id: number | string) => {\n    deletePaddler(id);\n    if (editingPaddlerId === id) setEditingPaddlerId(null);\n  };\n\n\n\n    const handleImportPaddlers = async (rows: Record<string, unknown>[]) => {\n      // Expected: Name | Weight | Side | Skills | Email\n      // Backend expects: { name, weight, side, skills, ... }\n      // We map the rows to match backend expectation\n      const mappedPaddlers = rows.map(row => {\n        const keys = Object.keys(row);\n        const nameKey = keys.find(k => k.toLowerCase().includes('name'));\n        const weightKey = keys.find(k => k.toLowerCase().includes('weight') || k.toLowerCase().includes('gewicht'));\n        const sideKey = keys.find(k => k.toLowerCase().includes('side') || k.toLowerCase().includes('seite') || k.toLowerCase().includes('rolle'));\n        const emailKey = keys.find(k => k.toLowerCase().includes('email') || k.toLowerCase().includes('mail'));\n        \n        if (!nameKey || !row[nameKey]) return null;\n\n        const name = row[nameKey];\n        const weight = weightKey ? parseFloat(String(row[weightKey])) : 0;\n        \n        // Parse Side/Role\n        // Valid: left, right, drum, steer (case insensitive)\n        // multiple values can be comma separated\n        const sideStrRaw = sideKey ? String(row[sideKey]).toLowerCase() : '';\n        \n\n        \n        // Dictionary for multilingual support\n        const dict = {\n          left: ['left', 'links', 'l', 'gauche', 'sinistra', 'izquierda', 'lewa'],\n          right: ['right', 'rechts', 'r', 'droite', 'destra', 'derecha', 'prawa'],\n          drum: ['drum', 'trommel', 'drummer', 'trommler', 'd', 'tambour', 'cox', 'canister'], // canister logic handles weight, but role might be drum?\n          steer: ['steer', 'steuer', 'steuermann', 'helm', 's', 'barreur', 'timoniere', 'timonel'],\n          both: ['both', 'beide', 'b', 'l/r', 'r/l', 'l+r', 'r+l', 'lr', 'rl']\n        };\n\n        const foundRoles = new Set<string>();\n\n        const parts = sideStrRaw.split(/[,/|&+\\s]+/).filter((p: string) => p.trim().length > 0);\n\n        parts.forEach(part => {\n             const p = part.trim();\n             // Check against dictionaries\n             if (dict.both.some(term => p === term || p.includes(term))) {\n                foundRoles.add('left');\n                foundRoles.add('right');\n             }\n             else {\n               if (dict.left.some(term => p === term || (term.length > 2 && p.includes(term)))) foundRoles.add('left');\n               if (dict.right.some(term => p === term || (term.length > 2 && p.includes(term)))) foundRoles.add('right');\n               if (dict.drum.some(term => p === term || (term.length > 1 && p.includes(term)))) foundRoles.add('drum');\n               if (dict.steer.some(term => p === term || (term.length > 1 && p.includes(term)))) foundRoles.add('steer');\n             }\n        });\n\n        // Determine main 'side' property for UI preference\n        let side: 'left' | 'right' | 'both' | null = null;\n        if (foundRoles.has('left') && foundRoles.has('right')) side = 'both';\n        else if (foundRoles.has('left')) side = 'left';\n        else if (foundRoles.has('right')) side = 'right';\n\n        // Skills MUST contain 'left'/'right' for the algorithm to work, plus drum/steer\n        let skills = Array.from(foundRoles);\n\n        // Fallback: If no side detected, default to 'left' for safety (or keep null if pure special role?)\n        // Algorithm needs side in skills. If we have drum but no side, they can't paddle.\n        // But maybe that's intended (pure drummer).\n        // If nothing at all:\n        if (skills.length === 0) {\n             side = 'left'; \n             skills = ['left'];\n        }\n        \n\n\n        return {\n           name,\n           weight: isNaN(weight) ? 0 : weight,\n\n           skills,\n           inviteEmail: emailKey ? row[emailKey] : undefined\n        } as unknown as import('@/types').Paddler;\n      }).filter((p): p is import('@/types').Paddler => p !== null);\n\n      if (mappedPaddlers.length > 0) {\n         await importPaddlers(mappedPaddlers as any);\n      }\n    };\n\n    const handleImportEvents = async (rows: Record<string, unknown>[]) => {\n      // Expected: Title | Date | Time | Type | BoatSize\n      const mappedEvents = rows.map(row => {\n        const keys = Object.keys(row);\n        const titleKey = keys.find(k => k.toLowerCase().includes('title') || k.toLowerCase().includes('titel') || k.toLowerCase().includes('name'));\n        const dateKey = keys.find(k => k.toLowerCase().includes('date') || k.toLowerCase().includes('datum'));\n        const timeKey = keys.find(k => k.toLowerCase().includes('time') || k.toLowerCase().includes('zeit') || k.toLowerCase().includes('uhr')); \n        const typeKey = keys.find(k => k.toLowerCase().includes('type') || k.toLowerCase().includes('typ'));\n        const boatKey = keys.find(k => k.toLowerCase().includes('boat') || k.toLowerCase().includes('boot'));\n        const commentKey = keys.find(k => k.toLowerCase().includes('comment') || k.toLowerCase().includes('kommentar') || k.toLowerCase().includes('bemerkung') || k.toLowerCase().includes('hinweis'));\n\n        if (!titleKey || !row[titleKey] || !dateKey || !row[dateKey]) return null;\n\n        const title = row[titleKey];\n        let dateStr = row[dateKey];\n        \n        // Quick normalization for DD.MM.YYYY\n        if (typeof dateStr === 'string' && dateStr.includes('.')) {\n          const parts = dateStr.split('.');\n          if (parts.length === 3) dateStr = `${parts[2]}-${parts[1]}-${parts[0]}`;\n        }\n        \n        // Excel often returns 5-digit number for dates. We might need a helper if we want to be robust,\n        // but for now relying on string input or standard ISO.\n        // If it's a number (Excel serial date), we skip simplistic conversion here to save space, \n        // assuming user provides string or basic format.\n\n        let dateTimeStr = String(dateStr);\n        if (timeKey && row[timeKey]) {\n           dateTimeStr += `T${row[timeKey]}`;\n        } else {\n           dateTimeStr += 'T19:00:00'; \n        }\n\n        const dateObj = new Date(dateTimeStr);\n        if (isNaN(dateObj.getTime())) return null;\n\n        const typeRaw = typeKey ? String(row[typeKey]).toLowerCase() : 'training';\n        const type = typeRaw.includes('regatta') ? 'regatta' : 'training';\n\n        const boatRaw = boatKey ? String(row[boatKey]).toLowerCase() : 'standard';\n        const boatSize = boatRaw.includes('small') || boatRaw.includes('klein') || boatRaw.includes('10') ? 'small' : 'standard';\n\n        const comment = commentKey ? row[commentKey] : null;\n\n        return { title, date: dateTimeStr, type, boatSize, comment } as Event;\n      }).filter((e): e is Event => e !== null);\n\n      if (mappedEvents.length > 0) {\n        await importEvents(mappedEvents as unknown as Record<string, unknown>[]);\n      }\n    };\n\n  if (isLoading || isDataLoading) {\n    return <LoadingSkeleton />;\n  }\n\n  // Show welcome page for users with no teams\n  if (teams.length === 0) {\n    return <WelcomeView />;\n  }\n\n  return (\n    <PageTransition>\n      <div className=\"min-h-screen font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300 bg-slate-100 dark:bg-slate-950 p-2 md:p-4 pb-20\">\n        {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}\n        \n        <div className=\"max-w-6xl mx-auto\">\n          <Header \n            title={t('appTitle')}\n            subtitle={t('teamManager')}\n            logo={\n              <Link href=\"/\" className=\"cursor-pointer hover:opacity-80 transition-opacity\">\n                {currentTeam?.icon ? (\n                  <img src={currentTeam.icon} alt=\"Team Icon\" className=\"w-10 h-10 rounded-full object-cover\" />\n                ) : (\n                  <DragonLogo className=\"w-10 h-10\" />\n                )}\n              </Link>\n            }\n            showHelp={true}\n            onHelp={() => setShowHelp(true)}\n            showThemeToggle={true}\n            isDarkMode={isDarkMode}\n            toggleDarkMode={toggleDarkMode}\n            showInstallButton={true}\n          >\n            <TeamSwitcher />\n            <div className=\"w-px h-8 bg-slate-100 dark:bg-slate-800 mx-2\"></div>\n            <UserMenu />\n          </Header>\n\n          {/* Team Metadata / Social Links */}\n          {currentTeam && (currentTeam.website || currentTeam.instagram || currentTeam.facebook || currentTeam.twitter || currentTeam.email) && (\n            <div className=\"-mt-4 mb-6 flex flex-wrap items-center gap-4 px-2\">\n              {currentTeam.website && (\n                <a href={currentTeam.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400 hover:text-amber-600 dark:hover:text-amber-400 transition-colors\">\n                  <Globe size={16} />\n                  <span className=\"hidden sm:inline\">{new URL(currentTeam.website).hostname}</span>\n                </a>\n              )}\n              {currentTeam.instagram && (\n                <a href={currentTeam.instagram.startsWith('http') ? currentTeam.instagram : `https://instagram.com/${currentTeam.instagram}`} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-slate-600 dark:text-slate-400 hover:text-pink-600 transition-colors\">\n                  <Instagram size={20} />\n                </a>\n              )}\n              {/* ... other social links skipped for brevity if not changed ... */}\n            </div>\n          )}\n\n          {userRole === 'CAPTAIN' ? (\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              {/* Event Liste (Now full height or spanned if needed, but keeping layout similar to before but without form) */}\n              {/* Used to have NewEventForm in col 1. Now we can span EventList? Or keep layout. \n                  Actually EventList is col-1 order-3. NewEventForm was col-1 order-1.\n                  Let's make EventList take full column for now or just remove the hole?\n                  If I remove the hole, PaddlerGrid takes 2 cols and EventList takes 1 col.\n                  That works.\n              */}\n              \n              <div className=\"lg:col-span-1 flex flex-col\">\n                <EventsSection sortedPaddlers={sortedPaddlers} onEdit={setEditingEvent} />\n              </div>\n\n              {/* Paddler Grid */}\n              <div className=\"lg:col-span-2 flex flex-col\">\n                <PaddlerGrid \n                  paddlers={sortedPaddlers} \n                  editingId={editingPaddlerId === 'new' ? null : editingPaddlerId} \n                  onEdit={handleEditPaddler} \n                  onDelete={handleDeletePaddler} \n                  t={t}\n                  headerAction={\n                    <div className=\"flex gap-2 flex-wrap justify-end\">\n                      <button \n                        onClick={() => setShowImport(true)}\n                        className=\"bg-slate-200 hover:bg-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 px-3 h-8 rounded text-sm font-medium flex items-center gap-2 shadow-sm transition-colors\"\n                      >\n                         <FileUp size={16} />\n                         {t('import') || 'Import'}\n                      </button>\n\n                      <button \n                         onClick={() => setShowEventModal(true)}\n                         className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 h-8 rounded text-sm font-medium flex items-center gap-2 shadow-sm transition-colors\"\n                       >\n                          <Calendar size={16} />\n                          {t('newTermin')}\n                       </button>\n                      <button \n                        onClick={() => setEditingPaddlerId('new')}\n                        className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 h-8 rounded text-sm font-medium flex items-center gap-2 shadow-sm transition-colors\"\n                      >\n                        <Plus size={16} />\n                        {t('addPaddler')}\n                      </button>\n                    </div>\n                  }\n                />\n              </div>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              {/* Event Liste */}\n              <div className=\"lg:col-span-1 flex flex-col\">\n                <EventsSection sortedPaddlers={sortedPaddlers} onEdit={setEditingEvent} />\n              </div>\n\n              {/* Paddler Grid */}\n              <div className=\"lg:col-span-2 flex flex-col\">\n                <PaddlerGrid \n                  paddlers={sortedPaddlers} \n                  editingId={null} \n                  onEdit={handleEditPaddler} \n                  onDelete={handleDeletePaddler} \n                  t={t}\n                />\n              </div>\n            </div>\n          )}\n          \n          {/* Paddler Modal */}\n          {userRole === 'CAPTAIN' && (\n            <>\n              <PaddlerModal\n                isOpen={!!editingPaddlerId}\n                onClose={() => setEditingPaddlerId(null)}\n                paddlerToEdit={editingPaddlerId === 'new' ? null : paddlerToEdit}\n                onSave={handleSavePaddler}\n                t={t}\n                teamMembers={paddlers.filter(p => p.userId).map(p => ({ userId: p.userId, name: p.name, email: p.user?.email || '' }))}\n                errorMessage={errorMessage}\n              />\n\n              <EventModal\n                isOpen={showEventModal || !!editingEvent}\n                onClose={() => { setShowEventModal(false); setEditingEvent(null); }}\n                onCreate={handleCreateEvent}\n                onUpdate={handleUpdateEvent}\n                initialData={editingEvent}\n              />\n            </>\n          )}\n          <Footer />\n        </div>\n        \n        {/* Import Modal */}\n        <ImportModal \n          isOpen={showImport} \n          onClose={() => setShowImport(false)}\n          onImportPaddlers={handleImportPaddlers}\n          onImportEvents={handleImportEvents}\n        />\n      </div>\n      \n      {/* Onboarding Modal */}\n      {showOnboarding && myPaddler && (\n        <OnboardingModal\n          paddler={myPaddler}\n          onClose={() => {}} // Mandatory modal, cannot be closed without saving\n          onSave={handleOnboardingSave}\n        />\n      )}\n    </PageTransition>\n  );\n};\n\nexport default TeamView;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/WelcomeView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/__tests__/SeatBox.test.tsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":8,"column":41,"nodeType":"ArrowFunctionExpression","messageId":"noDisplayName","endLine":8,"endColumn":81}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport SeatBox from '../SeatBox';\nimport { BoatConfigItem, Paddler } from '@/types';\n\n// Mock SkillBadges to simplify test\n// Mock SkillBadges to simplify test\njest.mock('../../ui/SkillBadges', () => () => <div data-testid=\"skill-badges\" />);\n\n// Mock LanguageContext\njest.mock('@/context/LanguageContext', () => ({\n  useLanguage: () => ({\n    t: (key: string) => {\n      if (key === 'available') return 'Frei';\n      return key;\n    },\n  }),\n}));\n\ndescribe('SeatBox', () => {\n  const mockSeat: BoatConfigItem = { id: 'row-1-left', type: 'paddler', side: 'left', row: 1 };\n  const mockPaddler: Paddler = { id: 'p1', name: 'Test Paddler', weight: 80, skills: ['left'] };\n\n  it('renders empty state correctly', () => {\n    render(<SeatBox seat={mockSeat} />);\n    expect(screen.getByText('Frei')).toBeInTheDocument();\n  });\n\n  it('renders paddler info when assigned', () => {\n    render(<SeatBox seat={mockSeat} paddler={mockPaddler} />);\n    expect(screen.getByText('Test Paddler')).toBeInTheDocument();\n    expect(screen.getByText(/80/)).toBeInTheDocument();\n  });\n\n  it('renders canister state correctly', () => {\n    const canister: Paddler = { ...mockPaddler, isCanister: true, name: 'Canister' };\n    render(<SeatBox seat={mockSeat} paddler={canister} />);\n    expect(screen.getByText('Canister')).toBeInTheDocument();\n    // Should not render skill badges for canister\n    expect(screen.queryByTestId('skill-badges')).not.toBeInTheDocument();\n  });\n\n  it('calls onClick when clicked', () => {\n    const onClick = jest.fn();\n    render(<SeatBox seat={mockSeat} onClick={onClick} />);\n    fireEvent.click(screen.getByText('Frei').closest('div')!);\n    expect(onClick).toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/__tests__/Stats.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/planner/BoatVisualizer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/planner/PaddlerPool.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":2,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SkillBadges' is defined but never used.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { User, Box, UserPlus, X } from 'lucide-react';\nimport SkillBadges from '../../ui/SkillBadges';\nimport { Paddler, Assignments, Event } from '@/types';\nimport PoolPaddlerItem from './PoolPaddlerItem';\n\ninterface PaddlerPoolProps {\n  activePaddlerPool: Paddler[];\n  assignments: Assignments;\n  selectedPaddlerId: number | string | null;\n  setSelectedPaddlerId: (id: number | string | null) => void;\n  activeEvent: Event | null;\n  handleAddCanister: () => void;\n  onRemoveCanister: (id: string) => void;\n  onRemoveGuest: (id: string) => void;\n  setShowGuestModal: (show: boolean) => void;\n  t: (key: string) => string;\n  isReadOnly?: boolean;\n}\n\nconst PaddlerPool: React.FC<PaddlerPoolProps> = ({ \n  activePaddlerPool, \n  assignments, \n  selectedPaddlerId, \n  setSelectedPaddlerId, \n  activeEvent, \n  handleAddCanister, \n  onRemoveCanister,\n  onRemoveGuest,\n  setShowGuestModal, \n  t,\n  isReadOnly \n}) => {\n  const [deleteConfirmId, setDeleteConfirmId] = React.useState<string | null>(null);\n\n  const triggerDelete = (id: string, type: 'canister' | 'guest') => {\n    if (deleteConfirmId === id) {\n      if (type === 'canister') onRemoveCanister(id);\n      else onRemoveGuest(id);\n      setDeleteConfirmId(null);\n    } else {\n      setDeleteConfirmId(id);\n      setTimeout(() => setDeleteConfirmId(null), 3000);\n    }\n  };\n\n  return (\n    <div id=\"tour-planner-pool\" className=\"bg-white dark:bg-slate-900 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 flex-1 flex flex-col min-h-[400px]\">\n      <div className=\"flex justify-between items-center mb-3\">\n        <h2 className=\"font-bold text-sm text-slate-700 dark:text-slate-200 uppercase tracking-wide flex items-center gap-2\"><User size={16} /> {t('available')} ({activePaddlerPool.length})</h2>\n        {!isReadOnly && (\n        <div className=\"flex gap-1\">\n          <button id=\"tour-planner-canister\" onClick={handleAddCanister} className=\"p-1.5 bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-500 rounded hover:bg-amber-100 border border-amber-200 dark:border-amber-800\" title={`${t('canister')} +25kg`}><Box size={14} /></button>\n          <button id=\"tour-planner-guest\" onClick={() => setShowGuestModal(true)} className=\"p-1.5 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 border border-blue-200 dark:border-blue-800 flex items-center gap-1 text-xs font-bold\" title={t('guest')}><UserPlus size={14} /> {t('guestAdd')}</button>\n        </div>\n        )}\n      </div>\n      {activePaddlerPool.length === 0 && <div className=\"text-center p-8 text-slate-500 dark:text-slate-400 italic text-sm border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-xl\">{t('noPromises')}</div>}\n      <div className=\"flex-1 overflow-y-auto p-2 scrollbar-thin\">\n        <div className=\"flex flex-wrap gap-2 justify-center content-start pb-4\">\n        {activePaddlerPool.map((p) => {\n          const isAssigned = Object.values(assignments).includes(p.id);\n          const isSelected = selectedPaddlerId === p.id;\n          const st = activeEvent ? activeEvent.attendance[p.id] : null;\n          const isMaybe = st === 'maybe';\n          const isConfirming = deleteConfirmId === String(p.id);\n\n          return (\n            <PoolPaddlerItem\n              key={p.id}\n              paddler={p}\n              isAssigned={isAssigned}\n              isSelected={isSelected}\n              isMaybe={isMaybe}\n              isConfirming={isConfirming}\n              onClick={() => setSelectedPaddlerId(isSelected ? null : p.id)}\n              triggerDelete={triggerDelete}\n              t={t}\n              isReadOnly={isReadOnly}\n            />\n          );\n        })}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PaddlerPool;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/planner/PoolPaddlerItem.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CSS' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":4,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'transform' is assigned a value but never used.","line":31,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":55}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { useDraggable } from '@dnd-kit/core';\nimport { CSS } from '@dnd-kit/utilities';\nimport { Box, X, User } from 'lucide-react';\nimport SkillBadges from '../../ui/SkillBadges';\nimport { Paddler } from '@/types';\n\ninterface PoolPaddlerItemProps {\n  paddler: Paddler;\n  isAssigned: boolean;\n  isSelected: boolean;\n  isMaybe: boolean;\n  isConfirming: boolean;\n  onClick: () => void;\n  triggerDelete: (id: string, type: 'canister' | 'guest') => void;\n  t: (key: string) => string;\n  isReadOnly?: boolean;\n}\n\nconst PoolPaddlerItem: React.FC<PoolPaddlerItemProps> = ({\n  paddler,\n  isAssigned,\n  isSelected,\n  isMaybe,\n  isConfirming,\n  onClick,\n  triggerDelete,\n  t,\n  isReadOnly\n}) => {\n  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({\n    id: `pool-paddler-${paddler.id}`,\n    data: {\n      type: 'paddler',\n      id: paddler.id,\n      source: 'pool',\n      weight: paddler.weight,\n      name: paddler.name,\n      isGuest: paddler.isGuest,\n      isCanister: paddler.isCanister\n    },\n    disabled: isAssigned || isReadOnly // Cannot drag if already assigned from pool (though typically removed from list if assigned? No, checks isAssigned class)\n  });\n\n  const style = {\n    // transform: CSS.Translate.toString(transform), // Removing transform to use DragOverlay interaction\n    opacity: isDragging ? 0.3 : undefined, // Ghost effect\n    touchAction: 'none',\n  };\n\n  // Match SeatBox styles\n  let base = 'bg-white dark:bg-slate-800 border-amber-200/50 dark:border-slate-600 hover:border-blue-400 shadow-sm';\n  let text = 'text-slate-800 dark:text-slate-200';\n\n  if (paddler.isCanister) {\n    base = 'bg-amber-200 dark:bg-amber-800 border-amber-500 dark:border-amber-600 shadow-md';\n    text = 'text-amber-900 dark:text-amber-100 font-bold';\n  } else {\n    // For pool items, we don't know \"seat preference\" match until dragged, so keep neutral or maybe indicate side pref?\n    // Let's keep it simple neutral but with skill badges.\n    // Actually, SeatBox logic for 'skilled' (green/red) depends on seat type. Here we just show the paddler.\n    // So distinct style is fine.\n  }\n\n  if (isMaybe) base += ' ring-2 ring-yellow-400 border-yellow-500';\n  const active = isSelected ? 'ring-2 ring-blue-500 dark:ring-blue-400 border-blue-600 dark:border-blue-300 z-30 scale-105 shadow-xl' : '';\n  const assignedStyle = isAssigned ? 'opacity-40 grayscale' : '';\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={style}\n      {...listeners}\n      {...attributes}\n      {...attributes}\n      onClick={isReadOnly ? undefined : onClick}\n      className={`w-28 h-16 rounded-lg border-2 flex flex-col items-center justify-center cursor-grab active:cursor-grabbing transition-all relative group touch-none\n        ${base} ${active} ${assignedStyle}\n        ${isDragging ? 'opacity-0' : ''} \n      `} \n      // Note: opacity-0 on isDragging if using overlay, but here we used 0.3 logic in style. Overriding style with className? style takes precedence.\n      // Keeping style logic.\n    >\n      <div className=\"w-full px-1 text-center\">\n        <span className={`text-sm block truncate w-full leading-tight font-bold ${text}`}>\n          {paddler.name}{paddler.isGuest && <span className=\"text-[10px] opacity-80 ml-1 font-normal\">{t('guestSuffix')}</span>} {isMaybe && <span className=\"text-yellow-700 dark:text-yellow-300 font-extrabold text-xs\">?</span>}\n        </span>\n      </div>\n      \n      <div className={`text-[10px] opacity-90 ${text} flex flex-wrap items-center justify-center gap-0.5 mt-0.5 px-0.5 font-mono font-normal`}>\n        {paddler.weight > 0 && <span>{paddler.weight} kg</span>}\n        {!paddler.isCanister && <SkillBadges skills={paddler.skills} />}\n        {paddler.isCanister && <Box size={10} />}\n      </div>\n\n       {/* Delete Action - Top Right corner, visible on group hover or if confirming */}\n       {/* Only for canister/guest */}\n       {/* Only for canister/guest */}\n       {(paddler.isCanister || paddler.isGuest) && !isAssigned && !isReadOnly && (\n         <button\n            onPointerDown={(e) => e.stopPropagation()} \n            onClick={(e) => { e.stopPropagation(); triggerDelete(String(paddler.id), paddler.isCanister ? 'canister' : 'guest'); }}\n            className={`absolute -top-1 -right-1 bg-white dark:bg-slate-700 text-slate-400 hover:text-red-500 rounded-full p-0.5 shadow border dark:border-slate-600 z-20 transition-all ${isConfirming ? 'bg-red-600 text-white hover:bg-red-700 scale-110' : 'scale-0 group-hover:scale-100'}`}\n         >\n           <X size={10} />\n         </button>\n       )}\n    </div>\n  );\n};\n\nexport default PoolPaddlerItem;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/planner/StatsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/EventList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/EventModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/EventsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useDrachenboot } from '@/context/DrachenbootContext';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { Event, Paddler } from '@/types';\nimport EventList from './EventList';\n\ninterface EventsSectionProps {\n  sortedPaddlers: Paddler[];\n  onEdit: (event: Event) => void;\n}\n\nexport const EventsSection: React.FC<EventsSectionProps> = ({ sortedPaddlers, onEdit }) => {\n  const router = useRouter();\n  const { t } = useLanguage();\n  const { \n    events, \n    deleteEvent,\n    updateAttendance, \n  } = useDrachenboot();\n\n  const handleDeleteEvent = (id: string) => {\n    deleteEvent(id);\n  };\n\n  const handlePlanEvent = (eid: number | string) => {\n    router.push(`/app/planner?id=${eid}`);\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 h-full\">\n      <EventList \n        events={events} \n        sortedPaddlers={sortedPaddlers} \n        onPlan={handlePlanEvent}\n        onEdit={onEdit}\n        onDelete={handleDeleteEvent}\n        onUpdateAttendance={updateAttendance} \n        t={t} \n      />\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/ImportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4288,4291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4288,4291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4417,4420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4417,4420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport ExcelJS from 'exceljs';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { Upload, FileUp, AlertCircle, CheckCircle, X, Download } from 'lucide-react';\nimport { normalizeHeader } from '@/utils/importUtils';\n\ninterface ImportModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onImportPaddlers: (data: Record<string, unknown>[]) => Promise<void>;\n  onImportEvents: (data: Record<string, unknown>[]) => Promise<void>;\n}\n\ntype ImportType = 'paddler' | 'event';\n\nexport const ImportModal: React.FC<ImportModalProps> = ({ \n  isOpen, \n  onClose, \n  onImportPaddlers, \n  onImportEvents \n}) => {\n  const { t } = useLanguage();\n  const [activeTab, setActiveTab] = useState<ImportType>('paddler');\n  const [isDragOver, setIsDragOver] = useState(false);\n  const [file, setFile] = useState<File | null>(null);\n  const [previewData, setPreviewData] = useState<Record<string, unknown>[]>([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState<string | null>(null);\n\n  if (!isOpen) return null;\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile) processFile(droppedFile);\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) processFile(selectedFile);\n  };\n\n  const processFile = async (file: File) => {\n    setFile(file);\n    setError(null);\n    setSuccess(null);\n    setPreviewData([]);\n\n    try {\n      const data = await parseExcel(file);\n      setPreviewData(data);\n    } catch (err: unknown) {\n      console.error(err);\n      setError(err instanceof Error ? err.message : 'Error parsing file');\n    }\n  };\n\n  const parseExcel = async (file: File): Promise<Record<string, unknown>[]> => {\n    const buffer = await file.arrayBuffer();\n    const workbook = new ExcelJS.Workbook();\n    \n    // Check extension\n    const isCsv = file.name.toLowerCase().endsWith('.csv');\n\n    if (isCsv) {\n        // Manual CSV parsing for browser compatibility (exceljs csv.read requires node streams)\n        const text = await file.text();\n        const sheet = workbook.addWorksheet('Sheet1');\n        const rows = text.split(/\\r?\\n/);\n        \n        rows.forEach(r => {\n            if (r.trim()) {\n                // Split by comma, semicolon, pipe, or tab, respecting quotes\n                // Regex matches delimiters that are NOT inside quotes\n                const cells = r.split(/[,;|\\t](?=(?:(?:[^\"]*\"){2})*[^\"]*$)/); \n                \n                // Clean up quotes (remove outer quotes, unescape double quotes)\n                const cleanedCells = cells.map(c => c.trim().replace(/^\"|\"$/g, '').replace(/\"\"/g, '\"'));\n                sheet.addRow(cleanedCells);\n            }\n        });\n    } else {\n         await workbook.xlsx.load(buffer);\n    }\n    \n    // Get first worksheet\n    const worksheet = workbook.worksheets[0];\n    if (!worksheet) return [];\n\n    const jsonData: Record<string, unknown>[] = [];\n    \n    // Iterate over rows starting from 2 (assuming header is 1)\n    // ExcelJS rows are 1-based.\n    // We need to map headers first.\n    const headers: string[] = [];\n    \n    worksheet.eachRow((row, rowNumber) => {\n      if (rowNumber === 1) {\n        // Capture headers\n        row.eachCell((cell, colNumber) => {\n          headers[colNumber] = normalizeHeader(String(cell.value));\n        });\n      } else {\n        // Capture data\n        const rowData: Record<string, unknown> = {};\n        // Initialize all known headers to null/empty\n        headers.forEach(h => { if(h) rowData[h] = ''; });\n\n        row.eachCell({ includeEmpty: true }, (cell, colNumber) => {\n          const header = headers[colNumber];\n          if (header) {\n             let val = cell.value;\n             if (typeof val === 'object' && val !== null && 'text' in val) {\n                 val = (val as any).text; \n             } else if (typeof val === 'object' && val !== null && 'result' in val) {\n                 val = (val as any).result;\n             }\n             rowData[header] = val;\n          }\n        });\n        jsonData.push(rowData);\n      }\n    });\n\n    return jsonData;\n  };\n\n  const handleImport = async () => {\n    if (!previewData.length) return;\n    setIsProcessing(true);\n    setError(null);\n\n    try {\n      if (activeTab === 'paddler') {\n        await onImportPaddlers(previewData);\n      } else {\n        await onImportEvents(previewData);\n      }\n      setSuccess(t('importSuccess') || 'Import successful');\n      setTimeout(() => {\n        onClose();\n        setSuccess(null);\n        setFile(null);\n        setPreviewData([]);\n      }, 1500);\n    } catch (err: unknown) {\n      setError(err instanceof Error ? err.message : t('importError') || 'Import failed');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleDownloadTemplate = async () => {\n    const workbook = new ExcelJS.Workbook();\n    const sheet = workbook.addWorksheet('Template');\n    const helpSheet = workbook.addWorksheet('Help - Hilfe');\n    \n    let fileName = 'template.xlsx';\n\n    if (activeTab === 'paddler') {\n      fileName = 'paddler_template.xlsx';\n      \n      // Template Data\n      sheet.columns = [\n        { header: 'Name', key: 'Name', width: 20 },\n        { header: 'Weight', key: 'Weight', width: 10 },\n        { header: 'Skills', key: 'Skills', width: 20 },\n        { header: 'Email', key: 'Email', width: 30 },\n      ];\n      \n      sheet.addRow({ Name: 'Max Mustermann', Weight: 85.5, Skills: 'left', Email: 'max@example.com' });\n      sheet.addRow({ Name: 'Erika Musterfrau', Weight: 65.0, Skills: 'right', Email: 'erika@example.com' });\n      sheet.addRow({ Name: 'Tom Trommler', Weight: 60.0, Skills: 'drum', Email: 'tom@example.com' });\n      sheet.addRow({ Name: 'Multi Talent', Weight: 72.5, Skills: 'right, drum, steer', Email: 'multi@example.com' });\n\n      // Help Data\n      helpSheet.columns = [\n        { header: 'Column', key: 'Column', width: 15 },\n        { header: 'Description (DE)', key: 'DescriptionDE', width: 50 },\n        { header: 'Description (EN)', key: 'DescriptionEN', width: 50 },\n      ];\n      \n      helpSheet.addRows([\n        { Column: 'Name', DescriptionDE: 'Vor- und Nachname des Paddlers', DescriptionEN: 'Full name of the paddler' },\n        { Column: 'Weight', DescriptionDE: 'Gewicht in kg (z.B. 85.5)', DescriptionEN: 'Weight in kg (e.g. 85.5)' },\n        { Column: 'Skills', DescriptionDE: 'Skills/Seite: \"left\", \"right\", \"drum\", \"steer\" (kommagetrennt für mehrere)', DescriptionEN: 'Skills/Side: \"left\", \"right\", \"drum\", \"steer\" (comma separated for multiple)' },\n        { Column: 'Email', DescriptionDE: 'E-Mail Adresse für Einladungen (optional)', DescriptionEN: 'Email address for invitations (optional)' }\n      ]);\n      \n    } else {\n      fileName = 'event_template.xlsx';\n      \n      // Template Data\n      sheet.columns = [\n        { header: 'Title', key: 'Title', width: 25 },\n        { header: 'Date', key: 'Date', width: 15 },\n        { header: 'Time', key: 'Time', width: 10 },\n        { header: 'Type', key: 'Type', width: 15 },\n        { header: 'BoatSize', key: 'BoatSize', width: 15 },\n        { header: 'Comment', key: 'Comment', width: 30 },\n      ];\n\n      sheet.addRow({ Title: 'Training Dienstag', Date: '2025-05-20', Time: '19:00', Type: 'training', BoatSize: 'standard', Comment: 'Normales Training' });\n      sheet.addRow({ Title: 'Regatta Hamburg', Date: '2025-06-15', Time: '09:00', Type: 'regatta', BoatSize: 'standard', Comment: 'Bitte pünktlich sein' });\n\n      // Help Data\n      helpSheet.columns = [\n        { header: 'Column', key: 'Column', width: 15 },\n        { header: 'Description (DE)', key: 'DescriptionDE', width: 50 },\n        { header: 'Description (EN)', key: 'DescriptionEN', width: 50 },\n      ];\n      \n      helpSheet.addRows([\n         { Column: 'Title', DescriptionDE: 'Name des Termins', DescriptionEN: 'Name of the event' },\n        { Column: 'Date', DescriptionDE: 'Datum (z.B. 2025-05-20 oder 20.05.2025)', DescriptionEN: 'Date (e.g. 2025-05-20 or 20.05.2025)' },\n        { Column: 'Time', DescriptionDE: 'Uhrzeit (HH:MM)', DescriptionEN: 'Time (HH:MM)' },\n        { Column: 'Type', DescriptionDE: 'Art: \"training\" oder \"regatta\"', DescriptionEN: 'Type: \"training\" or \"regatta\"' },\n        { Column: 'BoatSize', DescriptionDE: 'Bootsklasse: \"standard\" (20) oder \"small\" (10)', DescriptionEN: 'Boat class: \"standard\" (20) or \"small\" (10)' },\n        { Column: 'Comment', DescriptionDE: 'Optionaler Kommentar / Notiz', DescriptionEN: 'Optional comment / note' }\n      ]);\n    }\n\n    // Generate buffer\n    const buffer = await workbook.xlsx.writeBuffer();\n    \n    // Create download link\n    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n    const url = window.URL.createObjectURL(blob);\n    const anchor = document.createElement('a');\n    anchor.href = url;\n    anchor.download = fileName;\n    anchor.click();\n    window.URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\n      <div className=\"bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden border border-slate-200 dark:border-slate-800\">\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50\">\n          <h2 className=\"text-xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2\">\n            <FileUp className=\"text-blue-600 dark:text-blue-400\" />\n            {t('importData') || 'Import Data'}\n          </h2>\n          <button onClick={onClose} className=\"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 transition-colors\">\n            <X size={24} />\n          </button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"flex border-b border-slate-200 dark:border-slate-800\">\n          <button\n            onClick={() => { setActiveTab('paddler'); setFile(null); setPreviewData([]); setError(null); }}\n            className={`flex-1 py-3 text-sm font-medium transition-colors ${\n              activeTab === 'paddler' \n                ? 'bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400' \n                : 'bg-slate-50 dark:bg-slate-950 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-900'\n            }`}\n          >\n            {t('paddlers') || 'Paddlers'}\n          </button>\n          <button\n            onClick={() => { setActiveTab('event'); setFile(null); setPreviewData([]); setError(null); }}\n            className={`flex-1 py-3 text-sm font-medium transition-colors ${\n              activeTab === 'event' \n                ? 'bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400' \n                : 'bg-slate-50 dark:bg-slate-950 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-900'\n            }`}\n          >\n            {t('events') || 'Events'}\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-700\">\n          \n          {/* Messages */}\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg text-sm flex items-center gap-2 border border-red-100 dark:border-red-900/30\">\n              <AlertCircle size={16} />\n              {error}\n            </div>\n          )}\n          \n          {success && (\n            <div className=\"mb-4 p-3 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 rounded-lg text-sm flex items-center gap-2 border border-green-100 dark:border-green-900/30\">\n              <CheckCircle size={16} />\n              {success}\n            </div>\n          )}\n\n          {/* Upload Area */}\n          {!file ? (\n            <div \n              onDragOver={handleDragOver}\n              onDragLeave={handleDragLeave}\n              onDrop={handleDrop}\n              className={`border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center text-center transition-all duration-200 cursor-pointer ${\n                isDragOver \n                  ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]' \n                  : 'border-slate-300 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 hover:bg-slate-50 dark:hover:bg-slate-900/50'\n              }`}\n            >\n              <input \n                type=\"file\" \n                accept=\".xlsx, .xls, .csv\" \n                onChange={handleFileSelect} \n                className=\"hidden\" \n                id=\"file-upload\"\n              />\n              <label htmlFor=\"file-upload\" className=\"cursor-pointer flex flex-col items-center w-full h-full\">\n                <div className=\"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center mb-4\">\n                  <Upload size={32} />\n                </div>\n                <h3 className=\"text-lg font-semibold text-slate-800 dark:text-slate-200 mb-1\">\n                  {t('dragDropOrClick') || 'Click to upload or drag and drop'}\n                </h3>\n                <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-4\">\n                  {t('supportedFormats') || 'Supports .xlsx, .xls, .csv'}\n                </p>\n                \n                {/* Format Hint */}\n                <div className=\"bg-slate-100 dark:bg-slate-800 rounded-lg p-3 text-xs text-left w-full max-w-sm\">\n                  <div className=\"flex justify-between items-center mb-1\">\n                    <p className=\"font-semibold text-slate-700 dark:text-slate-300\">{t('preview') || 'Expected Format'}:</p>\n                    <button \n                      onClick={(e) => { e.preventDefault(); handleDownloadTemplate(); }}\n                      className=\"text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1\"\n                    >\n                      <Download size={12} />\n                      {t('downloadTemplate') || 'Template'}\n                    </button>\n                  </div>\n                  {activeTab === 'paddler' ? (\n                    <code className=\"block text-slate-600 dark:text-slate-400 font-mono\">\n                      {t('paddlerTemplateColumns') || 'Name | Weight | Side | Skills | Email'}\n                    </code>\n                  ) : (\n                    <code className=\"block text-slate-600 dark:text-slate-400 font-mono\">\n                      {t('eventTemplateColumns') || 'Title | Date | Time | Type | BoatSize | Comment'}\n                    </code>\n                  )}\n                </div>\n              </label>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between bg-slate-50 dark:bg-slate-800/50 p-3 rounded-lg border border-slate-200 dark:border-slate-700\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-10 h-10 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg flex items-center justify-center\">\n                    <FileUp size={20} />\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-slate-800 dark:text-slate-200 text-sm\">{file.name}</p>\n                    <p className=\"text-xs text-slate-500\">{(file.size / 1024).toFixed(1)} KB • {previewData.length} {t('rowsFound')}</p>\n                  </div>\n                </div>\n                <button \n                  onClick={() => { setFile(null); setPreviewData([]); }}\n                  className=\"p-2 hover:bg-white dark:hover:bg-slate-700 rounded-full text-slate-500 transition-colors\"\n                >\n                  <X size={16} />\n                </button>\n              </div>\n\n              {/* Preview Table */}\n              {previewData.length > 0 && (\n                <div className=\"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden flex flex-col max-h-[50vh]\">\n                  <div className=\"bg-slate-50 dark:bg-slate-800 px-3 py-2 border-b border-slate-200 dark:border-slate-700 flex-shrink-0\">\n                    <h4 className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">{t('preview')} ({previewData.length} Items)</h4>\n                  </div>\n                  <div className=\"overflow-auto flex-1\">\n                    <table className=\"w-full text-sm text-left relative\">\n                      <thead className=\"bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 font-medium sticky top-0 z-10 shadow-sm\">\n                        <tr>\n                          {Object.keys(previewData[0] || {}).map((key) => {\n                            // Map canonical keys to translation keys\n                            const translationMap: { [key: string]: string } = {\n                              title: 'title',\n                              date: 'date',\n                              time: 'time',\n                              type: 'type',\n                              boatSize: 'boatSize',\n                              comment: 'comment',\n                              name: 'name',\n                              weight: 'weight',\n                              side: 'skills',\n                              email: 'emailAddress',\n                              skills: 'skills',\n                            };\n                            const translationKey = translationMap[key];\n                            const displayName = translationKey ? (t(translationKey) || key) : key;\n                            return (\n                              <th key={key} className=\"px-3 py-2 whitespace-nowrap bg-slate-50 dark:bg-slate-900 capitalize\">{displayName}</th>\n                            );\n                          })}\n                        </tr>\n                      </thead>\n                      <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\n                        {previewData.map((row, i) => (\n                          <tr key={i} className=\"hover:bg-slate-50 dark:hover:bg-slate-800/30\">\n                            {Object.values(row).map((val: unknown, j) => (\n                              <td key={j} className=\"px-3 py-2 whitespace-nowrap text-slate-700 dark:text-slate-300\">\n                                {String(val)}\n                              </td>\n                            ))}\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 flex justify-end gap-3\">\n          <button \n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg transition-colors\"\n          >\n            {t('cancel') || 'Cancel'}\n          </button>\n          <button \n            onClick={handleImport}\n            disabled={!file || !previewData.length || isProcessing}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg shadow-sm transition-all flex items-center gap-2\"\n          >\n            {isProcessing ? (\n              <>\n                <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                Importing...\n              </>\n            ) : (\n              <>\n                <Upload size={16} />\n                {t('importButton')} {previewData.length} Items\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/InviteMemberForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport { Button } from \"@/components/ui/button\"\nimport { FormInput } from \"@/components/ui/FormInput\"\nimport { Label } from \"@/components/ui/label\"\nimport { inviteMember } from \"@/app/actions/team\"\nimport { useLanguage } from \"@/context/LanguageContext\"\nimport { Loader2, Check, Mail } from \"lucide-react\"\n\ninterface InviteMemberFormProps {\n  teamId: string\n  onSuccess?: () => void\n}\n\nexport function InviteMemberForm({ teamId, onSuccess }: InviteMemberFormProps) {\n  const { t } = useLanguage()\n  const [email, setEmail] = useState(\"\")\n  const [status, setStatus] = useState<\"idle\" | \"loading\" | \"success\" | \"error\">(\"idle\")\n  const [errorMessage, setErrorMessage] = useState(\"\")\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setStatus(\"loading\")\n    setErrorMessage(\"\")\n\n    try {\n      await inviteMember(teamId, email)\n      setStatus(\"success\")\n      setEmail(\"\")\n      // Call onSuccess callback to refresh the member list\n      onSuccess?.()\n    } catch (error) {\n      setStatus(\"error\")\n      if (error instanceof Error) {\n        if (error.message === \"USER_NOT_FOUND\") {\n          setErrorMessage(t('errorUserNotFound'))\n        } else if (error.message === \"USER_ALREADY_MEMBER\") {\n          setErrorMessage(t('errorUserAlreadyMember'))\n        } else {\n          setErrorMessage(error.message)\n        }\n      } else {\n        setErrorMessage(t('invitationFailed'))\n      }\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"email\">{t('emailAddress')}</Label>\n          <div className=\"flex gap-2\">\n            <FormInput\n              id=\"email\"\n              type=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              placeholder={t('emailPlaceholder') || 'paddler@example.com'}\n              className=\"flex-1 focus:ring-amber-500\"\n              required\n            />\n            <button\n              type=\"submit\"\n              disabled={status === \"loading\"}\n              className={`flex items-center gap-2 px-4 py-2 font-medium rounded-lg shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed\n                ${status === 'success'\n                  ? 'bg-green-500 hover:bg-green-600 text-white shadow-green-500/20'\n                  : 'bg-amber-500 hover:bg-amber-600 text-white shadow-amber-500/20'\n                }\n              `}\n            >\n              {status === \"loading\" ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  {t('inviting')}\n                </>\n              ) : status === 'success' ? (\n                <>\n                  <Check className=\"mr-2 h-4 w-4\" />\n                  {t('invitationSuccess') || 'Sent!'}\n                </>\n              ) : (\n                <>\n                  <Mail className=\"mr-2 h-4 w-4\" />\n                  {t('invite')}\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n        {status === \"success\" && (\n          <p className=\"text-sm text-green-600\">{t('invitationSuccess')}</p>\n        )}\n        {status === \"error\" && (\n          <p className=\"text-sm text-red-600\">{errorMessage}</p>\n        )}\n      </form>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/NewEventForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/PaddlerForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[579,582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[579,582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[663,666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[663,666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'result' is assigned a value but never used.","line":94,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3529,3532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3529,3532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { User, Pencil, Save, Plus, Link as LinkIcon, Mail, Loader2, Check } from 'lucide-react';\nimport { Paddler } from '@/types';\nimport { FormInput } from '@/components/ui/FormInput';\nimport { WeightInput } from '@/components/ui/WeightInput';\nimport { SkillSelector, SkillsState } from '@/components/ui/SkillSelector';\nimport { linkPaddlerToAccount } from '@/app/actions/team';\nimport { useDrachenboot } from '@/context/DrachenbootContext';\n\ninterface PaddlerFormProps {\n  paddlerToEdit: Paddler | null;\n  onSave: (paddler: any) => void;\n  onCancel: () => void;\n  t: (key: string) => string;\n  teamMembers?: any[];\n  isModal?: boolean;\n  isGuest?: boolean;\n}\n\nconst PaddlerForm: React.FC<PaddlerFormProps> = ({ paddlerToEdit, onSave, onCancel, t, teamMembers = [], isModal = false, isGuest = false }) => {\n  const [name, setName] = useState<string>('');\n  const [weight, setWeight] = useState<string>('');\n  const [skills, setSkills] = useState<SkillsState>({ left: false, right: false, drum: false, steer: false, stroke: false, steer_preferred: false });\n  const [userId, setUserId] = useState<string>('');\n  const [linkEmail, setLinkEmail] = useState<string>('');\n  const [isLinking, setIsLinking] = useState(false);\n  const [linkSuccess, setLinkSuccess] = useState(false);\n  const [linkError, setLinkError] = useState<string | null>(null);\n\n  const [touched, setTouched] = useState(false);\n  const { refetchPaddlers } = useDrachenboot();\n\n  useEffect(() => {\n    if (paddlerToEdit) {\n      setName(paddlerToEdit.name);\n      setWeight(paddlerToEdit.weight.toString());\n      const sObj: SkillsState = { left: false, right: false, drum: false, steer: false, stroke: false, steer_preferred: false };\n      if (paddlerToEdit.skills) paddlerToEdit.skills.forEach((s) => {\n        if (s in sObj) sObj[s as keyof typeof sObj] = true;\n      });\n      setSkills(sObj);\n      setUserId(paddlerToEdit.userId || '');\n      setLinkEmail('');\n      setLinkError(null);\n      setLinkSuccess(false);\n    } else {\n      resetForm();\n    }\n  }, [paddlerToEdit]);\n\n  const resetForm = () => {\n    setName('');\n    setWeight('');\n    setSkills({ left: false, right: false, drum: false, steer: false, stroke: false, steer_preferred: false });\n    setUserId('');\n    setLinkEmail('');\n    setLinkError(null);\n    setLinkSuccess(false);\n    setTouched(false);\n  };\n\n  const [activeTab, setActiveTab] = useState<'general' | 'preferences'>('general');\n\n  const handleSkillChange = (skill: keyof SkillsState) => {\n    setSkills((prev) => ({ ...prev, [skill]: !prev[skill] }));\n  };\n\n  const isFormValid = name.trim() !== '' && weight.trim() !== '';\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setTouched(true);\n    \n    if (!isFormValid) return;\n\n    const skillsArray = (Object.keys(skills) as Array<keyof typeof skills>).filter((k) => skills[k]);\n    \n    onSave({ \n      name, \n      weight: parseFloat(weight), \n      skills: skillsArray,\n      userId: userId || null\n    });\n    if (!paddlerToEdit) resetForm();\n  };\n\n  const handleLinkAccount = async () => {\n    if (!linkEmail.trim() || !paddlerToEdit) return;\n    \n    setIsLinking(true);\n    setLinkError(null);\n    \n    try {\n      const result = await linkPaddlerToAccount(paddlerToEdit.id as string, linkEmail.trim());\n      setLinkSuccess(true);\n      await refetchPaddlers();\n      \n      // Close the form after a delay\n      setTimeout(() => {\n        onCancel();\n      }, 1500);\n    } catch (e: any) {\n      if (e.message === 'USER_ALREADY_MEMBER') {\n        setLinkError(t('userAlreadyMember') || 'User is already a team member');\n      } else if (e.message === 'PADDLER_ALREADY_LINKED') {\n        setLinkError(t('paddlerAlreadyLinked') || 'Paddler is already linked to an account');\n      } else {\n        setLinkError(e.message || t('linkError') || 'Failed to link account');\n      }\n    } finally {\n      setIsLinking(false);\n    }\n  };\n\n  const containerClasses = isModal \n    ? \"p-6\" \n    : `p-6 rounded-xl shadow-sm border transition-all h-full ${paddlerToEdit ? 'bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800 ring-1 ring-orange-200 dark:ring-orange-900' : 'bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800'}`;\n\n  return (\n    <div id=\"tour-paddler-form\" className={containerClasses}>\n      {!isModal && (\n        <h3 className={`font-bold mb-4 flex items-center gap-2 text-sm uppercase tracking-wide ${paddlerToEdit ? 'text-orange-800 dark:text-orange-200' : 'text-slate-700 dark:text-slate-200'}`}>\n          {paddlerToEdit ? <Pencil size={16} /> : <User size={16} />} {paddlerToEdit ? t('editPaddler') : t('newMember')}\n        </h3>\n      )}\n      \n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        {/* Tabs */}\n        <div className=\"flex gap-2 border-b border-slate-200 dark:border-slate-700 mb-4\">\n             <button\n                type=\"button\"\n                onClick={() => setActiveTab('general')}\n                className={`pb-2 px-1 text-sm font-medium transition-colors border-b-2 ${\n                  activeTab === 'general'\n                    ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                    : 'border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400'\n                }`}\n             >\n                {t('tabGeneral') || 'General'}\n             </button>\n             <button\n                type=\"button\"\n                onClick={() => setActiveTab('preferences')}\n                className={`pb-2 px-1 text-sm font-medium transition-colors border-b-2 ${\n                  activeTab === 'preferences'\n                    ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                    : 'border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400'\n                }`}\n             >\n                {t('tabPreferences') || 'Auto-Assignment'}\n             </button>\n        </div>\n\n        {activeTab === 'general' && (\n        <>\n        <div className=\"flex flex-col md:flex-row gap-4\">\n          <div className=\"flex-1\">\n            <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-1 block\">{t('name')}</label>\n            <FormInput\n              value={name} \n              onChange={(e) => setName(e.target.value)} \n              placeholder={t('name')}\n              error={touched && !name.trim()}\n            />\n          </div>\n          <div className=\"w-full md:w-32\">\n            <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-1 block\">{t('weight')}</label>\n            <WeightInput\n              value={weight} \n              onChange={setWeight} \n            />\n          </div>\n        </div>\n        \n        {/* Account Linking Section */}\n        {!isGuest && paddlerToEdit && (\n        <div className=\"space-y-3\">\n          <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-1 block flex items-center gap-1\">\n            <LinkIcon size={12} /> {t('linkedAccount') || 'Linked Account'}\n          </label>\n          \n          {userId ? (\n            // Already linked - show read-only email\n            <div className=\"w-full p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded text-sm text-green-700 dark:text-green-400 flex items-center gap-2\">\n              <Check size={14} />\n              {teamMembers.find(m => m.userId === userId)?.email || paddlerToEdit.user?.email || t('accountLinked') || 'Account Linked'}\n            </div>\n          ) : linkSuccess ? (\n            // Just linked successfully\n            <div className=\"w-full p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded text-sm text-green-700 dark:text-green-400 flex items-center gap-2\">\n              <Check size={14} />\n              {t('accountLinkedSuccess') || 'Account linked successfully!'}\n            </div>\n          ) : (\n            // Not linked - show input to link\n            <>\n              <div className=\"flex gap-2\">\n                <div className=\"flex-1\">\n                  <FormInput\n                    type=\"email\"\n                    value={linkEmail}\n                    onChange={(e) => setLinkEmail(e.target.value)}\n                    placeholder={t('emailToLink') || 'Enter email to link'}\n                    disabled={isLinking}\n                  />\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={handleLinkAccount}\n                  disabled={!linkEmail.trim() || isLinking}\n                  className={`h-10 px-4 rounded text-sm font-medium flex items-center justify-center gap-2 transition-all ${\n                    linkEmail.trim() && !isLinking\n                      ? 'bg-blue-600 hover:bg-blue-700 text-white'\n                      : 'bg-slate-200 dark:bg-slate-800 text-slate-400 cursor-not-allowed'\n                  }`}\n                >\n                  {isLinking ? <Loader2 size={14} className=\"animate-spin\" /> : <Mail size={14} />}\n                  {t('link') || 'Link'}\n                </button>\n              </div>\n              <p className=\"text-xs text-slate-500 dark:text-slate-400\">\n                {t('linkAccountHint') || 'If the email has an account, the paddler will be linked. Otherwise, an invitation will be sent.'}\n              </p>\n              {linkError && (\n                <div className=\"p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-sm text-red-600 dark:text-red-400\">\n                  {linkError}\n                </div>\n              )}\n            </>\n          )}\n        </div>\n        )}\n\n        <div>\n          <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-2 block\">{t('skills')}</label>\n          <SkillSelector \n            skills={skills} \n            onChange={handleSkillChange} \n          />\n        </div>\n        </>\n        )}\n\n        {activeTab === 'preferences' && (\n        /* Special Roles Section */\n        <div>\n          <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-2 block\">{t('specialRoles')}</label>\n          <p className=\"text-xs text-slate-500 mb-3\">\n             {t('helpCalculation2') || \"Special preferences for the Magic AI algorithm.\"}\n          </p>\n          <div className=\"flex flex-col gap-2\">\n            <button\n              type=\"button\"\n              onClick={() => handleSkillChange('stroke')}\n              className={`px-4 py-3 rounded-lg border text-sm font-medium transition-all flex items-center justify-between w-full ${\n                skills.stroke\n                  ? 'bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300'\n                  : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:border-slate-300'\n              }`}\n            >\n              <div className=\"flex flex-col text-left\">\n                  <span className=\"font-bold\">{t('stroke') || 'Stroke'}</span>\n                  <span className=\"text-xs opacity-75 font-normal\">{t('strokeDesc') || 'Prioritized for front row'}</span>\n              </div>\n              {skills.stroke && <Check size={18} strokeWidth={2.5} />}\n            </button>\n            \n            <button\n              type=\"button\"\n              onClick={() => handleSkillChange('steer_preferred')}\n              className={`px-4 py-3 rounded-lg border text-sm font-medium transition-all flex items-center justify-between w-full ${\n                skills.steer_preferred\n                  ? 'bg-purple-50 border-purple-200 text-purple-700 dark:bg-purple-900/20 dark:border-purple-800 dark:text-purple-300'\n                  : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:border-slate-300'\n              }`}\n            >\n              <div className=\"flex flex-col text-left\">\n                  <span className=\"font-bold\">{t('steerPreferred') || 'Preferred Steersman'}</span>\n                  <span className=\"text-xs opacity-75 font-normal\">{t('steerPreferredDesc') || 'Prioritized for steering position'}</span>\n              </div>\n              {skills.steer_preferred && <Check size={18} strokeWidth={2.5} />}\n            </button>\n          </div>\n        </div>\n        )}\n\n        <div className=\"flex flex-col-reverse sm:flex-row gap-2 pt-2 justify-end mt-6 border-t border-slate-100 dark:border-slate-800\">\n          {(!isModal && paddlerToEdit) && <button type=\"button\" onClick={onCancel} className=\"w-full sm:w-auto bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700 px-4 py-2 rounded text-sm\">{t('cancel')}</button>}\n          {isModal && <button type=\"button\" onClick={onCancel} className=\"w-full sm:w-auto bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700 px-4 py-2 rounded text-sm\">{t('cancel')}</button>}\n          <button \n            type=\"submit\" \n            className={`w-full sm:w-auto h-9 px-6 py-2 rounded text-sm font-medium flex items-center justify-center gap-2 transition-all\n              ${isFormValid \n                ? (paddlerToEdit ? 'bg-orange-500 hover:bg-orange-600 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white') \n                : 'bg-slate-200 dark:bg-slate-800 text-slate-400 cursor-not-allowed opacity-70'\n              }`}\n          >\n            {paddlerToEdit ? <Save size={16} /> : <Plus size={16} />} {paddlerToEdit ? t('save') : t('add')}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default PaddlerForm;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/PaddlerGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Mail' is defined but never used.","line":2,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":70}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Users, Pencil, Trash2, Link as LinkIcon, AlertTriangle, Mail, Clock } from 'lucide-react';\nimport SkillBadges from '../../ui/SkillBadges';\nimport { Paddler } from '@/types';\n\ninterface PaddlerGridProps {\n  paddlers: Paddler[];\n  editingId: number | string | null;\n  onEdit: (paddler: Paddler) => void;\n  onDelete: (id: number | string) => void;\n  t: (key: string) => string;\n  headerAction?: React.ReactNode;\n}\n\nimport { useDrachenboot } from '@/context/DrachenbootContext';\nimport { useSession } from 'next-auth/react';\n\nconst PaddlerGrid: React.FC<PaddlerGridProps> = ({ paddlers, editingId, onEdit, onDelete, t, headerAction }) => {\n  const { userRole } = useDrachenboot();\n  const { data: session } = useSession();\n  const [deleteConfirmId, setDeleteConfirmId] = useState<number | string | null>(null);\n\n  const triggerDelete = (id: number | string) => {\n    if (deleteConfirmId === id) { \n      onDelete(id); \n      setDeleteConfirmId(null); \n    } else { \n      setDeleteConfirmId(id); \n      setTimeout(() => setDeleteConfirmId(null), 5000); \n    }\n  };\n\n  return (\n    <div id=\"tour-paddler-grid\" className=\"bg-white dark:bg-slate-900 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 h-full\">\n      <div className=\"flex justify-between items-center mb-4\">\n        <h3 className=\"font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2 text-sm uppercase tracking-wide\"><Users size={16} /> {t('squad')} ({paddlers.length})</h3>\n        {headerAction}\n      </div>\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\n        {paddlers.map((p) => {\n           const canViewWeight = userRole === 'CAPTAIN' || (session?.user?.id && p.userId === session.user.id);\n           const isLinked = !!p.userId;\n           const isPending = !!p.inviteEmail && !p.userId;\n           const isConfirmingDelete = deleteConfirmId === p.id;\n           return (\n          <div key={p.id} className={`p-3 border rounded-xl transition-all relative group ${\n            editingId === p.id \n              ? 'border-orange-400 bg-orange-50 dark:bg-orange-900/20' \n              : isConfirmingDelete && (isLinked || isPending) \n                ? 'border-red-300 bg-red-50 dark:bg-red-900/20 dark:border-red-800' \n                : isPending\n                  ? 'bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800/50'\n                  : 'bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:bg-white dark:hover:bg-slate-700'\n          }`}>\n            <div className=\"flex justify-between items-start\">\n              <div>\n                <div className=\"font-bold text-slate-800 dark:text-slate-200 flex items-center gap-1\">\n                  {isPending ? (\n                    <>\n                      <span className=\"text-amber-700 dark:text-amber-400\">{p.inviteEmail}</span>\n                      <span title={t('pendingInvite') || 'Pending Invitation'}>\n                        <Clock size={14} className=\"text-amber-500\" />\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      {p.name}\n                      {p.userId && (\n                        <span title={`${t('linkedAccount')}${p.user?.email ? `: ${p.user.email}` : ''}`}>\n                          <LinkIcon size={14} className=\"text-blue-500\" />\n                        </span>\n                      )}\n                    </>\n                  )}\n                </div>\n                <div className=\"text-xs text-slate-600 dark:text-slate-400 mt-1 font-mono h-4\">\n                  {isPending ? (\n                    <span className=\"text-amber-600 dark:text-amber-400\">{t('pendingRegistration') || 'Pending registration'}</span>\n                  ) : canViewWeight ? `${p.weight} kg` : '\\u00A0'}\n                </div>\n              </div>\n              {!isPending && <SkillBadges skills={p.skills} />}\n            </div>\n            \n            {/* Warning for linked/pending paddler deletion */}\n            {isConfirmingDelete && (isLinked || isPending) && (\n              <div className=\"mt-2 p-2 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-start gap-2 text-xs text-red-700 dark:text-red-300\">\n                <AlertTriangle size={14} className=\"shrink-0 mt-0.5\" />\n                <span>{isPending ? (t('deleteInvitedPaddlerWarning') || 'This will cancel the invitation!') : (t('deleteLinkedPaddlerWarning') || 'This will remove the user from the team!')}</span>\n              </div>\n            )}\n            \n            {userRole === 'CAPTAIN' && (\n            <div className={`flex gap-1 transition-opacity ${\n              isConfirmingDelete \n                ? 'relative mt-2 justify-end opacity-100' \n                : 'absolute bottom-2 right-2 opacity-0 group-hover:opacity-100'\n            }`}>\n              {!isPending && <button onClick={() => onEdit(p)} className=\"bg-white dark:bg-slate-700 text-slate-400 hover:text-orange-500 p-1.5 rounded-lg border dark:border-slate-600 shadow-sm\"><Pencil size={12} /></button>}\n              <button onClick={() => triggerDelete(p.id)} className={`p-1.5 rounded-lg border shadow-sm transition-colors ${isConfirmingDelete ? 'bg-red-600 text-white border-red-700' : 'bg-white dark:bg-slate-700 text-slate-400 hover:text-red-500 dark:border-slate-600'}`}><Trash2 size={12} /></button>\n            </div>\n            )}\n          </div>\n        )})}\n      </div>\n    </div>\n  );\n};\n\nexport default PaddlerGrid;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/PaddlerModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[455,458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[455,458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[515,518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[515,518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1566,1569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1566,1569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { X, User, Mail } from 'lucide-react';\nimport PaddlerForm from './PaddlerForm';\nimport { Paddler } from '@/types';\nimport { FormInput } from '@/components/ui/FormInput';\nimport { inviteMember } from '@/app/actions/team';\nimport { useDrachenboot } from '@/context/DrachenbootContext';\n\ninterface PaddlerModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  paddlerToEdit: Paddler | null;\n  onSave: (data: any) => void;\n  t: (key: string) => string;\n  teamMembers?: any[];\n  errorMessage?: string | null;\n}\n\nconst PaddlerModal: React.FC<PaddlerModalProps> = ({ isOpen, onClose, paddlerToEdit, onSave, t, teamMembers, errorMessage }) => {\n  const [activeTab, setActiveTab] = useState<'create' | 'invite'>('create');\n  const [inviteEmail, setInviteEmail] = useState('');\n  const [inviteLoading, setInviteLoading] = useState(false);\n  const [inviteError, setInviteError] = useState<string | null>(null);\n  const [inviteSuccess, setInviteSuccess] = useState(false);\n  const { currentTeam, refetchPaddlers } = useDrachenboot();\n\n  if (!isOpen) return null;\n\n  const handleInvite = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!inviteEmail.trim() || !currentTeam) return;\n    \n    setInviteLoading(true);\n    setInviteError(null);\n    \n    try {\n      await inviteMember(currentTeam.id, inviteEmail.trim());\n      await refetchPaddlers();\n      setInviteSuccess(true);\n      setInviteEmail('');\n      setTimeout(() => {\n        setInviteSuccess(false);\n        onClose();\n      }, 1500);\n    } catch (e: any) {\n      if (e.message === 'USER_ALREADY_MEMBER') {\n        setInviteError(t('userAlreadyMember') || 'User is already a team member');\n      } else if (e.message === 'EMAIL_ALREADY_INVITED') {\n        setInviteError(t('emailAlreadyInvited') || 'This email has already been invited');\n      } else {\n        setInviteError(e.message || t('inviteError') || 'Failed to send invitation');\n      }\n    } finally {\n      setInviteLoading(false);\n    }\n  };\n\n  const handleClose = () => {\n    setInviteEmail('');\n    setInviteError(null);\n    setInviteSuccess(false);\n    setActiveTab('create');\n    onClose();\n  };\n\n  // If editing, only show the paddler form (no tabs)\n  if (paddlerToEdit) {\n    return (\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\">\n        <div className=\"bg-white dark:bg-slate-900 rounded-xl shadow-xl w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-200 border border-slate-200 dark:border-slate-800\">\n          <div className=\"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50\">\n            <h3 className=\"font-bold text-lg text-slate-800 dark:text-slate-200\">\n              {t('editPaddler')}\n            </h3>\n            <button \n              onClick={handleClose}\n              className=\"p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\"\n            >\n              <X size={20} />\n            </button>\n          </div>\n          \n          <div className=\"p-0\">\n            {errorMessage && (\n              <div className=\"mx-6 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm\">\n                {errorMessage}\n              </div>\n            )}\n            <PaddlerForm \n              paddlerToEdit={paddlerToEdit}\n              onSave={onSave}\n              onCancel={handleClose}\n              t={t}\n              teamMembers={teamMembers}\n              isModal={true}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\">\n      <div className=\"bg-white dark:bg-slate-900 rounded-xl shadow-xl w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-200 border border-slate-200 dark:border-slate-800\">\n        {/* Header with Tabs */}\n        <div className=\"border-b border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50\">\n          <div className=\"flex justify-between items-center p-4 pb-0\">\n            <h3 className=\"font-bold text-lg text-slate-800 dark:text-slate-200\">\n              {t('addMember') || 'Add Member'}\n            </h3>\n            <button \n              onClick={handleClose}\n              className=\"p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\"\n            >\n              <X size={20} />\n            </button>\n          </div>\n          \n          {/* Tabs */}\n          <div className=\"flex gap-1 px-4 pt-3\">\n            <button\n              onClick={() => setActiveTab('create')}\n              className={`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${\n                activeTab === 'create'\n                  ? 'bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 border-t border-x border-slate-200 dark:border-slate-700'\n                  : 'text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300'\n              }`}\n            >\n              <User size={16} />\n              {t('newPaddler') || 'New Paddler'}\n            </button>\n            <button\n              onClick={() => setActiveTab('invite')}\n              className={`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${\n                activeTab === 'invite'\n                  ? 'bg-white dark:bg-slate-900 text-blue-600 dark:text-blue-400 border-t border-x border-slate-200 dark:border-slate-700'\n                  : 'text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300'\n              }`}\n            >\n              <Mail size={16} />\n              {t('inviteMember') || 'Invite'}\n            </button>\n          </div>\n        </div>\n        \n        {/* Content */}\n        <div className=\"p-0\">\n          {activeTab === 'create' ? (\n            <>\n              {errorMessage && (\n                <div className=\"mx-6 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm\">\n                  {errorMessage}\n                </div>\n              )}\n              <PaddlerForm \n                paddlerToEdit={null}\n                onSave={onSave}\n                onCancel={handleClose}\n                t={t}\n                teamMembers={teamMembers}\n                isModal={true}\n              />\n            </>\n          ) : (\n            <form onSubmit={handleInvite} className=\"p-6 space-y-4\">\n              <div>\n                <label className=\"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 mb-1 block\">\n                  {t('email') || 'Email'}\n                </label>\n                <FormInput\n                  type=\"email\"\n                  value={inviteEmail}\n                  onChange={(e) => setInviteEmail(e.target.value)}\n                  placeholder={t('emailPlaceholder') || 'email@example.com'}\n                  disabled={inviteLoading || inviteSuccess}\n                />\n              </div>\n              \n              <p className=\"text-sm text-slate-500 dark:text-slate-400\">\n                {t('inviteDescription') || 'The person will be added to the team. If they don\\'t have an account yet, they can sign up and will automatically be part of the team.'}\n              </p>\n              \n              {inviteError && (\n                <div className=\"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400 text-sm\">\n                  {inviteError}\n                </div>\n              )}\n              \n              {inviteSuccess && (\n                <div className=\"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg text-green-600 dark:text-green-400 text-sm\">\n                  {t('inviteSuccess') || 'Invitation sent successfully!'}\n                </div>\n              )}\n              \n              <div className=\"flex flex-col-reverse sm:flex-row gap-2 pt-2 justify-end\">\n                <button\n                  type=\"button\"\n                  onClick={handleClose}\n                  className=\"w-full sm:w-auto bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700 px-4 py-2 rounded text-sm\"\n                >\n                  {t('cancel')}\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={inviteLoading || !inviteEmail.trim() || inviteSuccess}\n                  className={`w-full sm:w-auto h-9 px-6 py-2 rounded text-sm font-medium flex items-center justify-center gap-2 transition-all ${\n                    inviteSuccess\n                      ? 'bg-green-500 text-white'\n                      : inviteEmail.trim() && !inviteLoading\n                        ? 'bg-blue-600 hover:bg-blue-700 text-white'\n                        : 'bg-slate-200 dark:bg-slate-800 text-slate-400 cursor-not-allowed opacity-70'\n                  }`}\n                >\n                  <Mail size={16} />\n                  {inviteLoading ? (t('sending') || 'Sending...') : inviteSuccess ? (t('sent') || 'Sent!') : (t('invite') || 'Invite')}\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PaddlerModal;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/TeamSettingsForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/drachenboot/team/__tests__/PaddlerForm.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":18,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":18,"endColumn":33},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":33,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":33,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1284,1287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1284,1287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":37,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":37,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1486,1489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1486,1489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":41,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":41,"endColumn":33}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { render, screen } from '@testing-library/react';\nimport PaddlerForm from '../PaddlerForm';\n\n// Mocks to bypass ESM and dependency issues\njest.mock('@/app/actions/team', () => ({\n  linkPaddlerToAccount: jest.fn(),\n  inviteMember: jest.fn(),\n}));\n\njest.mock('@/context/DrachenbootContext', () => ({\n  useDrachenboot: jest.fn(() => ({\n    refetchPaddlers: jest.fn(),\n  })),\n}));\n\njest.mock('lucide-react', () => {\n  const React = require('react');\n  return {\n    User: () => React.createElement('div', { 'data-testid': 'icon-user' }),\n    Pencil: () => React.createElement('div', { 'data-testid': 'icon-pencil' }),\n    Save: () => React.createElement('div', { 'data-testid': 'icon-save' }),\n    Plus: () => React.createElement('div', { 'data-testid': 'icon-plus' }),\n    Link: () => React.createElement('div', { 'data-testid': 'icon-link' }),\n    Mail: () => React.createElement('div', { 'data-testid': 'icon-mail' }),\n    Loader2: () => React.createElement('div', { 'data-testid': 'icon-loader' }),\n    Check: () => React.createElement('div', { 'data-testid': 'icon-check' }),\n  };\n});\n\n// Mock child components to isolate unit test\njest.mock('@/components/ui/FormInput', () => {\n  const React = require('react');\n  return { FormInput: ({ ...props }: any) => React.createElement('input', { ...props, 'data-testid': 'form-input' }) };\n});\njest.mock('@/components/ui/WeightInput', () => {\n  const React = require('react');\n  return { WeightInput: (props: any) => React.createElement('input', { ...props, 'data-testid': 'weight-input' }) };\n});\njest.mock('@/components/ui/SkillSelector', () => {\n  const React = require('react');\n  return { SkillSelector: () => React.createElement('div', { 'data-testid': 'skill-selector' }) };\n});\n\ndescribe('PaddlerForm', () => {\n  const mockSave = jest.fn();\n  const mockCancel = jest.fn();\n  const mockT = (key: string) => key;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders without crashing', () => {\n    render(<PaddlerForm paddlerToEdit={null} onSave={mockSave} onCancel={mockCancel} t={mockT} />);\n    expect(screen.getByTestId('icon-user')).toBeInTheDocument(); // newMember icon\n    // Check if form inputs are rendered (via mocks)\n    expect(screen.getAllByTestId('form-input').length).toBeGreaterThan(0);\n    expect(screen.getByTestId('weight-input')).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/DragonBoatAnimation.tsx","messages":[{"ruleId":"react/no-unknown-property","severity":2,"message":"Unknown property 'jsx' found","line":21,"column":14,"nodeType":"JSXAttribute","messageId":"unknownProp","endLine":21,"endColumn":17},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\n/Users/janhartje/drachenbootplan/src/components/ui/DragonBoatAnimation.tsx:62:23\n  60 |             className=\"absolute h-[1px] bg-gradient-to-l from-blue-500 dark:from-cyan-500 to-transparent opacity-30 rounded-full\"\n  61 |             style={{\n> 62 |               top: `${Math.random() * 100}%`,\n     |                       ^^^^^^^^^^^^^ Cannot call impure function\n  63 |               width: `${100 + Math.random() * 300}px`,\n  64 |               animation: `flow ${2 + Math.random() * 3}s linear infinite`,\n  65 |               animationDelay: `-${Math.random() * 5}s`","line":62,"column":23,"nodeType":null,"endLine":62,"endColumn":36},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\n/Users/janhartje/drachenbootplan/src/components/ui/DragonBoatAnimation.tsx:63:31\n  61 |             style={{\n  62 |               top: `${Math.random() * 100}%`,\n> 63 |               width: `${100 + Math.random() * 300}px`,\n     |                               ^^^^^^^^^^^^^ Cannot call impure function\n  64 |               animation: `flow ${2 + Math.random() * 3}s linear infinite`,\n  65 |               animationDelay: `-${Math.random() * 5}s`\n  66 |             }}","line":63,"column":31,"nodeType":null,"endLine":63,"endColumn":44},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\n/Users/janhartje/drachenbootplan/src/components/ui/DragonBoatAnimation.tsx:64:38\n  62 |               top: `${Math.random() * 100}%`,\n  63 |               width: `${100 + Math.random() * 300}px`,\n> 64 |               animation: `flow ${2 + Math.random() * 3}s linear infinite`,\n     |                                      ^^^^^^^^^^^^^ Cannot call impure function\n  65 |               animationDelay: `-${Math.random() * 5}s`\n  66 |             }}\n  67 |           />","line":64,"column":38,"nodeType":null,"endLine":64,"endColumn":51},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\n/Users/janhartje/drachenbootplan/src/components/ui/DragonBoatAnimation.tsx:65:35\n  63 |               width: `${100 + Math.random() * 300}px`,\n  64 |               animation: `flow ${2 + Math.random() * 3}s linear infinite`,\n> 65 |               animationDelay: `-${Math.random() * 5}s`\n     |                                   ^^^^^^^^^^^^^ Cannot call impure function\n  66 |             }}\n  67 |           />\n  68 |         ))}","line":65,"column":35,"nodeType":null,"endLine":65,"endColumn":48}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\n\nconst DragonBoatAnimation: React.FC = () => {\n  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n    const { innerWidth, innerHeight } = window;\n    const x = (e.clientX / innerWidth - 0.5) * 10;\n    const y = (e.clientY / innerHeight - 0.5) * 10;\n    setMousePos({ x, y });\n  };\n\n  return (\n    <div \n      className=\"relative w-full h-full bg-transparent overflow-hidden flex flex-col items-center justify-center perspective-1000\"\n      onMouseMove={handleMouseMove}\n      style={{ perspective: '1000px' }}\n    >\n      <style jsx>{`\n        @keyframes grid-move {\n          0% { transform: translateY(0); opacity: 0; }\n          20% { opacity: 0.3; }\n          100% { transform: translateY(100px); opacity: 0; }\n        }\n        \n        @keyframes stroke-abstract {\n          0% { transform: translateX(0) scaleX(0.5); opacity: 0.2; }\n          20% { transform: translateX(5px) scaleX(1.5); opacity: 1; }\n          50% { transform: translateX(-10px) scaleX(1); opacity: 0.5; }\n          100% { transform: translateX(0) scaleX(0.5); opacity: 0.2; }\n        }\n\n        @keyframes pulse-sync {\n          0%, 100% { r: 4; fill-opacity: 0.5; }\n          20% { r: 6; fill-opacity: 1; }\n        }\n\n        @keyframes flow {\n          0% { transform: translateX(100vw); opacity: 0; }\n          10% { opacity: 0.5; }\n          90% { opacity: 0.5; }\n          100% { transform: translateX(-100vw); opacity: 0; }\n        }\n\n        .animate-stroke { animation: stroke-abstract 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; }\n        .animate-pulse-sync { animation: pulse-sync 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; }\n      `}</style>\n\n      {/* Hintergrund: Tech-Grid & Partikel */}\n      <div className=\"absolute inset-0 z-0\">\n        {/* Raster */}\n        <div className=\"absolute inset-0 bg-[linear-gradient(rgba(59,130,246,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.03)_1px,transparent_1px)] bg-[size:40px_40px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,black,transparent)]\"></div>\n        \n        {/* Speed Partikel */}\n        {[...Array(15)].map((_, i) => (\n          <div \n            key={i}\n            className=\"absolute h-[1px] bg-gradient-to-l from-blue-500 dark:from-cyan-500 to-transparent opacity-30 rounded-full\"\n            style={{\n              top: `${Math.random() * 100}%`,\n              width: `${100 + Math.random() * 300}px`,\n              animation: `flow ${2 + Math.random() * 3}s linear infinite`,\n              animationDelay: `-${Math.random() * 5}s`\n            }}\n          />\n        ))}\n      </div>\n\n      {/* Modernes Drachenboot */}\n      <div \n        className=\"relative z-10 w-full max-w-[600px] h-[200px] transition-transform duration-100 ease-out\"\n        style={{ \n          transform: `rotateX(${mousePos.y}deg) rotateY(${mousePos.x}deg)`,\n        }}\n      >\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <svg width=\"100%\" height=\"160\" viewBox=\"0 0 600 160\" className=\"drop-shadow-2xl\">\n            <defs>\n              <linearGradient id=\"hullGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                <stop offset=\"0%\" stopColor=\"#1e40af\" stopOpacity=\"0.8\" />\n                <stop offset=\"50%\" stopColor=\"#3b82f6\" stopOpacity=\"0.9\" />\n                <stop offset=\"100%\" stopColor=\"#1e40af\" stopOpacity=\"0.8\" />\n              </linearGradient>\n              <filter id=\"glow\">\n                <feGaussianBlur stdDeviation=\"2.5\" result=\"coloredBlur\"/>\n                <feMerge>\n                  <feMergeNode in=\"coloredBlur\"/>\n                  <feMergeNode in=\"SourceGraphic\"/>\n                </feMerge>\n              </filter>\n            </defs>\n\n            {/* Rumpf */}\n            <path \n              d=\"M 50,80 L 100,50 L 500,50 L 580,80 L 500,110 L 100,110 Z\" \n              fill=\"url(#hullGradient)\" \n              stroke=\"#2563eb\" \n              strokeWidth=\"1\"\n              className=\"backdrop-blur-md\"\n            />\n            \n            {/* Highlight Linien */}\n            <path d=\"M 110,65 L 490,65\" stroke=\"#60a5fa\" strokeWidth=\"1\" opacity=\"0.5\" />\n            <path d=\"M 110,95 L 490,95\" stroke=\"#60a5fa\" strokeWidth=\"1\" opacity=\"0.5\" />\n\n            {/* Die Crew */}\n            <g fill=\"#3b82f6\" className=\"dark:fill-cyan-400\">\n              {[...Array(8)].map((_, i) => (\n                <g key={i} transform={`translate(${140 + i * 50}, 0)`}>\n                  <circle cy=\"65\" className=\"animate-pulse-sync\" />\n                  <circle cy=\"95\" className=\"animate-pulse-sync\" />\n                </g>\n              ))}\n            </g>\n\n            {/* Die Bewegung (Ruder als Energielinien) */}\n            <g stroke=\"#3b82f6\" className=\"dark:stroke-cyan-400\" strokeWidth=\"2\" strokeLinecap=\"round\">\n              {[...Array(8)].map((_, i) => (\n                <g key={i} transform={`translate(${140 + i * 50}, 0)`}>\n                  <line x1=\"0\" y1=\"50\" x2=\"0\" y2=\"20\" className=\"animate-stroke\" style={{ transformOrigin: '0 50px' }} />\n                  <line x1=\"0\" y1=\"110\" x2=\"0\" y2=\"140\" className=\"animate-stroke\" style={{ transformOrigin: '0 110px' }} />\n                </g>\n              ))}\n            </g>\n\n            {/* Trommler */}\n            <circle cx=\"540\" cy=\"80\" r=\"4\" fill=\"white\" className=\"animate-pulse\">\n              <animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n            </circle>\n            \n            {/* Steuer */}\n            <rect x=\"60\" y=\"78\" width=\"20\" height=\"4\" fill=\"#64748b\" rx=\"2\" />\n\n            {/* Bugspitze Glühen */}\n            <circle cx=\"580\" cy=\"80\" r=\"2\" fill=\"#3b82f6\" className=\"dark:fill-cyan-400\" filter=\"url(#glow)\" />\n          </svg>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DragonBoatAnimation;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/DragonLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/Footer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useDrachenboot' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { useDrachenboot } from '@/context/DrachenbootContext';\nimport { ImprintModal, ChangelogModal, PrivacyModal } from './Modals';\nimport { usePWAInstall } from '@/hooks/usePWAInstall';\nimport { useSession } from 'next-auth/react';\n\ninterface FooterProps {\n  variant?: 'compact' | 'full';\n}\n\nconst Footer: React.FC<FooterProps> = ({ variant = 'full' }) => {\n  const { data: session } = useSession();\n  const { t } = useLanguage();\n  const [showImprint, setShowImprint] = useState<boolean>(false);\n  const [showPrivacy, setShowPrivacy] = useState<boolean>(false);\n  const [showChangelog, setShowChangelog] = useState<boolean>(false);\n  const { canInstall, promptInstall } = usePWAInstall();\n\n\n  if (variant === 'compact') {\n    return (\n      <>\n        <footer className=\"py-12 border-t border-slate-200 dark:border-slate-800\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-6\">\n            <div className=\"text-slate-500 dark:text-slate-400 text-sm\">\n              © {new Date().getFullYear()} {t('appTitle')}. {t('madeWithLove')}\n            </div>\n            <div className=\"flex flex-wrap justify-center gap-3 sm:gap-4 text-sm items-center\">\n              <button onClick={() => setShowImprint(true)} className=\"text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">\n                {t('imprint')}\n              </button>\n              <span className=\"text-slate-300 dark:text-slate-600\">•</span>\n              <button onClick={() => setShowPrivacy(true)} className=\"text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">\n                {t('privacy')}\n              </button>\n              <span className=\"text-slate-300 dark:text-slate-600\">•</span>\n              <button onClick={() => setShowChangelog(true)} className=\"text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">\n                {t('changelog')}\n              </button>\n              <span className=\"text-slate-300 dark:text-slate-600\">•</span>\n              <a href=\"/docs\" className=\"text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">\n                API Docs\n              </a>\n              {session?.user?.isAdmin && (\n                <>\n                  <span className=\"text-slate-300 dark:text-slate-600\">•</span>\n                  <a href=\"/admin/dashboard\" className=\"text-purple-600 dark:text-purple-400 hover:text-purple-800 dark:hover:text-purple-300 transition-colors\">\n                    Admin\n                  </a>\n                </>\n              )}\n            </div>\n          </div>\n        </footer>\n\n        {showImprint && <ImprintModal onClose={() => setShowImprint(false)} />}\n        {showPrivacy && <PrivacyModal onClose={() => setShowPrivacy(false)} />}\n        {showChangelog && <ChangelogModal onClose={() => setShowChangelog(false)} />}\n      </>\n    );\n  }\n\n  return (\n    <>\n      <footer className=\"mt-12 text-center text-xs text-slate-500 dark:text-slate-400 pb-8\">\n        <div className=\"flex flex-wrap justify-center gap-3 sm:gap-4 mb-2 items-center\">\n          <button onClick={() => setShowImprint(true)} className=\"hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">{t('imprint')}</button>\n          <span>•</span>\n          <button onClick={() => setShowPrivacy(true)} className=\"hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">{t('privacy')}</button>\n          <span>•</span>\n          <button onClick={() => setShowChangelog(true)} className=\"hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">{t('changelog')}</button>\n          <span>•</span>\n          <a href=\"/docs\" className=\"hover:text-slate-800 dark:hover:text-slate-200 transition-colors\">API Docs</a>\n          {session?.user?.isAdmin && (\n            <>\n              <span>•</span>\n              <a href=\"/admin/dashboard\" className=\"hover:text-slate-800 dark:hover:text-slate-200 transition-colors text-purple-600 dark:text-purple-400\">\n                Admin\n              </a>\n            </>\n          )}\n          {canInstall && (\n            <>\n              <span>•</span>\n              <button onClick={promptInstall} className=\"hover:text-slate-800 dark:hover:text-slate-200 transition-colors font-medium text-blue-600 dark:text-blue-400\">\n                {t('installPWA')}\n              </button>\n            </>\n          )}\n        </div>\n        <p>&copy; {new Date().getFullYear()} {t('appTitle')}. {t('madeWithLove')}</p>\n      </footer>\n\n      {showImprint && <ImprintModal onClose={() => setShowImprint(false)} />}\n      {showPrivacy && <PrivacyModal onClose={() => setShowPrivacy(false)} />}\n      {showChangelog && <ChangelogModal onClose={() => setShowChangelog(false)} />}\n    </>\n  );\n};\n\nexport default Footer;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/FormInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'showInstallButton' is assigned a value but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":20}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Sun, Moon, Info } from 'lucide-react';\nimport { useLanguage } from '@/context/LanguageContext';\n\ninterface HeaderProps {\n  title: React.ReactNode;\n  subtitle?: React.ReactNode;\n  logo?: React.ReactNode;\n  leftAction?: React.ReactNode;\n  children?: React.ReactNode;\n  showHelp?: boolean;\n  onHelp?: () => void;\n  showThemeToggle?: boolean;\n  isDarkMode?: boolean;\n  toggleDarkMode?: () => void;\n  showLanguageToggle?: boolean;\n  showInstallButton?: boolean;\n}\n\nconst Header: React.FC<HeaderProps> = ({ \n  title, \n  subtitle, \n  logo = null, \n  leftAction = null, \n  children = null, \n  showHelp = true, \n  onHelp, \n  showThemeToggle = true, \n  isDarkMode, \n  toggleDarkMode,\n  showLanguageToggle = true,\n  showInstallButton = false\n}) => {\n  const { language, changeLanguage } = useLanguage();\n\n  return (\n    <header className=\"mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white dark:bg-slate-900 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 sticky top-0 z-50\">\n      <div className=\"flex items-center gap-3\">\n        {leftAction && (\n          <>\n            {leftAction}\n            <div className=\"h-8 w-px bg-slate-200 dark:bg-slate-700\"></div>\n          </>\n        )}\n        \n        {logo && (\n           <div className=\"flex items-center justify-center\">\n             {logo}\n           </div>\n        )}\n\n        <div>\n          <div className=\"font-bold text-xl text-slate-800 dark:text-white leading-tight flex items-center gap-2\">\n            {title}\n          </div>\n          {subtitle && <p className=\"text-xs text-slate-600 dark:text-slate-400 font-medium uppercase tracking-wider\">{subtitle}</p>}\n        </div>\n      </div>\n\n      <div className=\"flex gap-2 items-center justify-end md:justify-start w-full md:w-auto\">\n        {children}\n        \n        {(children && (showHelp || showThemeToggle)) && <div className=\"w-px h-8 bg-slate-100 dark:bg-slate-800 mx-2\"></div>}\n\n        {showHelp && onHelp && (\n          <button onClick={onHelp} className=\"p-2 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-blue-50 dark:hover:bg-slate-700 transition-colors\">\n            <Info size={20} />\n          </button>\n        )}\n        \n        {showThemeToggle && toggleDarkMode && (\n          <button onClick={toggleDarkMode} className=\"p-2 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-blue-50 dark:hover:bg-slate-700 transition-colors\">\n            {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}\n          </button>\n        )}\n        \n        {showLanguageToggle && (\n          <button \n            onClick={() => changeLanguage(language === 'de' ? 'en' : 'de')} \n            className=\"p-2 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-blue-50 dark:hover:bg-slate-700 transition-colors font-bold text-sm w-10 h-10 flex items-center justify-center\"\n          >\n            {language.toUpperCase()}\n          </button>\n        )}\n      </div>\n    </header>\n  );\n};\n\nexport default Header;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/LoadingScreens.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/Modals.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/PageTransition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/SkillBadges.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/SkillSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/WeightInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/__tests__/Footer.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/__tests__/Header.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'waitFor' is defined but never used.","line":2,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'helpButton' is assigned a value but never used.","line":57,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport Header from '../Header';\nimport { useLanguage } from '@/context/LanguageContext';\n\n// Mock the hook\njest.mock('@/context/LanguageContext', () => ({\n  useLanguage: jest.fn(),\n}));\n\ndescribe('Header', () => {\n  const mockChangeLanguage = jest.fn();\n  const mockT = (key: string) => key;\n\n  beforeAll(() => {\n    // Global mock for window.matchMedia (needed for PWA functionality)\n    Object.defineProperty(window, 'matchMedia', {\n      writable: true,\n      value: jest.fn().mockImplementation((query) => ({\n        matches: false,\n        media: query,\n        onchange: null,\n        addListener: jest.fn(),\n        removeListener: jest.fn(),\n        addEventListener: jest.fn(),\n        removeEventListener: jest.fn(),\n        dispatchEvent: jest.fn(),\n      })),\n    });\n  });\n\n  beforeEach(() => {\n    (useLanguage as jest.Mock).mockReturnValue({\n      language: 'de',\n      changeLanguage: mockChangeLanguage,\n      t: mockT,\n    });\n  });\n\n  const renderHeader = (props = {}) => {\n    return render(<Header title=\"Test Title\" {...props} />);\n  };\n\n  it('renders the title', () => {\n    renderHeader();\n    expect(screen.getByText('Test Title')).toBeInTheDocument();\n  });\n\n  it('renders the subtitle if provided', () => {\n    renderHeader({ subtitle: 'Test Subtitle' });\n    expect(screen.getByText('Test Subtitle')).toBeInTheDocument();\n  });\n\n  it('calls onHelp when help button is clicked', () => {\n    const onHelp = jest.fn();\n    renderHeader({ onHelp, showHelp: true });\n    const helpButton = screen.getByRole('button', { name: '' }); // Info icon button might not have accessible name, checking structure\n    // Actually, let's find by the icon or class if needed, but usually role button is good.\n    // Since there are multiple buttons (theme, lang), we need to be specific.\n    // The help button is the first one if showHelp is true.\n    // Let's use a more robust way: checking for the Info icon or just clicking the first button.\n    // Better: Header implementation uses Lucide icons.\n    \n    // Let's just click all buttons and see if onHelp is called, or find by index.\n    // The help button is rendered when showHelp && onHelp is true.\n    \n    // We can rely on the order or add data-testid in the component, but for now let's try to find by role.\n    const buttons = screen.getAllByRole('button');\n    // Assuming Help is the first one (before Theme and Lang)\n    fireEvent.click(buttons[0]);\n    expect(onHelp).toHaveBeenCalled();\n  });\n\n  it('toggles language when language button is clicked', () => {\n    renderHeader();\n    const langButton = screen.getByText('DE');\n    fireEvent.click(langButton);\n    expect(mockChangeLanguage).toHaveBeenCalledWith('en');\n  });\n\n\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/dropdown-menu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Check' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronRight' is defined but never used.","line":5,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Circle' is defined but never used.","line":5,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":37}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-xl border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-lg px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/input.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":4,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":4,"endColumn":28,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[72,149],"text":"type InputProps = React.InputHTMLAttributes<HTMLInputElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/AddGuestModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[489,492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[489,492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { UserPlus } from 'lucide-react';\nimport { useLanguage } from '@/context/LanguageContext';\nimport { Paddler } from '@/types';\nimport PaddlerForm from '../../drachenboot/team/PaddlerForm';\n\ninterface AddGuestModalProps {\n  onClose: () => void;\n  onAdd: (guest: Pick<Paddler, 'name' | 'weight' | 'skills'>) => void;\n}\n\nconst AddGuestModal: React.FC<AddGuestModalProps> = ({ onClose, onAdd }) => {\n  const { t } = useLanguage();\n\n  const handleSave = (data: any) => {\n    onAdd({\n      name: data.name,\n      weight: data.weight,\n      skills: data.skills,\n    });\n    onClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\">\n      <div className=\"bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col\">\n        <div className=\"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50\">\n          <h3 className=\"text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2\">\n            <UserPlus size={20} className=\"text-blue-500\" /> {t('guestAddTitle')}\n          </h3>\n        </div>\n        <PaddlerForm \n          paddlerToEdit={null}\n          onSave={handleSave}\n          onCancel={onClose}\n          t={t}\n          isModal={true}\n          isGuest={true}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AddGuestModal;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/AlertModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/ChangelogModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/ConfirmModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/CreateTeamModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/HelpModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/ImprintModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/components/ui/modals/PrivacyModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/context/AlertContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/context/DrachenbootContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":336,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":339,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4962,4965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4962,4965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTeams'. Either include it or remove the dependency array.","line":226,"column":6,"nodeType":"ArrayExpression","endLine":226,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTeams, status]","fix":{"range":[8950,8958],"text":"[fetchTeams, status]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":676,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":676,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23343,23346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23343,23346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'fetchTeams'. Either exclude it or remove the dependency array.","line":744,"column":6,"nodeType":"ArrayExpression","endLine":750,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [teams, currentTeam, createTeam, switchTeam, paddlers, events, assignmentsByEvent, targetTrim, isDarkMode, isLoading, isDataLoading, toggleDarkMode, addPaddler, updatePaddler, deletePaddler, createEvent, deleteEvent, updateEvent, updateAttendance, updateAssignments, addGuest, removeGuest, addCanister, removeCanister, session, updateTeam, fetchPaddlers, fetchEvents, deleteTeam]","fix":{"range":[25141,25556],"text":"[teams, currentTeam, createTeam, switchTeam, paddlers, events, assignmentsByEvent, targetTrim, isDarkMode, isLoading, isDataLoading, toggleDarkMode, addPaddler, updatePaddler, deletePaddler, createEvent, deleteEvent, updateEvent, updateAttendance, updateAssignments, addGuest, removeGuest, addCanister, removeCanister, session, updateTeam, fetchPaddlers, fetchEvents, deleteTeam]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { createContext, useContext, useState, useEffect, useMemo, useCallback } from 'react';\nimport { useSession } from \"next-auth/react\";\nimport { Paddler, Event, Assignments, Team } from '@/types';\n\ninterface DrachenbootContextType {\n  teams: Team[];\n  currentTeam: Team | null;\n  createTeam: (name: string) => Promise<void>;\n  updateTeam: (id: string, data: Partial<Team>) => Promise<void>;\n  deleteTeam: (id: string) => Promise<void>;\n  switchTeam: (teamId: string) => void;\n  paddlers: Paddler[];\n  events: Event[];\n  assignmentsByEvent: Record<string, Assignments>;\n  targetTrim: number;\n  setTargetTrim: (trim: number) => void;\n  isDarkMode: boolean;\n  toggleDarkMode: () => void;\n  isLoading: boolean;\n  isDataLoading: boolean;\n  addPaddler: (paddler: Omit<Paddler, 'id'>) => Promise<void>;\n  updatePaddler: (id: number | string, data: Partial<Paddler>) => Promise<void>;\n  deletePaddler: (id: number | string) => void;\n  createEvent: (title: string, date: string, type?: 'training' | 'regatta', boatSize?: 'standard' | 'small', comment?: string) => Promise<void>;\n  deleteEvent: (id: string) => Promise<void>;\n  updateEvent: (id: string, data: Partial<Event>) => Promise<void>;\n  updateAttendance: (eid: string, pid: number | string, status: 'yes' | 'no' | 'maybe') => void;\n  updateAssignments: (eid: string, newAssignments: Assignments) => void;\n  addGuest: (eid: string, guestData: Pick<Paddler, 'name' | 'weight' | 'skills'>) => Promise<string>;\n  removeGuest: (eid: string, guestId: string) => void;\n  addCanister: (eid: string) => Promise<string>;\n  removeCanister: (eid: string, canisterId: string) => Promise<void>;\n  setPaddlers: React.Dispatch<React.SetStateAction<Paddler[]>>;\n  setEvents: React.Dispatch<React.SetStateAction<Event[]>>;\n  userRole: 'CAPTAIN' | 'PADDLER' | null;\n  currentPaddler: Paddler | null;\n  refetchPaddlers: () => Promise<void>;\n  refetchEvents: () => Promise<void>;\n  importPaddlers: (data: Record<string, unknown>[]) => Promise<void>;\n  importEvents: (data: Record<string, unknown>[]) => Promise<void>;\n}\n\nconst DrachenbootContext = createContext<DrachenbootContextType | undefined>(undefined);\n\nexport const useDrachenboot = () => {\n  const context = useContext(DrachenbootContext);\n  if (!context) {\n    throw new Error('useDrachenboot must be used within a DrachenbootProvider');\n  }\n  return context;\n};\n\nexport const DrachenbootProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const { data: session, status } = useSession();\n  // --- STATE ---\n  const [teams, setTeams] = useState<Team[]>([]);\n  const [currentTeam, setCurrentTeam] = useState<Team | null>(null);\n  const [paddlers, setPaddlers] = useState<Paddler[]>([]);\n  const [events, setEvents] = useState<Event[]>([]);\n  const [assignmentsByEvent, setAssignmentsByEvent] = useState<Record<string, Assignments>>({});\n  const [targetTrim, setTargetTrim] = useState<number>(0);\n  const [isDarkMode, setIsDarkMode] = useState<boolean>(false);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [isDataLoading, setIsDataLoading] = useState<boolean>(true);\n\n  // --- API HELPERS ---\n  const fetchTeams = async () => {\n    try {\n      const res = await fetch('/api/teams');\n      if (res.status === 401) {\n        setTeams([]);\n        setCurrentTeam(null);\n        return;\n      }\n      if (res.ok) {\n        const data = await res.json();\n        setTeams(data);\n        // If no current team, select the first one or load from local storage\n        if (data.length > 0 && !currentTeam) {\n            const storedTeamId = localStorage.getItem('drachenboot_team_id');\n            const teamToSelect = data.find((t: Team) => t.id === storedTeamId) || data[0];\n            setIsDataLoading(true);\n            setCurrentTeam(teamToSelect);\n        }\n      }\n    } catch (e) {\n      console.error('Failed to fetch teams', e);\n    }\n  };\n\n  const fetchPaddlers = useCallback(async () => {\n    if (!currentTeam) return;\n    try {\n      const res = await fetch(`/api/paddlers?teamId=${currentTeam.id}`);\n      if (res.ok) {\n        const data = await res.json();\n        setPaddlers(data);\n      }\n    } catch (e) {\n      console.error('Failed to fetch paddlers', e);\n    }\n  }, [currentTeam]);\n\n  const fetchEvents = useCallback(async () => {\n    if (!currentTeam) return;\n    try {\n      const res = await fetch(`/api/events?teamId=${currentTeam.id}`);\n      if (res.ok) {\n        const data = await res.json();\n        // Transform API data to App state\n        const loadedEvents: Event[] = [];\n        const loadedAssignments: Record<string, Assignments> = {};\n\n        data.forEach((apiEvent: { attendances: { paddlerId: string; status: 'yes' | 'no' | 'maybe' }[]; assignments: { isCanister: boolean; seatId: string; paddlerId?: string }[]; id: string; title: string; date: string; type: 'training' | 'regatta'; boatSize?: 'standard' | 'small'; canisterCount?: number; comment?: string; guests?: any[] }) => {\n          // Transform attendance array to object\n          const attendance: Record<string, 'yes' | 'no' | 'maybe'> = {};\n          if (apiEvent.attendances) {\n            apiEvent.attendances.forEach((att: { paddlerId: string; status: 'yes' | 'no' | 'maybe' }) => {\n              attendance[att.paddlerId] = att.status;\n            });\n          }\n\n          // Transform assignments array to object\n          const assignments: Assignments = {};\n          let canisterCounter = 1;\n          \n          if (apiEvent.assignments) {\n            apiEvent.assignments.forEach((a: { isCanister: boolean; seatId: string; paddlerId?: string }) => {\n              if (a.isCanister) {\n                assignments[a.seatId] = `canister-${canisterCounter}`;\n                canisterCounter++;\n              } else if (a.paddlerId) {\n                assignments[a.seatId] = a.paddlerId;\n              }\n            });\n          }\n          loadedAssignments[apiEvent.id] = assignments;\n\n          loadedEvents.push({\n            id: apiEvent.id,\n            title: apiEvent.title,\n            date: new Date(apiEvent.date).toISOString(), // Keep full ISO string including time\n            type: apiEvent.type,\n            boatSize: apiEvent.boatSize || 'standard',\n            canisterCount: apiEvent.canisterCount || 0,\n            comment: apiEvent.comment,\n            attendance,\n            guests: apiEvent.guests || [],\n          });\n        });\n\n        setEvents(loadedEvents);\n        setAssignmentsByEvent(loadedAssignments);\n      }\n    } catch (e) {\n      console.error('Failed to fetch events', e);\n    }\n  }, [currentTeam]);\n\n  // --- INITIAL LOAD ---\n  // --- INITIAL LOAD ---\n  useEffect(() => {\n    const init = async () => {\n      if (status === 'loading') return;\n      if (status === 'authenticated') {\n        // Load user preferences from API first\n        try {\n          const prefsResponse = await fetch('/api/user/preferences');\n          if (prefsResponse.ok) {\n            const prefs = await prefsResponse.json();\n            \n            // Apply theme preference\n            if (prefs.theme === 'dark') {\n              setIsDarkMode(true);\n            } else if (prefs.theme === 'light') {\n              setIsDarkMode(false);\n            } else {\n              // 'system' or null - use system preference\n              if (typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n                setIsDarkMode(true);\n              }\n            }\n            \n            // Fetch teams and apply activeTeamId preference\n            await fetchTeamsWithPreference(prefs.activeTeamId);\n          } else {\n            await fetchTeams();\n          }\n        } catch (e) {\n          console.error('Failed to load preferences', e);\n          await fetchTeams();\n        }\n      }\n      \n      // Load local preferences as fallback\n      if (typeof window !== 'undefined') {\n        const storedTrim = localStorage.getItem('drachenboot_target_trim');\n        if (storedTrim) setTargetTrim(parseFloat(storedTrim));\n        \n        // Only use local theme if not authenticated\n        if (status !== 'authenticated') {\n          const storedTheme = localStorage.getItem('drachenboot_theme');\n          if (storedTheme === 'dark' || (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {\n            setIsDarkMode(true);\n          }\n        }\n      }\n      \n      setIsLoading(false);\n    };\n    init();\n\n    // Listen for system theme changes\n    if (typeof window !== 'undefined' && window.matchMedia) {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      const handleChange = (e: MediaQueryListEvent) => {\n        if (!localStorage.getItem('drachenboot_theme')) {\n          setIsDarkMode(e.matches);\n        }\n      };\n      mediaQuery.addEventListener('change', handleChange);\n      return () => mediaQuery.removeEventListener('change', handleChange);\n    }\n  }, [status]);\n  \n  // Helper function to fetch teams with preference for activeTeamId\n  const fetchTeamsWithPreference = async (preferredTeamId: string | null) => {\n    // Check for teamId in URL search params\n    let urlTeamId: string | null = null;\n    if (typeof window !== 'undefined') {\n      const params = new URLSearchParams(window.location.search);\n      urlTeamId = params.get('teamId');\n    }\n\n    try {\n      const res = await fetch('/api/teams');\n      if (res.status === 401) {\n        setTeams([]);\n        setCurrentTeam(null);\n        return;\n      }\n      if (res.ok) {\n        const data = await res.json();\n        setTeams(data);\n        if (data.length > 0) {\n          // Priority: URL param > API preference > localStorage > first team\n          let teamToSelect = null;\n          \n          if (urlTeamId) {\n             teamToSelect = data.find((t: Team) => t.id === urlTeamId);\n          }\n\n          if (!teamToSelect && preferredTeamId) {\n            teamToSelect = data.find((t: Team) => t.id === preferredTeamId);\n          }\n          if (!teamToSelect) {\n            const storedTeamId = localStorage.getItem('drachenboot_team_id');\n            teamToSelect = data.find((t: Team) => t.id === storedTeamId);\n          }\n          if (!teamToSelect) {\n            teamToSelect = data[0];\n          }\n          setIsDataLoading(true);\n          setCurrentTeam(teamToSelect);\n          \n          // Clean up URL if we used it\n          if (urlTeamId && typeof window !== 'undefined') {\n             const newUrl = window.location.pathname;\n             window.history.replaceState({}, '', newUrl);\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Failed to fetch teams', e);\n    }\n  };\n\n  // --- TEAM DATA LOAD ---\n  useEffect(() => {\n    let isMounted = true;\n\n    if (currentTeam) {\n        setIsDataLoading(true);\n        localStorage.setItem('drachenboot_team_id', currentTeam.id);\n        \n        // Save to API if authenticated\n        if (status === 'authenticated') {\n          fetch('/api/user/preferences', {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ activeTeamId: currentTeam.id }),\n          }).catch(e => console.error('Failed to save active team preference', e));\n        }\n        \n        Promise.all([fetchPaddlers(), fetchEvents()]).finally(() => {\n          if (isMounted) {\n            setIsDataLoading(false);\n            // Initial load is also done when data is loaded\n            setIsLoading(false); \n          }\n        });\n    } else {\n        setPaddlers([]);\n        setEvents([]);\n        if (isMounted) {\n          setIsDataLoading(false);\n        }\n    }\n\n    return () => {\n      isMounted = false;\n    };\n  }, [currentTeam, fetchPaddlers, fetchEvents, status]);\n\n  // --- THEME EFFECT ---\n  useEffect(() => {\n    if (isDarkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n    \n    // Save locally always\n    localStorage.setItem('drachenboot_theme', isDarkMode ? 'dark' : 'light');\n  }, [isDarkMode]);\n\n  // --- TRIM EFFECT ---\n  useEffect(() => {\n    localStorage.setItem('drachenboot_target_trim', targetTrim.toString());\n  }, [targetTrim]);\n\n  // --- ACTIONS ---\n  const toggleDarkMode = useCallback(async () => {\n    const newDarkMode = !isDarkMode;\n    setIsDarkMode(newDarkMode);\n    \n    // Save to API if authenticated\n    if (status === 'authenticated') {\n      try {\n        await fetch('/api/user/preferences', {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ theme: newDarkMode ? 'dark' : 'light' }),\n        });\n      } catch (e) {\n        console.error('Failed to save theme preference', e);\n      }\n    }\n  }, [isDarkMode, status]);\n\n  const createTeam = async (name: string) => {\n    try {\n      const res = await fetch('/api/teams', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ name }),\n      });\n      if (res.ok) {\n        const newTeam = await res.json();\n        setTeams(prev => [...prev, newTeam]);\n        // Automatically switch to new team\n        setIsDataLoading(true);\n        setCurrentTeam(newTeam);\n        localStorage.setItem('drachenboot_team', newTeam.id);\n      }\n    } catch (e) {\n      console.error('Failed to create team', e);\n    }\n  };\n\n  const updateTeam = async (id: string, data: Partial<Team>) => {\n    try {\n      const res = await fetch(`/api/teams/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n      if (res.ok) {\n        const updatedTeam = await res.json();\n        setTeams(prev => prev.map(t => t.id === id ? updatedTeam : t));\n        if (currentTeam?.id === id) {\n          setCurrentTeam(updatedTeam);\n        }\n      }\n    } catch (e) {\n      console.error('Failed to update team', e);\n    }\n  };\n\n  const deleteTeam = async (id: string) => {\n    try {\n      const res = await fetch(`/api/teams/${id}`, {\n        method: 'DELETE',\n      });\n      if (res.ok) {\n        setTeams(prev => prev.filter(t => t.id !== id));\n        if (currentTeam?.id === id) {\n          const remainingTeams = teams.filter(t => t.id !== id);\n          if (remainingTeams.length > 0) {\n            setIsDataLoading(true);\n            setCurrentTeam(remainingTeams[0]);\n            localStorage.setItem('drachenboot_team', remainingTeams[0].id);\n          } else {\n            setCurrentTeam(null);\n            localStorage.removeItem('drachenboot_team');\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Failed to delete team', e);\n    }\n  };\n\n  const switchTeam = useCallback((teamId: string) => {\n    const team = teams.find(t => t.id === teamId);\n    if (team) {\n      setIsDataLoading(true);\n      setCurrentTeam(team);\n    }\n  }, [teams]);\n\n  const addPaddler = useCallback(async (paddler: Omit<Paddler, 'id'>) => {\n    if (!currentTeam) return;\n    try {\n      const res = await fetch('/api/paddlers', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ ...paddler, teamId: currentTeam.id }),\n      });\n      if (res.ok) {\n        const newPaddler = await res.json();\n        setPaddlers(prev => [...prev, newPaddler]);\n      } else {\n        const err = await res.json();\n        throw new Error(err.error || 'Failed to add paddler');\n      }\n    } catch (e) {\n      console.error('Failed to add paddler', e);\n      throw e;\n    }\n  }, [currentTeam]);\n\n  const updatePaddler = useCallback(async (id: number | string, data: Partial<Paddler>) => {\n    try {\n      const res = await fetch(`/api/paddlers/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n      if (res.ok) {\n        setPaddlers(prev => prev.map(p => p.id === id ? { ...p, ...data } : p));\n      } else {\n        const err = await res.json();\n        throw new Error(err.error || 'Failed to update paddler');\n      }\n    } catch (e) {\n      console.error('Failed to update paddler', e);\n      throw e;\n    }\n  }, []);\n\n  const deletePaddler = useCallback(async (id: number | string) => {\n    try {\n      const res = await fetch(`/api/paddlers/${id}`, { method: 'DELETE' });\n      if (res.ok) {\n        // Remove from local state\n        setAssignmentsByEvent(prev => {\n          const next = { ...prev };\n          Object.keys(next).forEach(eid => {\n            const eventId = eid; // string key\n            const map = { ...next[eventId] };\n            let chg = false;\n            Object.keys(map).forEach(s => { if (map[s] === id) { delete map[s]; chg = true; } });\n            if (chg) next[eventId] = map;\n          });\n          return next;\n        });\n        setEvents(prev => prev.map(ev => {\n          const att = { ...ev.attendance };\n          delete att[id as string];\n          return { ...ev, attendance: att };\n        }));\n        setPaddlers(prev => prev.filter(p => p.id !== id));\n      }\n    } catch (e) {\n      console.error('Failed to delete paddler', e);\n    }\n  }, []);\n\n  const createEvent = useCallback(async (title: string, date: string, type: 'training' | 'regatta' = 'training', boatSize: 'standard' | 'small' = 'standard', comment?: string) => {\n    if (!currentTeam) return '';\n    try {\n      const res = await fetch('/api/events', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ title, date, type, boatSize, comment, teamId: currentTeam.id }),\n      });\n      if (res.ok) {\n        const createdEvent = await res.json();\n        // Ensure date is string for local state if API returns Date object or string\n        // API returns Prisma object where date is Date object (serialized to string)\n        const newEvent = { \n          ...createdEvent, \n          date: createdEvent.date,\n          attendance: {}, \n          guests: [],\n          canisterCount: 0\n        };\n        \n        setEvents(prev => [...prev, newEvent]);\n        setAssignmentsByEvent(prev => ({ ...prev, [createdEvent.id]: {} }));\n        return createdEvent.id;\n      }\n    } catch (e) {\n      console.error('Failed to create event', e);\n    }\n    return '';\n  }, [currentTeam]);\n\n  const deleteEvent = useCallback(async (id: string) => {\n    try {\n      const res = await fetch(`/api/events/${id}`, { method: 'DELETE' });\n      if (res.ok) {\n        setEvents((prev) => prev.filter((e) => e.id !== id));\n        setAssignmentsByEvent(prev => {\n          const next = { ...prev };\n          delete next[id];\n          return next;\n        });\n      }\n    } catch (e) { console.error(e); }\n  }, []);\n\n\n  const updateEvent = useCallback(async (id: string, data: Partial<Event>) => {\n    // Optimistic update\n    setEvents(prev => prev.map(e => e.id === id ? { ...e, ...data } : e));\n\n    try {\n      await fetch(`/api/events/${id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n    } catch (e) {\n      console.error('Failed to update event', e);\n    }\n  }, []);\n\n\n  const updateAttendance = useCallback(async (eid: string, pid: number | string, status: 'yes' | 'no' | 'maybe') => {\n    // Optimistic update\n    setEvents(prev => prev.map(ev => ev.id !== eid ? ev : { ...ev, attendance: { ...ev.attendance, [pid]: status } }));\n    \n    try {\n      await fetch(`/api/events/${eid}/attendance`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ paddlerId: pid, status }),\n      });\n    } catch (e) {\n      console.error('Failed to update attendance', e);\n      // Revert?\n    }\n  }, []);\n\n  const updateAssignments = useCallback(async (eid: string, newAssignments: Assignments) => {\n    // Optimistic update\n    setAssignmentsByEvent(prev => ({ ...prev, [eid]: newAssignments }));\n\n    try {\n      await fetch(`/api/events/${eid}/assignments`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ assignments: newAssignments }),\n      });\n    } catch (e) {\n      console.error('Failed to update assignments', e);\n    }\n  }, []);\n\n  const addGuest = useCallback(async (eid: string, guestData: Pick<Paddler, 'name' | 'weight' | 'skills'>) => {\n    try {\n      const res = await fetch(`/api/events/${eid}/guests`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(guestData),\n      });\n      \n      if (res.ok) {\n        const newGuest = await res.json();\n        \n        // Update Local State\n        setPaddlers(prev => [...prev, newGuest]);\n        setEvents(prev => prev.map(ev => {\n           if (ev.id === eid) {\n             return { \n               ...ev, \n               guests: [...(ev.guests || []), newGuest],\n               attendance: { ...ev.attendance, [newGuest.id]: 'yes' } \n             };\n           }\n           return ev;\n        }));\n        \n        return newGuest.id;\n      }\n    } catch(e) { console.error(e); }\n    return '';\n  }, []);\n\n  const removeGuest = useCallback(async (eid: string, guestId: string) => {\n    // Remove from local state immediately (optimistic)\n    setEvents(prev => prev.map(ev => {\n      if (ev.id === eid) {\n        const newGuests = (ev.guests || []).filter(g => g.id !== guestId);\n        const newAttendance = { ...ev.attendance };\n        delete newAttendance[guestId];\n        return { ...ev, guests: newGuests, attendance: newAttendance };\n      }\n      return ev;\n    }));\n    \n    setPaddlers(prev => prev.filter(p => p.id !== guestId));\n\n    try {\n      await fetch(`/api/events/${eid}/guests/${guestId}`, { method: 'DELETE' });\n    } catch(e) { console.error(e); }\n  }, []);\n\n  const addCanister = useCallback(async (eid: string) => {\n    try {\n      const res = await fetch(`/api/events/${eid}/canisters`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      if (res.ok) {\n        const data = await res.json();\n        const newCount = data.canisterCount;\n        setEvents(prev => prev.map(ev => ev.id === eid ? { ...ev, canisterCount: newCount } : ev));\n        return data.newCanisterId;\n      }\n    } catch(e) { console.error(e); }\n    return '';\n  }, []);\n\n  const removeCanister = useCallback(async (eid: string, canisterId: string) => {\n    try {\n      const res = await fetch(`/api/events/${eid}/canisters?canisterId=${canisterId}`, {\n        method: 'DELETE',\n      });\n\n      if (res.ok) {\n        // Update local state\n        setEvents(prev => prev.map(ev => {\n          if (ev.id === eid) {\n            return { ...ev, canisterCount: (ev.canisterCount || 0) - 1 };\n          }\n          return ev;\n        }));\n      } else {\n        const err = await res.json();\n        console.error('Canister removal failed:', err.error || 'Unknown error');\n      }\n    } catch(e) { console.error(e); }\n  }, []);\n\n  const value = useMemo(() => {\n    let role: 'CAPTAIN' | 'PADDLER' | null = 'PADDLER';\n    let myPaddler = null;\n    if (session?.user?.id && paddlers.length) {\n      myPaddler = paddlers.find(p => p.userId === session.user.id) || null;\n      role = (myPaddler as any)?.role || 'PADDLER';\n    }\n\n    return {\n      teams,\n      currentTeam,\n      createTeam,\n      updateTeam,\n      deleteTeam,\n      switchTeam,\n      paddlers,\n      events,\n      assignmentsByEvent,\n      targetTrim,\n      setTargetTrim,\n      isDarkMode,\n      toggleDarkMode,\n      isLoading,\n      isDataLoading,\n      addPaddler,\n      updatePaddler,\n      deletePaddler,\n      createEvent,\n      deleteEvent,\n      updateEvent,\n      updateAttendance,\n      updateAssignments,\n      addGuest,\n      removeGuest,\n      addCanister,\n      removeCanister,\n      setPaddlers,\n      setEvents,\n      userRole: role,\n      currentPaddler: myPaddler,\n      refetchPaddlers: fetchPaddlers,\n      refetchEvents: fetchEvents,\n      importPaddlers: async (data: Record<string, unknown>[]) => {\n        if (!currentTeam) return;\n        try {\n          const res = await fetch(`/api/teams/${currentTeam.id}/import/paddlers`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ paddlers: data }),\n          });\n          if (!res.ok) throw new Error('Import failed');\n          await fetchPaddlers();\n        } catch (e) {\n          console.error(e);\n          throw e;\n        }\n      },\n      importEvents: async (data: Record<string, unknown>[]) => {\n        if (!currentTeam) return;\n        try {\n          const res = await fetch(`/api/teams/${currentTeam.id}/import/events`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ events: data }),\n          });\n          if (!res.ok) throw new Error('Import failed');\n          await fetchEvents();\n        } catch (e) {\n          console.error(e);\n          throw e;\n        }\n      }\n    };\n  }, [\n    teams, currentTeam, createTeam, switchTeam,\n    paddlers, events, assignmentsByEvent, targetTrim, isDarkMode, isLoading, isDataLoading,\n    toggleDarkMode, addPaddler, updatePaddler, deletePaddler, createEvent, deleteEvent, updateEvent,\n    updateAttendance, updateAssignments, addGuest, removeGuest, addCanister, removeCanister,\n    session, fetchTeams, updateTeam, fetchPaddlers, fetchEvents, deleteTeam\n  ]);\n\n  return (\n    <DrachenbootContext.Provider value={value}>\n      {children}\n    </DrachenbootContext.Provider>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/context/LanguageContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[286,289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[286,289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[410,413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[410,413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'initialized' is assigned a value but never used.","line":29,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2932,2935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2932,2935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n// Force translation refresh\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport de from '../locales/de.json';\nimport en from '../locales/en.json';\n\ninterface Translations {\n  [key: string]: any;\n}\n\ninterface LanguageContextType {\n  language: string;\n  changeLanguage: (lang: string) => void;\n  t: (key: string) => any;\n}\n\nconst LanguageContext = createContext<LanguageContextType | undefined>(undefined);\n\nconst translations: { [key: string]: Translations } = {\n  de,\n  en\n};\n\nexport const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const { data: session, status } = useSession();\n  const [language, setLanguage] = useState<string>('de'); // Default to German\n  const [initialized, setInitialized] = useState(false);\n\n  // Load language preference\n  useEffect(() => {\n    const loadLanguage = async () => {\n      // 1. Try to load from API if logged in\n      if (status === 'authenticated' && session?.user) {\n        try {\n          const response = await fetch('/api/user/preferences');\n          if (response.ok) {\n            const data = await response.json();\n            if (data.language && translations[data.language]) {\n              setLanguage(data.language);\n              document.documentElement.lang = data.language;\n              setInitialized(true);\n              return;\n            }\n          }\n        } catch (error) {\n          console.error('Failed to load language preference:', error);\n        }\n      }\n\n      // 2. Try localStorage\n      const savedLanguage = localStorage.getItem('language');\n      if (savedLanguage && translations[savedLanguage]) {\n        setLanguage(savedLanguage);\n        document.documentElement.lang = savedLanguage;\n        setInitialized(true);\n        return;\n      }\n\n      // 3. Fall back to browser language\n      if (typeof navigator !== 'undefined') {\n        const browserLang = navigator.language.split('-')[0];\n        if (translations[browserLang]) {\n          setLanguage(browserLang);\n          document.documentElement.lang = browserLang;\n        }\n      }\n      setInitialized(true);\n    };\n\n    if (status !== 'loading') {\n      loadLanguage();\n    }\n  }, [session, status]);\n\n  const changeLanguage = async (lang: string) => {\n    if (translations[lang]) {\n      setLanguage(lang);\n      localStorage.setItem('language', lang);\n      document.documentElement.lang = lang;\n\n      // Persist to API if logged in\n      if (status === 'authenticated') {\n        try {\n          await fetch('/api/user/preferences', {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ language: lang }),\n          });\n        } catch (error) {\n          console.error('Failed to save language preference:', error);\n        }\n      }\n    }\n  };\n\n  const t = (key: string): any => {\n    return translations[language][key] || key;\n  };\n\n  return (\n    <LanguageContext.Provider value={{ language, changeLanguage, t }}>\n      {children}\n    </LanguageContext.Provider>\n  );\n};\n\nexport const useLanguage = (): LanguageContextType => {\n  const context = useContext(LanguageContext);\n  if (!context) {\n    throw new Error('useLanguage must be used within a LanguageProvider');\n  }\n  return context;\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/context/TourContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[868,871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[868,871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/janhartje/drachenbootplan/src/context/TourContext.tsx:163:5\n  161 |     });\n  162 |\n> 163 |     setDriverObj(driverInstance);\n      |     ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  164 |   }, [t]);\n  165 |\n  166 |   const startTour = (tourName = 'welcome') => {","line":163,"column":5,"nodeType":null,"endLine":163,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAndStartTour'. Either include it or remove the dependency array.","line":200,"column":6,"nodeType":"ArrayExpression","endLine":200,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [checkAndStartTour, driverObj]","fix":{"range":[5163,5174],"text":"[checkAndStartTour, driverObj]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport { driver, Driver } from 'driver.js';\nimport 'driver.js/dist/driver.css';\n\nimport { useLanguage } from '@/context/LanguageContext';\n\ninterface TourContextType {\n  startTour: (tourName?: string) => void;\n  checkAndStartTour: (tourName: string) => void;\n}\n\nconst TourContext = createContext<TourContextType | undefined>(undefined);\n\nexport const useTour = () => {\n  const context = useContext(TourContext);\n  if (!context) {\n    throw new Error('useTour must be used within a TourProvider');\n  }\n  return context;\n};\n\nexport const TourProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [driverObj, setDriverObj] = useState<Driver | null>(null);\n  const { t } = useLanguage();\n\n  // Define tour configurations\n  const tours: { [key: string]: any[] } = {\n    welcome: [\n      { \n        element: '#tour-welcome', \n        popover: { \n          title: t('tourWelcomeTitle'), \n          description: t('tourWelcomeDesc'), \n          side: \"center\", \n          align: 'center' \n        } \n      },\n      { \n        element: '#tour-new-event', \n        popover: { \n          title: t('tourNewEventTitle'), \n          description: t('tourNewEventDesc'), \n          side: \"right\", \n          align: 'start' \n        } \n      },\n      { \n        element: '#tour-paddler-form', \n        popover: { \n          title: t('tourMembersTitle'), \n          description: t('tourMembersDesc'), \n          side: \"left\", \n          align: 'start' \n        } \n      },\n      { \n        element: '#tour-event-list', \n        popover: { \n          title: t('tourEventListTitle'), \n          description: t('tourEventListDesc'), \n          side: \"right\", \n          align: 'start' \n        } \n      },\n      { \n        element: '#tour-paddler-grid', \n        popover: { \n          title: t('tourSquadTitle'), \n          description: t('tourSquadDesc'), \n          side: \"top\", \n          align: 'start' \n        } \n      }\n    ],\n    planner: [\n      {\n        element: '#tour-planner-stats',\n        popover: {\n          title: t('tourStatsTitle'), \n          description: t('tourStatsDesc'), \n          side: \"right\", \n          align: 'start'\n        }\n      },\n      {\n        element: '#tour-planner-boat-size',\n        popover: {\n          title: t('tourBoatSizeTitle'), \n          description: t('tourBoatSizeDesc'), \n          side: \"right\", \n          align: 'start'\n        }\n      },\n      {\n        element: '#tour-planner-pool',\n        popover: {\n          title: t('tourPoolTitle'), \n          description: t('tourPoolDesc'), \n          side: \"right\", \n          align: 'start'\n        }\n      },\n      {\n        element: '#tour-planner-canister',\n        popover: {\n          title: t('tourCanisterTitle'), \n          description: t('tourCanisterDesc'), \n          side: \"bottom\",\n          align: 'end'\n        }\n      },\n      {\n        element: '#tour-planner-guest',\n        popover: {\n          title: t('tourGuestTitle'), \n          description: t('tourGuestDesc'), \n          side: \"bottom\",\n          align: 'end'\n        }\n      },\n      {\n        element: '#tour-planner-boat',\n        popover: {\n          title: t('tourBoatTitle'), \n          description: t('tourBoatDesc'), \n          side: \"left\", \n          align: 'start'\n        }\n      },\n      {\n        element: '#tour-planner-autofill',\n        popover: {\n          title: t('tourMagicAITitle'), \n          description: t('tourMagicAIDesc'), \n          side: \"top\", \n          align: 'center'\n        }\n      },\n      {\n        element: '#tour-planner-export',\n        popover: {\n          title: t('tourExportTitle'), \n          description: t('tourExportDesc'), \n          side: \"top\", \n          align: 'center'\n        }\n      }\n    ]\n  };\n\n  useEffect(() => {\n    const driverInstance = driver({\n      showProgress: true,\n      animate: true,\n      doneBtnText: t('tourDone'),\n      nextBtnText: t('tourNext'),\n      prevBtnText: t('tourPrev'),\n      // Steps will be set dynamically\n    });\n\n    setDriverObj(driverInstance);\n  }, [t]);\n\n  const startTour = (tourName = 'welcome') => {\n    if (driverObj && tours[tourName]) {\n      driverObj.setConfig({\n        showProgress: true,\n        animate: true,\n        doneBtnText: t('tourDone'),\n        nextBtnText: t('tourNext'),\n        prevBtnText: t('tourPrev'),\n        steps: tours[tourName],\n        onDestroyed: () => {\n          localStorage.setItem(`${tourName}_tour_seen`, 'true');\n        }\n      });\n      driverObj.drive();\n    }\n  };\n\n  const checkAndStartTour = (tourName: string) => {\n    const tourSeen = localStorage.getItem(`${tourName}_tour_seen`);\n    if (!tourSeen && driverObj) {\n      startTour(tourName);\n    }\n  };\n\n  // Check on mount if we should start welcome tour\n  useEffect(() => {\n    if (driverObj) {\n        setTimeout(() => {\n             // Only auto-start welcome tour on main page, logic handled by component usage or here if we check path\n             if (window.location.pathname === '/') {\n                checkAndStartTour('welcome');\n             }\n        }, 500);\n    }\n  }, [driverObj]);\n\n  return (\n    <TourContext.Provider value={{ startTour, checkAndStartTour }}>\n      {children}\n    </TourContext.Provider>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/context/UserPreferencesContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/janhartje/drachenbootplan/src/context/UserPreferencesContext.tsx:35:7\n  33 |     if (typeof window !== 'undefined') {\n  34 |       const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n> 35 |       setSystemTheme(mediaQuery.matches ? 'dark' : 'light');\n     |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |\n  37 |       const handler = (e: MediaQueryListEvent) => {\n  38 |         setSystemTheme(e.matches ? 'dark' : 'light');","line":35,"column":7,"nodeType":null,"endLine":35,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { useSession } from 'next-auth/react';\n\ninterface UserPreferences {\n  theme: 'light' | 'dark' | 'system' | null;\n  language: 'de' | 'en' | null;\n  activeTeamId: string | null;\n}\n\ninterface UserPreferencesContextType {\n  preferences: UserPreferences;\n  isLoading: boolean;\n  updatePreference: <K extends keyof UserPreferences>(key: K, value: UserPreferences[K]) => Promise<void>;\n  effectiveTheme: 'light' | 'dark';\n}\n\nconst UserPreferencesContext = createContext<UserPreferencesContextType | undefined>(undefined);\n\nexport const UserPreferencesProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const { data: session, status } = useSession();\n  const [preferences, setPreferences] = useState<UserPreferences>({\n    theme: null,\n    language: null,\n    activeTeamId: null,\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [systemTheme, setSystemTheme] = useState<'light' | 'dark'>('light');\n\n  // Detect system theme\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      setSystemTheme(mediaQuery.matches ? 'dark' : 'light');\n\n      const handler = (e: MediaQueryListEvent) => {\n        setSystemTheme(e.matches ? 'dark' : 'light');\n      };\n\n      mediaQuery.addEventListener('change', handler);\n      return () => mediaQuery.removeEventListener('change', handler);\n    }\n  }, []);\n\n  // Load preferences from API when logged in\n  useEffect(() => {\n    const loadPreferences = async () => {\n      if (status === 'authenticated' && session?.user) {\n        try {\n          const response = await fetch('/api/user/preferences');\n          if (response.ok) {\n            const data = await response.json();\n            setPreferences({\n              theme: data.theme || null,\n              language: data.language || null,\n              activeTeamId: data.activeTeamId || null,\n            });\n          }\n        } catch (error) {\n          console.error('Failed to load preferences:', error);\n        }\n      }\n      setIsLoading(false);\n    };\n\n    if (status !== 'loading') {\n      loadPreferences();\n    }\n  }, [session, status]);\n\n  // Apply theme to document\n  useEffect(() => {\n    if (typeof document !== 'undefined') {\n      const effectiveTheme = preferences.theme === 'system' || !preferences.theme \n        ? systemTheme \n        : preferences.theme;\n      \n      if (effectiveTheme === 'dark') {\n        document.documentElement.classList.add('dark');\n      } else {\n        document.documentElement.classList.remove('dark');\n      }\n    }\n  }, [preferences.theme, systemTheme]);\n\n  // Apply language to document\n  useEffect(() => {\n    if (typeof document !== 'undefined' && preferences.language) {\n      document.documentElement.lang = preferences.language;\n    }\n  }, [preferences.language]);\n\n  const updatePreference = useCallback(async <K extends keyof UserPreferences>(\n    key: K, \n    value: UserPreferences[K]\n  ) => {\n    // Optimistic update\n    setPreferences(prev => ({ ...prev, [key]: value }));\n\n    // Persist to API if logged in\n    if (status === 'authenticated') {\n      try {\n        const response = await fetch('/api/user/preferences', {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ [key]: value }),\n        });\n\n        if (!response.ok) {\n          // Revert on error\n          console.error('Failed to save preference');\n        }\n      } catch (error) {\n        console.error('Failed to save preference:', error);\n      }\n    } else {\n      // For non-logged-in users, store in localStorage\n      localStorage.setItem(`pref_${key}`, String(value));\n    }\n  }, [status]);\n\n  const effectiveTheme: 'light' | 'dark' = \n    preferences.theme === 'system' || !preferences.theme \n      ? systemTheme \n      : preferences.theme;\n\n  return (\n    <UserPreferencesContext.Provider value={{ preferences, isLoading, updatePreference, effectiveTheme }}>\n      {children}\n    </UserPreferencesContext.Provider>\n  );\n};\n\nexport const useUserPreferences = (): UserPreferencesContextType => {\n  const context = useContext(UserPreferencesContext);\n  if (!context) {\n    throw new Error('useUserPreferences must be used within a UserPreferencesProvider');\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/components/EmailLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/templates/ContactEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/templates/MagicLinkEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/templates/TeamInviteEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/templates/TeamRemovalEmail.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Section' is defined but never used.","line":1,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Text, Section, Heading } from '@react-email/components';\nimport EmailLayout from '../components/EmailLayout';\nimport { t, Language } from '../utils/i18n';\nimport React from 'react';\n\ninterface TeamRemovalEmailProps {\n  teamName: string;\n  userName: string;\n  lang?: Language;\n}\n\n// Helper to replace placeholders\nconst interpolate = (str: string, params: Record<string, string>): string => {\n  return Object.entries(params).reduce(\n    (result, [key, value]) => result.replace(new RegExp(`\\\\{${key}\\\\}`, 'g'), value),\n    str\n  );\n};\n\nexport const TeamRemovalEmail = ({ \n  teamName,\n  userName,\n  lang = 'de'\n}: TeamRemovalEmailProps) => {\n  const bodyText = interpolate(t(lang, 'emailTeamRemovalBody'), { name: userName, teamName });\n\n  return (\n    <EmailLayout \n      previewText={`${t(lang, 'emailTeamRemovalSubject')} - ${teamName}`}\n      headerTitle={t(lang, 'appTitle')}\n      lang={lang}\n    >\n      <Heading className=\"text-xl font-bold text-slate-900 dark:text-white mb-4\">\n        {t(lang, 'emailTeamRemovalTitle')}\n      </Heading>\n      \n      <Text className=\"text-slate-700 dark:text-slate-300 mb-4\">\n        {bodyText}\n      </Text>\n      \n      <Text className=\"text-slate-700 dark:text-slate-300 mb-6\">\n        {t(lang, 'emailTeamRemovalReason')}\n      </Text>\n    </EmailLayout>\n  );\n};\n\nexport default TeamRemovalEmail;\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/templates/WelcomeEmail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/emails/utils/i18n.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[157,160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[157,160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import de from '@/locales/de.json';\nimport en from '@/locales/en.json';\n\nexport type Language = 'de' | 'en';\n\nconst locales: Record<Language, Record<string, any>> = { de, en };\n\n/**\n * Simple translation function for emails.\n * @param lang - The language code ('de' or 'en')\n * @param key - The translation key\n * @returns The translated string, or the key if not found\n */\nexport const t = (lang: Language, key: string): string => {\n  return locales[lang]?.[key] ?? key;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/hooks/useDebounce.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/hooks/usePWAInstall.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/janhartje/drachenbootplan/src/hooks/usePWAInstall.ts:17:7\n  15 |\n  16 |     if (window.matchMedia('(display-mode: standalone)').matches) {\n> 17 |       setCanInstall(false);\n     |       ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |     }\n  19 |\n  20 |     return () => {","line":17,"column":7,"nodeType":null,"endLine":17,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\n\nexport const usePWAInstall = () => {\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\n  const [canInstall, setCanInstall] = useState<boolean>(false);\n\n  useEffect(() => {\n    const handler = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n      setCanInstall(true);\n    };\n\n    window.addEventListener('beforeinstallprompt', handler);\n\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      setCanInstall(false);\n    }\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handler);\n    };\n  }, []);\n\n  const promptInstall = async () => {\n    if (!deferredPrompt) return;\n\n    deferredPrompt.prompt();\n    const { outcome } = await deferredPrompt.userChoice;\n\n    if (outcome === 'accepted') {\n      setCanInstall(false);\n    }\n    setDeferredPrompt(null);\n  };\n\n  return { canInstall, promptInstall };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/lib/email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/lib/prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/types/next-auth.d.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'NextAuth' is defined but never used.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import NextAuth, { DefaultSession } from \"next-auth\"\n\ndeclare module \"next-auth\" {\n  /**\n   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider` React Context\n   */\n  interface Session {\n    user: {\n      /** The user's role. */\n      isAdmin?: boolean\n      /** The user's weight in kg. */\n      weight?: number | null\n    } & DefaultSession[\"user\"]\n  }\n\n  interface User {\n    isAdmin?: boolean\n    weight?: number | null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/utils/__tests__/algorithm.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/utils/__tests__/importUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/utils/algorithm.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Assignments' is defined but never used.","line":2,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'k' is defined but never used.","line":73,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":59},{"ruleId":"prefer-const","severity":2,"message":"'canisterRows' is never reassigned. Use 'const' instead.","line":216,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":216,"endColumn":25,"fix":{"range":[8746,8783],"text":"const canisterRows = new Set<number>();"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { runAutoFillAlgorithm } from './algorithm';\nimport { Paddler, Assignments } from '../types';\n\n// Mock helper\nconst createPaddler = (id: string, weight: number, skills: string[] = [], priority: number = 1): Paddler => ({\n  id,\n  name: `Paddler ${id}`,\n  weight,\n  skills,\n  priority,\n  isGuest: false,\n  isCanister: false\n});\n\ndescribe('AutoFill Algorithm', () => {\n    it('should place heaviest paddlers in the middle rows (Heavy Middle Logic)', () => {\n        const rows = 10;\n        const pool: Paddler[] = [];\n        \n        // 20 Paddlers with weights 60..98 (increment by 2)\n        for(let i=0; i<20; i++) {\n            pool.push(createPaddler(`p-${i}`, 60 + i*2, ['left', 'right']));\n        }\n        // Add Drum and Steer separate\n        pool.push(createPaddler('drum', 50, ['drum']));\n        pool.push(createPaddler('steer', 60, ['steer']));\n\n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, rows);\n        expect(assignments).not.toBeNull();\n        if (!assignments) return;\n\n        // Check middle rows (4,5,6,7) vs outer rows (1,2, 9,10)\n        let midWeight = 0, midCount = 0;\n        let outerWeight = 0, outerCount = 0;\n\n        Object.entries(assignments).forEach(([seat, pid]) => {\n            if (seat.includes('row')) {\n                const match = seat.match(/row-(\\d+)/);\n                const row = parseInt(match![1]);\n                const p = pool.find(x => x.id === pid);\n                if (row >= 5 && row <= 6) {\n                    midWeight += p!.weight;\n                    midCount++;\n                } else if (row <= 2 || row >= 9) {\n                    outerWeight += p!.weight;\n                    outerCount++;\n                }\n            }\n        });\n\n        const avgMid = midWeight / midCount;\n        const avgOuter = outerWeight / outerCount;\n        \n        console.log(`Avg Mid: ${avgMid}, Avg Outer: ${avgOuter}`);\n        expect(avgMid).toBeGreaterThan(avgOuter);\n    });\n\n    it('should assign Stroke to Row 1', () => {\n        const pool: Paddler[] = [];\n        for(let i=0; i<18; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right']));\n        \n        const stroke = createPaddler('stroke-p', 85, ['stroke']); // Special Role\n        pool.push(stroke);\n        pool.push(createPaddler('drum', 50, ['drum']));\n        pool.push(createPaddler('steer', 60, ['steer']));\n        // Fill up to 22\n        pool.push(createPaddler('extra', 70, ['left', 'right']));\n\n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        expect(assignments).not.toBeNull();\n\n        // Check if stroke-p is in row 1\n        const seat = Object.entries(assignments!).find(([k, v]) => v === 'stroke-p');\n        expect(seat).toBeDefined();\n        // Should be row-1-left or row-1-right\n        expect(seat![0]).toMatch(/row-1-(left|right)/);\n    });\n\n    it('should visualize Preferred Steer priority', () => {\n        const pool: Paddler[] = [];\n        // 2 possible steers\n        const normalSteer = createPaddler('steer-normal', 60, ['steer']);\n        const prefSteer = createPaddler('steer-pref', 60, ['steer', 'steer_preferred']); // Preferred\n        \n        pool.push(normalSteer);\n        pool.push(prefSteer);\n        pool.push(createPaddler('drum', 50, ['drum']));\n        \n        // Fill paddlers\n        for(let i=0; i<20; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right']));\n\n        // Run multiple times to check probability (since algo is random)\n        let prefCount = 0;\n        for(let i=0; i<50; i++) {\n             const ass = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n             if (ass && ass['steer'] === 'steer-pref') prefCount++;\n        }\n        \n        console.log(`Preferred Steer Count: ${prefCount}/50`);\n        expect(prefCount).toBeGreaterThan(30); // Expect > 60% (Logic said 80% chance)\n    });\n\n    it('should prioritize Fixed over Canister', () => {\n        const pool: Paddler[] = [];\n        for(let i=0; i<10; i++) pool.push(createPaddler(`fixed-${i}`, 80, ['left', 'right'], 1));\n        \n        for(let i=0; i<10; i++) pool.push(createPaddler(`canister-${i}`, 25, ['left', 'right'], 4));\n\n        for(let i=0; i<5; i++) pool.push(createPaddler(`maybe-${i}`, 80, ['left', 'right'], 2)); // 5 Maybe (Prio 2)\n        \n        pool.push(createPaddler('drum', 50, ['drum'], 1));\n        pool.push(createPaddler('steer', 60, ['steer'], 1));\n\n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        \n        // Count types in assignments\n        let fixed = 0, maybe = 0, canister = 0;\n        Object.values(assignments!).forEach(pid => {\n            if (typeof pid === 'string') {\n                if (pid.startsWith('fixed')) fixed++;\n                else if (pid.startsWith('maybe')) maybe++;\n                else if (pid.startsWith('canister')) canister++;\n            }\n        });\n\n        expect(fixed).toBe(10); // All fixed included\n        expect(maybe).toBe(5); // All maybes included\n        expect(canister).toBe(5); // Only 5 canisters needed\n    });\n\n    it('should assign Steer if only steer_preferred is set', () => {\n        const pool: Paddler[] = [];\n        const prefOnly = createPaddler('pref-only', 80, ['steer_preferred']);\n        pool.push(prefOnly);\n        // Fill rest\n        for(let i=0; i<20; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right']));\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        expect(assignments?.steer).toBe('pref-only');\n    });\n\n    it('should place Stroke in the first occupied row (Dynamic Row) and ensure pair', () => {\n        const rows = 10;\n        const pool: Paddler[] = [];\n        const stroke = createPaddler('stroke-p', 80, ['stroke']); // Flexible side\n        pool.push(stroke);\n        \n        // Add Drummer to preventing stealing a paddler\n        pool.push(createPaddler('drum', 60, ['drum']));\n        \n        for(let i=0; i<4; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right']));\n        \n        // No Drum/Steer for simplicity/distraction (or add them validly)\n        // If we don't add Drum/Steer, they remain empty.\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, rows);\n        expect(assignments).not.toBeNull();\n        \n        // Find Stroke Seat\n        const strokeSeatId = Object.keys(assignments!).find(k => assignments![k] === 'stroke-p');\n        expect(strokeSeatId).toBeDefined();\n        \n        const match = strokeSeatId!.match(/row-(\\d+)/);\n        const assignedStrokeRow = parseInt(match![1]);\n        \n        console.log(`Stroke assigned to Row ${assignedStrokeRow}`);\n        \n        // Check if assignedStrokeRow is indeed the min occupied row\n        const occupied = new Set<number>();\n        Object.keys(assignments!).forEach(k => {\n             if(k.includes('row')) occupied.add(parseInt(k.match(/row-(\\d+)/)![1]));\n        });\n        const minOccupied = Math.min(...Array.from(occupied));\n        \n        expect(assignedStrokeRow).toBe(minOccupied);\n        \n        // Check if Stroke Row has 2 people (Pair Enforcement)\n        let countInStrokeRow = 0;\n        Object.keys(assignments!).forEach(k => {\n            if (k.includes(`row-${assignedStrokeRow}-`)) countInStrokeRow++;\n        });\n        // Special case: If total paddlers < 2, we can't have a pair. But here we have 5.\n        expect(countInStrokeRow).toBe(2);\n    });\n\n    it('should NOT assign Drummer if no exclusive drummer exists', () => {\n        const pool: Paddler[] = [];\n        // Normal paddlers who CAN drum but also paddle\n        pool.push(createPaddler('p1', 80, ['left', 'drum']));\n        pool.push(createPaddler('p2', 80, ['right']));\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        expect(assignments?.drummer).toBeUndefined();\n    });\n\n    it('should assign Drummer if exclusive drummer exists', () => {\n        const pool: Paddler[] = [];\n        const drumOnly = createPaddler('drum-only', 60, ['drum']);\n        pool.push(drumOnly);\n        pool.push(createPaddler('p1', 80, ['left']));\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        expect(assignments?.drummer).toBe('drum-only');\n    });\n\n    it('should fill boat from front, leaving empty rows at the back', () => {\n        const pool: Paddler[] = [];\n        // 10 People normal\n        for(let i=0; i<10; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right']));\n        // 4 Canisters\n        for(let i=0; i<4; i++) pool.push(createPaddler(`c-${i}`, 10, ['left', 'right'], 4)); // Prio 4\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        \n        const occupied = new Set<number>();\n        let canisterRows = new Set<number>();\n        \n        Object.keys(assignments!).forEach(k => {\n             if (k.includes('row')) {\n                 const r = parseInt(k.match(/row-(\\d+)/)![1]);\n                 occupied.add(r);\n                 if (typeof assignments![k] === 'string' && (assignments![k] as string).startsWith('c-')) canisterRows.add(r);\n             }\n        });\n        \n        console.log('Occupied:', Array.from(occupied));\n        console.log('CanisterRows:', Array.from(canisterRows));\n        \n        // Check if Canisters are in the Outer-most assigned rows.\n        expect(true).toBe(true); // Placeholder\n    });\n\n    it('should prefer leaving the Last Row empty if possible', () => {\n        const pool: Paddler[] = [];\n        // 18 People (9 rows). 10 Rows total.\n        // Last row (10) should be empty. Row 1 filled.\n        for(let i=0; i<18; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right']));\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        \n        // Check Last Row (Row 10)\n        let row10Occupied = false;\n        if (assignments!['row-10-left'] || assignments!['row-10-right']) row10Occupied = true;\n        \n        expect(row10Occupied).toBe(false);\n    });\n\n    it('should place Canisters in Last Row if boat is full/nearly full', () => {\n        const pool: Paddler[] = [];\n        // 18 People + 2 Canisters. Total 20 = Full Boat.\n        // Canisters should be in Row 10 (Last Row).\n        for(let i=0; i<18; i++) pool.push(createPaddler(`p-${i}`, 80, ['left', 'right'], 1)); // Priority 1\n        pool.push(createPaddler(`c-1`, 10, ['left', 'right'], 4)); // Canister\n        pool.push(createPaddler(`c-2`, 10, ['left', 'right'], 4)); // Canister\n        \n        const assignments = runAutoFillAlgorithm(pool, {}, [], 0, 10);\n        \n        const r10L = assignments!['row-10-left'];\n        const r10R = assignments!['row-10-right'];\n        \n        expect(r10L).toBeDefined();\n        expect(r10R).toBeDefined();\n        \n        // Check if they are canisters\n        // We know canisters start with 'c-'\n        const isCanister = (id: string) => (id as string).startsWith('c-');\n        \n        if (typeof r10L === 'string') expect(isCanister(r10L)).toBe(true);\n        if (typeof r10R === 'string') expect(isCanister(r10R)).toBe(true);\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/utils/algorithm.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'pool' is never reassigned. Use 'const' instead.","line":21,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":21,"endColumn":11,"fix":{"range":[606,753],"text":"const pool = activePaddlerPool\n    .filter((p) => !lockedIds.includes(p.id.toString()))\n    .sort((a, b) => (a.priority || 99) - (b.priority || 99));"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'seatsNeeded' is assigned a value but never used.","line":30,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":20},{"ruleId":"prefer-const","severity":2,"message":"'currAss' is never reassigned. Use 'const' instead.","line":55,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":55,"endColumn":29,"fix":{"range":[2022,2066],"text":"const currAss: Assignments = { ...lockedAss };"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'canisterCount' is assigned a value but never used.","line":354,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":354,"endColumn":22}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { Paddler, Assignments } from '../types';\n\nexport const runAutoFillAlgorithm = (\n  activePaddlerPool: Paddler[],\n  assignments: Assignments,\n  lockedSeats: string[],\n  targetTrim: number,\n  rows: number = 10\n): Assignments | null => {\n  const lockedAss: Assignments = {};\n  \n  // Gesperrte Sitze behalten\n  lockedSeats.forEach((s) => {\n    if (assignments[s]) lockedAss[s] = assignments[s];\n  });\n  \n  const lockedIds = Object.values(lockedAss);\n  \n  // Verfügbarer Pool (ohne bereits gesperrte Personen)\n  // Sortiere nach Priorität (kleiner ist wichtiger): 1=Fixed, 2=Maybe, 3=Guest, 4=Canister\n  let pool = activePaddlerPool\n    .filter((p) => !lockedIds.includes(p.id.toString()))\n    .sort((a, b) => (a.priority || 99) - (b.priority || 99));\n    \n  if (pool.length === 0 && Object.keys(lockedAss).length === 0) return null;\n\n  // Bestimme Boat Capacity\n  const boatCapacity = rows * 2 + 2; // + Drum + Steer\n  const seatsTaken = Object.keys(lockedAss).length;\n  const seatsNeeded = boatCapacity - seatsTaken;\n\n  // Wähle die Top-Kandidaten für das Boot aus, basierend auf Priorität\n  // Wir nehmen erstmal mehr als nötig, um Flexibilität für Balance zu haben, \n  // aber versuchen Canister und Low-Prio zu vermeiden.\n  // Strategie: Wir nehmen alle Non-Canister und füllen mit Canistern auf.\n  // Aber halt: \"feste zusagen werden vor vieleichts, gästen und kanistern bevorzugt\"\n  \n  // Wir nutzen den ganzen Pool für die Simulation, aber der \"Score\" wird bestrafen, wenn \"schlechte\" (Canister) im Boot sind\n  // wenn \"gute\" (Member) draußen sind.\n  \n  // Um die Komplexität zu reduzieren, filtern wir Canister raus, die wir sicher nicht brauchen.\n  // Aber wir wissen nicht, ob wir sie für Balance brauchen.\n  // Wir lassen sie drin, aber bestrafen ihre Nutzung im Score.\n\n  let bestAss: Assignments | null = null;\n  let bestScore = -Infinity;\n\n  // Helper für Mittellinie (Reihen)\n  const midRow = (rows + 1) / 2;\n\n  // Simulation loop\n  const iterations = 2000;\n\n  for (let i = 0; i < iterations; i++) {\n    let currAss: Assignments = { ...lockedAss };\n    \n    // Kopie des Pools für diesen Run\n    // Wir shuffeln leicht, aber behalten grobe Priorität\n    let currPool = [...pool].sort((a, b) => {\n        // Prio Differenz gewichten\n        const prioDiff = (a.priority || 99) - (b.priority || 99);\n        if (prioDiff !== 0) {\n            // Noise hinzufügen, damit auch mal ein Maybe statt Guest reinkommt zum Testen, \n            // aber Fixed sollte fast immer drin sein.\n            // Prio 1 vs 4 sollte eindeutig sein.\n            return prioDiff + (Math.random() * 0.5 - 0.25); \n        }\n        // Bei gleicher Prio random\n        return Math.random() - 0.5;\n    });\n\n    // --- ASSIGN SPECIAL ROLES FIRST ---\n\n    // 1. Steuermann\n    // Prüfen ob schon besetzt\n    if (!currAss['steer']) {\n      // Suche Kandidaten mit 'steer' Skill oder 'steer_preferred'\n      const steers = currPool.filter(p => p.skills && (p.skills.includes('steer') || p.skills.includes('steer_preferred')));\n      if (steers.length > 0) {\n        // Bevorzugte Steuerleute filtern\n        const preferred = steers.filter(p => p.skills.includes('steer_preferred'));\n        \n        let candidate: Paddler;\n        // 80% Chance den Preferred zu nehmen (falls vorhanden)\n        if (preferred.length > 0 && Math.random() < 0.8) {\n             candidate = preferred[Math.floor(Math.random() * preferred.length)];\n        } else {\n             candidate = steers[Math.floor(Math.random() * steers.length)];\n        }\n        \n        currAss['steer'] = candidate.id;\n        currPool = currPool.filter(p => p.id !== candidate.id);\n      }\n    }\n\n    // 2. Trommler\n    if (!currAss['drummer']) {\n       // Wer kann trommeln? (Skill 'drum' oder Gewicht < 65kg als Fallback?)\n       // Algorithmus nimmt einfachen einen leichten, der 'drum' kann oder random leicht\n       // Wer kann trommeln? (Skill 'drum' oder Gewicht < 65kg als Fallback?)\n       // NEU: Trommel nur besetzen, wenn jemand AUSSCHLIESSLICH 'drum' kann.\n       // (lockedAss 'drummer' ist schon handled oben)\n       \n       // Finde Leute, die NUR 'drum' können (und ggf. 'steer_preferred' etc ignorieren wir mal, aber 'left'/'right' ist wichtig)\n       // Wir definieren \"Exclusive Drummer\" als jemanden, der NICHT paddeln kann ('left', 'right', 'both').\n       const exclusiveDrummers = currPool.filter(p => \n           p.skills && \n           p.skills.includes('drum') && \n           !p.skills.includes('left') && \n           !p.skills.includes('right') && \n           !p.skills.includes('both')\n       );\n       \n       let candidate: Paddler | undefined;\n       \n       if (exclusiveDrummers.length > 0) {\n         // Nimm einen zufälligen exklusiven Trommler\n         candidate = exclusiveDrummers[Math.floor(Math.random() * exclusiveDrummers.length)];\n       } \n       // ELSE: Trommel bleibt leer (undefined)\n       \n       if (candidate) {\n         currAss['drummer'] = candidate.id;\n         currPool = currPool.filter(p => p.id !== candidate.id);\n       }\n    }\n\n    // --- ASSIGN ROWS ---\n    \n    // Sortiere verbleibenden Pool für Reihen-Besetzung\n    // Strategie: Schwere in die Mitte. \n    // Wir sortieren nach Gewicht absteigend für die Zuweisung,\n    // um sicherzustellen, dass die schwersten \"verfügbar\" sind für die mittleren Reihen.\n    // Aber wir müssen auch \"Stroke\" beachten.\n    \n    // Wir nehmen die besten N Kandidaten (nach Prio), um das Boot zu füllen.\n    // Die, die übrig bleiben, sind Reserve.\n    const spotsToFill = boatCapacity - Object.keys(currAss).length; \n    \n    // Wir nehmen nur so viele aus dem Pool, wie wir Plätze haben (plus kleine Reserve für Balance-Swap später?)\n    // Nein, wir füllen das Boot strickt.\n    // Wir nehmen die Top N nach Prio.\n    \n    // Da currPool oben schon grob nach Prio sortiert wurde (mit leichtem Shuffle),\n    // nehmen wir einfach die ersten N.\n    // Aber Achtung: Canister haben Prio 4. Wenn wir genug echte Menschen haben, rutschen Canister nach hinten.\n    \n    let candidates = currPool.slice(0, spotsToFill);\n    \n    // --- DETERMINE STRATEGY (Single vs Two Blocks) ---\n    const useTwoBlocks = Math.random() < 0.3; // 30% Chance for Two Blocks\n    const focusRows: number[] = [];\n    \n    if (useTwoBlocks) {\n        // Two Blocks: Randomly pick two focus points (e.g. Front/Back)\n        const f1 = 1 + Math.random() * (rows / 2 - 1); // Front half\n        const f2 = rows - Math.random() * (rows / 2 - 1); // Back half\n        focusRows.push(f1, f2);\n    } else {\n        // Single Block: Usually Middle, but varying slightly to allow shifting\n        // 50% Standard Middle, 50% Random Shift\n        if (Math.random() < 0.5) {\n             focusRows.push(midRow);\n        } else {\n             focusRows.push(1 + Math.random() * (rows - 1));\n        }\n    }\n\n    // Helper to calculate score/distance to focus strategy\n    const getDist = (r: number) => {\n        return Math.min(...focusRows.map(f => Math.abs(r - f)));\n    };\n\n    // --- DETERMINE STROKE ROW (Front-most occupied row) ---\n    // 1. Calculate Row Order based on Strategy\n    // Sort all rows by distance to nearest focus point\n    const allRowsArr: number[] = [];\n    for(let r=1; r<=rows; r++) allRowsArr.push(r);\n    \n    const rowOrder = allRowsArr.sort((a, b) => {\n        const dA = getDist(a);\n        const dB = getDist(b);\n        if (Math.abs(dA - dB) < 0.01) return a - b; // Tie-break to front\n        return dA - dB;\n    });\n\n    // 2. Identify all rows that will be occupied\n    const occupiedRows = new Set<number>();\n    \n    // Add currently locked/assigned rows\n    Object.keys(currAss).forEach(key => {\n        const match = key.match(/row-(\\d+)/);\n        if (match) occupiedRows.add(parseInt(match[1]));\n    });\n\n    // Add rows that will be filled by candidates\n    let spotsNeeded = candidates.length;\n    for (const r of rowOrder) {\n        if (spotsNeeded <= 0) break;\n        // Check free spots in this row\n        let freeInRow = 0;\n        if (!currAss[`row-${r}-left`]) freeInRow++;\n        if (!currAss[`row-${r}-right`]) freeInRow++;\n        \n        if (freeInRow > 0) {\n            occupiedRows.add(r);\n            spotsNeeded -= freeInRow;\n        }\n    }\n\n    // 3. Stroke Row is the minimum (front-most) occupied row\n    // If no rows occupied (empty boat), default to 1?\n    const strokeRow = occupiedRows.size > 0 ? Math.min(...Array.from(occupiedRows)) : 1;\n    \n\n    \n    // Plätze sammeln\n    const freeSeats: { id: string; row: number; side: string }[] = [];\n    for (let r = 1; r <= rows; r++) {\n      if (!currAss[`row-${r}-left`]) freeSeats.push({ id: `row-${r}-left`, row: r, side: 'left' });\n      if (!currAss[`row-${r}-right`]) freeSeats.push({ id: `row-${r}-right`, row: r, side: 'right' });\n    }\n    \n    // Special Role: Stroke (Schlag) -> Reihe 1\n    const strokes = candidates.filter(p => p.skills && p.skills.includes('stroke'));\n    \n    // Versuche Stroke in strokeRow (oder der nächsten freien) zu setzen\n    strokes.forEach(s => {\n       // Finde freien Platz in strokeRow, sonst suche weiter nach hinten\n       // Wir suchen Sitze ab strokeRow aufwärts\n       const targetSeats = freeSeats.filter(seat => seat.row >= strokeRow).sort((a, b) => a.row - b.row);\n       \n       if (targetSeats.length > 0) {\n           // Nimm den ersten passenden (in strokeRow oder nächster)\n           // Preferiere strokeRow\n           const bestSeatIdx = freeSeats.findIndex(seat => seat.row === targetSeats[0].row && seat.side === targetSeats[0].side); // Match ID effectively\n           \n           // Check compatibility with this seat\n           const seat = freeSeats[bestSeatIdx];\n           \n           if (bestSeatIdx !== -1) {\n           // Check Side preference\n           if (!s.skills.includes(seat.side) && !s.skills.includes('both') && !s.skills.includes('stroke')) {\n               // Wenn Seite gar nicht passt... aber 'stroke' skill impliziert oft Flexibilität oder wir ignorieren Seite für Stroke Prio?\n               // Besser: Check Side Compatibility\n               if (s.skills.includes(seat.side) || (s.skills.includes('both')) || (s.skills.length <= 1 && !s.skills.includes('left') && !s.skills.includes('right'))) {\n                 // Assign\n                 currAss[seat.id] = s.id;\n                 candidates = candidates.filter(c => c.id !== s.id);\n                 freeSeats.splice(bestSeatIdx, 1);\n                 return;\n               }\n           } else {\n                 // Assign anyway if possible match OR if they are stroke (assume flexible if no side set, or just force it)\n                 // If they strictly have only 'stroke', we put them there.\n                 if (s.skills.includes(seat.side) || s.skills.includes('both') || s.skills.includes('stroke')) {\n                    currAss[seat.id] = s.id;\n                    candidates = candidates.filter(c => c.id !== s.id);\n                    freeSeats.splice(bestSeatIdx, 1);\n                 }\n           }\n       }\n       }\n    });\n\n    // Rest verteilen\n    // Sortiere Candidates nach Gewicht (Schwerste zuerst)\n    candidates.sort((a, b) => b.weight - a.weight);\n\n    // Wir verteilen von der Mitte nach außen\n    // Erstelle Reihenfolge der Reihen für Filling: 5, 6, 4, 7, 3, 8... (bei 10 Reihen)\n    freeSeats.sort((a, b) => {\n        // 1. Prioritize Stroke Row !! (To ensure pairs)\n        const isStrokeA = a.row === strokeRow;\n        const isStrokeB = b.row === strokeRow;\n        if (isStrokeA && !isStrokeB) return -1;\n        if (!isStrokeA && isStrokeB) return 1;\n\n        // 2. Then Strategy (Distance to Focus Points)\n        const distA = getDist(a.row);\n        const distB = getDist(b.row);\n        \n        if (Math.abs(distA - distB) > 0.01) {\n            return distA - distB; // Kleinste Distanz zuerst (nahe an Focus Points)\n        }\n        \n        // 3. Tie-Breaker: Prefer Front Rows (Lower Row Number)\n        // This ensures that if we have equal distance (e.g. Row 2 and Row 9 for a 10-row boat),\n        // we fill Row 2 first. \n        // Result: Empty rows will be at the back.\n        return a.row - b.row;\n    });\n\n    // Greedy Assignment mit Backtracking-Light (bzw. Best Fit)\n    // Für jeden Kandidaten (schwerste zuerst) suche besten freien Platz\n    for (const p of candidates) {\n        // Berechne aktuelle Balance\n        let l = 0, r = 0;\n        Object.entries(currAss).forEach(([sid, pid]) => {\n           if (sid.includes('row')) {\n              const pad = activePaddlerPool.find(x => x.id === pid);\n              if (pad) {\n                  if (sid.includes('left')) l += pad.weight; else r += pad.weight;\n              }\n           }\n        });\n        \n        // Suche passenden Sitz\n        // Preferiere Seite, die leichter ist\n        const preferredSide = l <= r ? 'left' : 'right';\n        \n        // Filtere freeSeats nach Skill\n        const validSeats = freeSeats.filter(s => p.skills.includes(s.side));\n        \n        if (validSeats.length > 0) {\n            // Sortiere validSeats:\n            // 1. Zuerst die, die zur bevorzugten Seite passen (Balance)\n            // 2. Dann die, die am nahesten zur Mitte sind (schon durch freeSeats Sortierung gegeben, aber durch filter evtl. Lücken)\n            \n            // Da freeSeats schon nach \"Mitte zuerst\" sortiert ist, nehmen wir den ersten validen,\n            // der auch zur Balance passt.\n            \n            const bestSeat = validSeats.find(s => s.side === preferredSide) || validSeats[0];\n            \n            currAss[bestSeat.id] = p.id;\n            // Remove from freeSeats\n            const idx = freeSeats.findIndex(x => x.id === bestSeat.id);\n            if (idx > -1) freeSeats.splice(idx, 1);\n        } else {\n            // FALLBACK: Allow wrong side assignment if absolutely necessary\n            // Try to find ANY seat from freeSeats\n            const fallbackSeats = freeSeats; // All remaining seats\n            if (fallbackSeats.length > 0) {\n                 // Try to balance if possible, otherwise just take the first one\n                 // Still prefer the \"preferredSide\" if available in fallback (unlikely if validSeats was empty, unless skill mismatch)\n                 \n                 // If validSeats was empty, it means NO seat matched skills. \n                 // So we just pick the one that helps balance best.\n                 \n                 const bestSeat = fallbackSeats.find(s => s.side === preferredSide) || fallbackSeats[0];\n                 currAss[bestSeat.id] = p.id;\n                 const idx = freeSeats.findIndex(x => x.id === bestSeat.id);\n                 if (idx > -1) freeSeats.splice(idx, 1);\n            }\n        }\n    }\n\n    // --- SCORING ---\n    let score = 0;\n    \n    // Analyse Assignment\n    let fl = 0, fr = 0, ff = 0, fb = 0;\n    let assignedCount = 0;\n    let canisterCount = 0;\n    \n    Object.entries(currAss).forEach(([sid, pid]) => {\n       const pad = activePaddlerPool.find(x => x.id === pid);\n       if (!pad) return;\n       \n       assignedCount++;\n       if (pad.isCanister) canisterCount++;\n       \n       // Priority Scoring\n       // Prio 1 (Fixed) -> +1000\n       // Prio 2 (Maybe) -> +500\n       // Prio 3 (Guest) -> +450\n       // Prio 4 (Canister) -> -200 (Wir wollen Canister vermeiden!)\n       if (pad.priority === 1) score += 1000;\n       else if (pad.priority === 2) score += 500;\n       else if (pad.priority === 3) score += 450;\n       else if (pad.priority === 4) score -= 200; // Bestrafe Canister Nutzung\n\n       if (sid === 'drummer') ff += pad.weight;\n       else if (sid === 'steer') fb += pad.weight;\n       else if (sid.includes('row')) {\n          const match = sid.match(/row-(\\d+)-(left|right)/);\n          if (match) {\n             const row = parseInt(match[1]);\n             const side = match[2];\n             \n             if (side === 'left') fl += pad.weight; else fr += pad.weight;\n             if (row < midRow) ff += pad.weight; else if (row > midRow) fb += pad.weight;\n             \n             // BONUS: Heavy in Middle\n             // Je näher an Mitte und je schwerer, desto besser\n             const distToMid = Math.abs(row - midRow);\n             const weightScore = pad.weight * (10 - distToMid); // Mitte = Faktor 10, Außen = Faktor 5\n             score += weightScore * 0.5;\n\n             // BONUS: Stroke in Stroke Row (Front-most occupied)\n             if (row === strokeRow && pad.skills.includes('stroke')) score += 500;\n             \n             // PENALTY: Wrong Side (Notfall-Zuweisung)\n             // Check if paddler actually has the skill for this side\n             const hasSkill = pad.skills.includes(side) || pad.skills.includes('both');\n             // Ignore for canisters or special roles if they don't have side skills set? \n             // Assuming humans always have at least 'left' or 'right' set if they are paddlers.\n             if (!hasSkill && !pad.isCanister && !pad.isGuest) {\n                 score -= 200; // Significant penalty, but less than leaving the boat empty or unbalanced if that's critical\n             }\n          }\n       }\n    });\n\n    // Special Role: Preferred Steer\n    if (currAss['steer']) {\n        const steerP = activePaddlerPool.find(p => p.id === currAss['steer']);\n        if (steerP && steerP.skills.includes('steer_preferred')) score += 300;\n    }\n\n     // Balance Penalty\n     const diffLR = Math.abs(fl - fr);\n     score -= diffLR * diffLR; // Quadratische Strafe\n \n     // Trim Penalty\n     const trim = ff - fb;\n     // targetTrim: Positiv = mehr Vorne.\n     const diffTrim = Math.abs(trim - targetTrim);\n     score -= diffTrim * 20;\n \n     // Full Boat Bonus\n     const boatFullness = assignedCount / boatCapacity;\n     score += boatFullness * 5000;\n     \n     // BONUS: Last Row (Row 10) Preference\n     // \"Versuche die letzte Bank möglichst frei zu lassen oder Kanister dort zu platzieren\"\n     // Check usage of last row\n     let lastRowUsed = false;\n     let lastRowCanisterCount = 0;\n     let lastRowMemberCount = 0;\n     \n     // Scan assignments for last row\n     // We can just iterate row-rows-left/right\n     if (currAss[`row-${rows}-left`]) {\n         lastRowUsed = true;\n         const p = activePaddlerPool.find(x => x.id === currAss[`row-${rows}-left`]);\n         if (p?.isCanister) lastRowCanisterCount++; else lastRowMemberCount++;\n     }\n     if (currAss[`row-${rows}-right`]) {\n         lastRowUsed = true;\n         const p = activePaddlerPool.find(x => x.id === currAss[`row-${rows}-right`]);\n         if (p?.isCanister) lastRowCanisterCount++; else lastRowMemberCount++;\n     }\n     \n     if (!lastRowUsed) {\n         score += 600; // Super, letzte Reihe frei!\n     } else {\n         // Wenn genutzt, dann lieber Kanister als Member\n         if (lastRowMemberCount === 0 && lastRowCanisterCount > 0) {\n             score += 400; // Okay, nur Kanister\n         } else if (lastRowMemberCount > 0) {\n             // Member in letzter Reihe -> Vermeiden wenn möglich (Penalty)\n             // Aber wenn Boot voll ist, ist das halt so.\n             // BoatFullness bonus (5000) overrides this easily.\n             score -= 100;\n         }\n     }\n\n    if (score > bestScore) {\n       bestScore = score;\n       bestAss = currAss;\n    }\n  }\n\n  return bestAss;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/janhartje/drachenbootplan/src/utils/importUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]